/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2021 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).TP=n()}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},n=function(t,n){return t&&u(n)&&t instanceof n},e=function(t){return"number"==typeof t},r=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||n(t,Object))},u=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},i=function(t){return"string"==typeof t},c=function n(e){if(t(e))return e.map((function(t){return n(e)}));if(r(e)){for(var u in e)e[u]=n(e[u]);return e}return!1===e?"false":null===e?"null":!0===e?"true":""+e},o=function(t,n){var e=n.indexOf(t);return-1!==e?e:null},s=function(t){return t.toLowerCase()},f=function(t){return t.length},a=function(t){return Object.keys(t)},l=function n(e){if(t(e))return e.map((function(t){return n(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(e))return function(t,n){return void 0===n&&(n=10),n?parseInt(t,n):parseFloat(t)}(e);if(r(e)){for(var u in e)e[u]=n(e[u]);return e}return"false"!==e&&("null"===e?null:"true"===e||e)},g=document,d=window,p=function(t,n,e){if(void 0===e&&(e=!0),!x(t,n))return null;var r=t.getAttribute(n);return e?l(r):r},v=function(t,n){var r=t.children;return e(n)?r[n]||null:r||[]},m=function(t){return s(t&&t.nodeName||"")||null},h=function(t){return t.nextElementSibling||null},b=function(t){return t.parentNode||null},k=function(t){return t.previousElementSibling||null},y=function(t,n){void 0===n&&(n=!0);var e="textContent";if(!E(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},x=function(t,n){return t.hasAttribute(n)},w=function(t){return null!==b(t)},E=function(t,n){return n in t},L=function(t,n){return t.removeAttribute(n),t},A=function(t,n){return t.classList.remove(n),t},T=function(n,e){if(t(e))return e.forEach((function(t){return n.classList.remove(t)})),n;if(r(e)){for(var u in e)e[u]&&n.classList.remove(u);return n}return n.className="",n},C=function(t){var n=b(t);return t.remove(),n},B=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,c(e)),t},K=function(t,n){return t.append(n),n},O=function(t,n){return t.classList.add(n),t},R=function(t,n,e){return t=i(t)?g.createElement(t):t,r(n)&&(e=n,n=!1),i(n)&&P(t,n),r(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?B(t,r,e):L(t,r)}(t,e),t},P=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="innerHTML";return E(t,r)&&(t[r]=e?n.trim():n),t},N=function(t,n){return b(t).insertBefore(n,t),n},D=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="textContent";return E(t,r)&&(t[r]=e?n.trim():n),t},S=function(t,n,e){n.removeEventListener(t,e)},z=function(t){return t&&t.preventDefault()},F=function(t){return t&&t.stopPropagation()},H=function(t,n,e,r){void 0===r&&(r=!1),n.addEventListener(t,e,r)},I=function(t,n){return-1!==n.indexOf(t)};var M=function(t,e){return function(t){return n(t,RegExp)}(t)?t:(t=t.replace(/\//g,"\\/"),RegExp(t,u(e)?e:"g"))};let $=d.setTimeout;function _(c,l={}){if(!c)return;const x=this;if(c.TP)return;if(!n(x,_))return new _(c,l);let L=()=>c.disabled,B=()=>c.readOnly,P=p(c,"placeholder"),q=p(c,"tabindex"),{fire:G}=function(t){var n={};return t.hooks=n,t.fire=function(e,r){return u(n[e])?(n[e].forEach((function(n){return n.apply(t,r)})),t):t},t.off=function(e,r){if(!u(e))return n={},t;if(u(n[e]))if(u(r)){for(var i=0,c=n[e].length;i<c;++i)if(r===n[e][i]){n[e].splice(i,1);break}0===j&&delete n[e]}else delete n[e];return t},t.on=function(e,r){return u(n[e])||(n[e]=[]),u(r)&&n[e].push(r),t},t}(x);var J;x.state=l=function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];return Object.assign.apply(Object,[{}].concat(n))}(_.state,i(l)?{join:l}:l||{}),x.source=c,_.instances[c.id||c.name||(J=_.instances,f(a(J)))]=x,c.TP=1;let Q=R("span",{class:"editor tag"}),U=R("span",{contenteditable:!L()&&"true",spellcheck:"false",style:"white-space:pre;"}),V=R("span"),W=function(t){var n="form";if(E(t,n)&&n===m(t.form))return t.form;for(var e=b(t);e&&n!==m(e);)e=b(e);return e||null}(c),X=R("span",{class:l.class,tabindex:!L()&&"-1"}),Y=R("span",{class:"tags"});function Z(t){return x.f(t).replace(M("("+l.escape.join("|").replace(/\\/g,"\\\\")+")+"),"").trim()}function tt(){if(L()||B())return bt("");let t,n=Z(y(U));n&&(kt(n)?G("has.tag",[n,o(n,x.tags)]):(jt(n),xt(n),t=f(x.tags),G("change",[n,t]),G("set.tag",[n,t])),bt(""))}function nt(){tt(),T(X,["focus","focus.input"]),G("blur",[x.tags,f(x.tags)])}function et(){T(X,["focus.self","focus.tags"])}function rt(){G("click",[x.tags])}function ut(){O(X,"focus"),O(X,"focus.input"),G("focus",[x.tags])}function it(t){F(t);let n,e=l.escape,r=t.key,u=t.keyCode,i=t.ctrlKey,c="Enter"===r||13===u,o=t.shiftKey,s="Tab"===r||9===u,a=k(Q),g=f(x.tags),d=l.max,p=Z(y(U));c?r="\n":s&&(r="\t"),s||(!i||""!==p||"a"!==r&&65!==u?L()||B()?(c&&B()&&Et(),z(t)):I(r,e)||I(u,e)?(g<d?tt():(bt(""),G("max.tags",[d])),z(t)):c?(Et(),z(t)):$((()=>{let c=y(U)||"",s=Z(c);I(c.slice(-1),e)?(g<d?tt():(bt(""),G("max.tags",[d])),z(t)):""!==s||i||o||(""!==p||"Backspace"!==r&&"Backspace"!==u?"ArrowLeft"!==r&&37!==u||a&&a.focus():(A(X,"focus.tag"),n=x.tags[g-1],wt(n),yt(n),a&&(G("change",[n,g-1]),G("let.tag",[n,g-1])))),D(V,s?"":P)}),0):(X.focus(),lt(t),z(t)))}function ct(t){x.tags;let n=t.key,e=t.keyCode,r=t.ctrlKey,u=t.shiftKey;B()||r||!n||1!==f(n)?r||u||("Backspace"===n||8===e||"Delete"===n||46===e?(ot(""),bt("",1),z(t)):"ArrowRight"!==n&&39!==e||(bt("",1),z(t))):(ot(""),bt(n,1),z(t))}function ot(t){if(w(X)){let t;for(;t=k(Q);)wt(t.title)}x.tags=[],c.value="",t=t?t.split(l.join):[];for(let n,e=0,r=l.max;e<r&&t[e];++e)if(""!==(n=Z(t[e]))){if(kt(n))continue;jt(n),xt(n),G("change",[n,e]),G("set.tag",[n,e])}}function st(t){if(L())return;let n=l.min;return tt(),n>0&&f(x.tags)<n?(bt("",1),G("min.tags",[n]),void z(t)):1}function ft(){$((()=>{L()||B()||ot(y(U)),bt("")}),0)}function at(t){t&&X===t.target&&(U.focus(),rt())}function lt(t){let n=t.key,e=t.keyCode;!t.ctrlKey||"a"!==n&&65!==e||O(X,"focus.tags"),O(X,"focus.self")}function gt(){U.focus()}function dt(){let t=this.title;T(X,["focus","focus.tag"]),G("blur.tag",[t,o(t,x.tags)])}function pt(){let t=this.title;G("click.tag",[t,o(t,x.tags)])}function vt(){let n=this.title;!function(n,e){if(t(e))return e.forEach((function(t){return n.classList.add(t)})),n;if(r(e))for(var u in e)e[u]?n.classList.add(u):n.classList.remove(u);n.className=e}(X,["focus","focus.tag"]),G("focus.tag",[n,o(n,x.tags)])}function mt(t){if(!L()&&!B()){let t=b(this).title,n=o(t,x.tags);wt(t),yt(t),bt("",1),G("change",[t,n]),G("click.tag",[t,n]),G("let.tag",[t,n])}z(t)}function ht(t){F(t);let n=t.key,e=t.keyCode,r=t.ctrlKey,u=t.shiftKey,i=this,c=h(i),s=k(i);if(B()||r||!n||1!==f(n))if(r||u)r&&("a"!==n&&65!==e||(X.focus(),lt(t),z(t)));else if(B()||"ArrowLeft"!==n&&37!==e)if(B()||"ArrowRight"!==n&&39!==e){if("Backspace"===n||8===e||"Delete"===n||46===e){if(!B()){let t=i.title,r=o(t,x.tags);A(X,"focus.tag"),wt(t),yt(t),"Backspace"===n||8===e?s?s.focus():bt("",1):c&&c!==Q?c.focus():bt("",1),G("change",[t,r]),G("let.tag",[t,r])}z(t)}}else c&&c!==Q?c.focus():bt("",1),z(t);else s&&(s.focus(),z(t));else{let e=i.title,r=o(e,x.tags);wt(e),yt(e),bt(n,1),z(t),G("change",[e,r]),G("let.tag",[e,r])}}function bt(t,n){if(D(U,t),D(V,t?"":P),n){U.focus();let t=g.createRange(),n=d.getSelection();t.selectNodeContents(U),t.collapse(!1),n.removeAllRanges(),n.addRange(t)}}function kt(t,n){let r=o(t,x.tags);return n&&G("get.tag",[t,r]),e(r)?t:null}function yt(t){let n=o(t,x.tags);return!!(e(n)&&n>=0)&&(x.tags.splice(n,1),c.value=x.tags.join(l.join),!0)}function xt(t,n){e(n)?(n=n<0?0:n,x.tags.splice(n,0,t)):x.tags.push(t),c.value=x.tags.join(l.join)}function jt(t,n){let r=R("span",{class:"tag",tabindex:!L()&&"0",title:t}),u=R("a",{href:"",tabindex:"-1",target:"_top"});H("click",u,mt),K(r,u),H("blur",r,dt),H("click",r,pt),H("focus",r,vt),H("keydown",r,ht),w(Y)&&(e(n)&&x.tags[n]?N(v(Y,n),r):N(Q,r))}function wt(t){let n,r=o(t,x.tags);if(e(r)&&r>=0&&(n=v(Y,r))){S("blur",n,dt),S("click",n,pt),S("focus",n,vt),S("keydown",n,ht);let t=n.firstElementChild||null;t&&(S("click",t,mt),C(t)),C(n)}}function Et(){st()&&W&&W.dispatchEvent(new Event("submit",{cancelable:!0}))}var Lt,At;return bt(""),K(X,Y),K(Y,Q),K(Q,U),K(Q,V),O(c,l.class+"-source"),At=X,b(Lt=c).insertBefore(At,h(Lt)),R(c,{tabindex:"-1"}),H("blur",U,nt),H("blur",X,et),H("click",U,rt),H("click",X,at),H("focus",U,ut),H("focus",X,lt),H("focus",c,gt),H("keydown",U,it),H("keydown",X,ct),H("paste",U,ft),W&&H("submit",W,st),x.blur=()=>(!L()&&(U.blur(),nt()),x),x.click=()=>(X.click(),at(),x),x.f=t=>s(t||"").replace(/[^ a-z\d-]/g,""),x.focus=()=>(L()||(U.focus(),ut()),x),x.get=t=>L()?null:kt(t,1),x.input=U,x.let=t=>{if(!L()&&!B())if(t){let n=l.min;if(tt(),n>0&&f(x.tags)<n)return G("min.tags",[n]),x;wt(t),yt(t)}else ot("");return x},x.pop=()=>{if(!c.TP)return x;delete c.TP;let t=x.tags;return A(c,l.class+"-source"),S("blur",U,nt),S("blur",X,et),S("click",U,rt),S("click",X,at),S("focus",U,ut),S("focus",X,lt),S("focus",c,gt),S("keydown",U,it),S("keydown",X,ct),S("paste",U,ft),W&&S("submit",W,st),t.forEach(wt),R(c,{tabindex:q}),C(X),G("pop",[t])},x.self=X,x.set=(n,e)=>{if(!n)return x;if(!L()&&!B())if(t(n))ot(n.join(l.join));else{let t=x.tags,r=l.max;kt(n)?G("has.tag",[n,o(n,t)]):f(t)<r?(jt(n,e),xt(n,e)):G("max.tags",[r])}return x},x.source=x.output=c,x.state=l,x.tags=[],ot(c.value),x}return _.instances={},_.state={class:"tag-picker",escape:[",",188],join:", ",max:9999,min:0},_.version="3.2.1",_}));