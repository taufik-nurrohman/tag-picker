/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=e()}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},e=function(t){return"function"==typeof t},n=function(t,e){return t&&a(e)&&t instanceof e},s=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||n(t,Object))},a=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},r=function(t){return"string"==typeof t},i=function(t){return t.toLowerCase()},u=function(t){return t.length},o=function(t){return Object.keys(t)},c=function(t){return Object.values(t)},f=function e(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];for(var o,c=r.shift(),f=0,l=u(r);f<l;++f)for(var v in r[f])if(a(c[v]))if(t(c[v])&&t(r[f][v])){c[v]=[].concat(c[v]);for(var p=0,h=u(r[f][v]);p<h;++p)o=r[f][v][p],-1===c[v].indexOf(o)&&c[v].push(r[f][v][p])}else s(c[v])&&s(r[f][v])?c[v]=e({},c[v],r[f][v]):c[v]=r[f][v];else c[v]=r[f][v];return c},l=function e(n){if(t(n))return n.map((function(t){return e(n)}));if(s(n)){for(var a in n)n[a]=e(n[a]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},v=document,p=window,h=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},_=function(t,e){return e?t.closest(e)||null:t.parentNode||null},m=function(t){var e="form";return k(t,e)&&e===function(t){return i(t&&t.nodeName||"")||null}(t[e])?t[e]:_(t,e)},d=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!k(t,n))return!1;var s=t[n];return""!==(s=e?s.trim():s)?s:null},g=function(t,e){return t.classList.contains(e)},k=function(t,e){return e in t},y=function(t,e){return t.removeAttribute(e),t},b=function(t,e){return t.classList.remove(e),t},w=function(t){var e=_(t);return t.remove(),e},x=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,l(n)),t},j=function(t,e){return t.append(e),e},E=function(t,e){return t.classList.add(e),t},A=function(t,e,n){return t=r(t)?v.createElement(t):t,s(e)&&(n=e,e=!1),r(e)&&L(t,e),s(n)&&function(t,e){var n;for(var s in e)(n=e[s])||""===n||0===n?x(t,s,n):y(t,s)}(t,n),t},L=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var s="innerHTML";return k(t,s)&&(t[s]=n?e.trim():e),t},S=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var s="textContent";return k(t,s)&&(t[s]=n?e.trim():e),t};var K=function(t,e,n){e.removeEventListener(t,n)},R=function(t){return t&&t.preventDefault()},C=function(t,e,n,s){void 0===s&&(s=!1),e.addEventListener(t,n,s)},T=function(t,e){return function(t){return n(t,RegExp)}(t)?t:RegExp(t,a(e)?e:"g")},O="ArrowLeft",q="ArrowRight",P="Home",B="Backspace",N="End";function D(t,e,n){Object.defineProperty(t,e,n)}function H(t,e){return p.setTimeout(t,1)}function I(t){return t.disabled}function M(t){var e,n=v.createRange();n.selectNodeContents(t),n.collapse(!1),(e=p.getSelection()).removeAllRanges(),e.addRange(n)}function W(t,e){var s=this;return t?n(s,W)?(t["_"+W.name]=function(t,e){return(e=e||t).fire=function(t,e){var n=this,s=n.hooks;return a(s[t])?(s[t].forEach((function(t){return t.apply(n,e)})),n):n},e.off=function(t,e){var n=this,s=n.hooks;if(!a(t))return s={},n;if(a(s[t]))if(a(e)){var r=s[t].length;if(0===r)delete s[t];else for(var i=0;i<r;++i)if(e===s[t][i]){s[t].splice(i,1);break}}else delete s[t];return n},e.on=function(t,e){var n=this.hooks;return a(n[t])||(n[t]=[]),a(e)&&n[t].push(e),this},t.hooks={},t}(s,W.prototype),s.attach(t,f({},W.state,r(e)?{join:e}:e||{}))):new W(t,e):s}W.state={class:"tag-picker",escape:[","],join:", ",max:9999,min:0,pattern:null,with:[]},W.version="4.0.0",D(W,"name",{value:"TagPicker"});var Z=W.prototype;function $(){var t=this["_"+W.name].state;b(this,t.class+"--focus")}function z(){var t=this["_"+W.name];t._mask;var e=t.mask,n=t.state.class;b(e,n+="--focus"),b(e,n+="-tag")}function F(){var t=this["_"+W.name],e=t._mask,n=t.mask,s=t.state,a=e.text,r=s.class;b(a,r+"__text--focus"),b(n,r+="--focus"),b(n,r+="-text")}function G(t){var e=this["_"+W.name],n=e._mask,s=e._tags,a=e.mask,r=e.state,i=n.copy,o=r.class+"__tag--active",c=[];for(var f in s)g(s[f],o)&&c.push(f);u(c)&&(a!==_(i)&&(i.value=c.join(r.join),j(a,i)),i.focus(),i.select())}function J(){var t=this,e=t["_"+W.name];e._mask.input,H((function(){return w(t),e.focus()}))}function Q(){var t=this,e=t["_"+W.name],n=e._mask,s=e.state;n.input,t.value.split(s.join).forEach((function(t){return e.let(t)})),H((function(){return w(t),e.focus()}))}function U(){var t=this["_"+W.name];t._tags;var e=t.mask,n=t.state.class;E(e,n+"--focus")}function V(){var t=this["_"+W.name],e=t._mask,n=t._tags,s=t.mask,a=t.self,r=t.state,i=e.copy,u=e.hint,o=e.input,c=e.text,f=r.class;for(var l in n)b(n[l],f+"__tag--active");w(i),E(c,f+"__text--focus"),E(s,f+="--focus"),E(s,f+="-text"),M(o),H((function(){return S(u,d(o)?"":a.placeholder)}))}function X(){this["_"+W.name].focus()}function Y(){var t=this["_"+W.name].state.class;E(this,t+"--focus")}function tt(){var t=this["_"+W.name];t._mask;var e=t.mask,n=t.state.class;E(e,n+="--focus"),E(e,n+="-tag")}D(Z,"tags",{get:function(){return o(this._tags)},set:function(t){var e=this,n=e.self,s=e.set;e._tags={},n.value="",t.forEach((function(t){return s(t)}))}}),D(Z,"value",{get:function(){var t=this.self.value;return""===t?null:t},set:function(t){this.self.value=t}}),Z._filter=function(t){var e,n,s=this.state;return t=(t||"").split(s.join).join("").trim(),(e=t,void 0===n&&(n="-"),e.replace(/[A-Z]/g,(function(t){return n+i(t)})).replace(/\W+/g,n)).replace(/^-+|-+$/g,"")};var et=!1;function nt(t){et=t.ctrlKey,t.shiftKey}function st(t){var e,n,s,a=this,r=t.key,i=t.ctrlKey,u=t.shiftKey,o=a["_"+W.name],f=o._mask,l=o._tags,v=o.mask,p=o.state,_=f.copy,m=f.text,d=a.previousElementSibling||null,g=h(a),k=p.class+"__tag--active";if(i){if(!u&&"a"===r){for(var y in l)E(l[y],k);_.value=o.value,j(v,_),_.focus(),_.select(),e=!0}}else u||b(a,k),P===r?((n=c(l).shift())&&n.focus(),e=!0):N===r?((s=c(l).pop())&&s.focus(),e=!0):O===r?(d&&d.focus(),e=!0):q===r?(g&&m!==g?g.focus():o.focus(),e=!0):B===r?(o.let(a.title),d?d.focus():o.focus(),e=!0):"Delete"===r&&(o.let(a.title),g&&m!==g?g.focus():o.focus(),e=!0);e&&R(t)}function at(t){var e=t.key,n=t.ctrlKey;t.shiftKey;var s=this["_"+W.name],a=s._mask,r=s._tags,i=s.state,u=a.copy;a.input;var o=i.class+"__tag--active";function f(){for(var t in w(u),r)b(r[t],o)}n||(P===e||O===e?(f(),c(r).shift().focus()):N===e||q===e?(f(),c(r).pop().focus()):"Escape"===e?(f(),s.focus()):(this.value.split(i.join).forEach((function(t){return s.let(t)})),s.focus()))}function rt(t){var n,s,a,r,i=this,u=t.key,o=t.keyCode,f=t.ctrlKey,l=t.shiftKey,h=i["_"+W.name],_=h._mask,g=h._tags,k=h.mask,y=h.self,b=h.state,w=_.copy,x=_.hint,A=b.class+"__tag--active";if((escape=b.escape).includes(u)||escape.includes(o))return h.set(function(t){return d(t)}(i)),S(i,""),S(x,y.placeholder),h.focus(),R(t);H((function(){return S(x,d(i)?"":y.placeholder)}));var L,K=""===function(t){var e,n=p.getSelection();if(n.rangeCount>0)return(e=n.getRangeAt(0).cloneRange()).collapse(!0),e.setStart(t,0),(e+"").slice(-1)}(i),C=null===d(i);if(P===u&&(f||C))(a=c(g).shift())&&a.focus(),n=!0;else if(N===u&&(f||C))(r=c(g).pop())&&r.focus(),n=!0;else if(O===u&&(f||K))(r=c(g).pop())&&r.focus(),n=!0;else if(B===u&&C)(r=c(g).pop())&&h.let(r.title),h.focus(),n=!0;else if("Enter"===u){var T=m(y);if(T&&e(T.requestSubmit)){var q=(L="button:not([type]),button[type=submit],input[type=image],input[type=submit]",(T||v).querySelector(L));q?T.requestSubmit(q):T.requestSubmit()}n=!0}else if(f&&!l&&"a"===u&&null===d(i)&&null!==(s=h.value)){for(var D in g)E(g[D],A);w.value=s,j(k,w),w.focus(),w.select(),n=!0}n&&R(t)}function it(){var t=this["_"+W.name],e=t._mask,n=t._tags,s=t.mask,a=t.state,r=e.copy,i=a.class+"__tag--active";et=!1;var o=[];for(var c in n)g(n[c],i)&&o.push(c);u(o)>1&&(r.value=o.join(a.join),j(s,r),r.focus(),r.select())}function ut(){var t=this,e=t.value,n=t["_"+W.name],s=n._mask,a=n.state,r=s.copy;s.input,H((function(){""!==e&&e.split(a.join).forEach((function(t){return n.let(t)})),""!==(e=t.value)&&e.split(a.join).forEach((function(t){return n.set(t)})),w(r),n.focus()}))}function ot(){var t=this,e=t["_"+W.name],n=e._mask,s=e.state,a=n.hint;H((function(){var n=d(t);null!==n&&n.split(s.join).forEach((function(t){return e.set(t)})),S(t,""),S(a,e.self.placeholder)}))}function ct(t){var e=this["_"+W.name],n=e._mask,s=e._tags,a=e.mask,r=e.state,i=n.copy,u=n.input,o=r.class+"__tag--active";if(a===_(i))if(u===t.target){var c=0;for(var f in s)g(s[f],o)&&++c;c<2&&e.focus()}else i.focus(),i.select();else e.focus();R(t)}function ft(t){var e,n,s=this,a=s["_"+W.name],r=a._mask,i=a._tags,u=a.mask,o=a.state,c=r.copy,f=o.class+"__tag--active",l=u===_(c),v=0;if(!et){for(var p in i)s!==i[p]&&(g(i[p],f)&&++v,l||b(i[p],f));w(c)}l&&v>1?(E(s,f),++v):(e=f,s.classList.toggle(e,n),g(s,f)&&++v),function(t){t&&t.stopPropagation()}(t)}function lt(t){var e=_(this),n=e["_"+W.name];n._mask.input,K("click",this,lt),n.let(e.title),n.focus(),R(t)}return Z.attach=function(n,i){var o=this;n=n||o.self,i=i||o.state,o._active=!0,o._tags={},o._value=function(t){return t.value.replace(/\r/g,"")}(n),o.self=n,o.state=i;var c=i.class,f="_"+W.name;m(n);var l=A("div",{class:c,tabindex:!I(n)&&-1});o.mask=l;var v,p,d=A("span",{class:c+"__tags"}),g=A("span",{class:c+"__text"}),k=A("input",{class:c+"__copy",tabindex:-1,type:"text"}),y=A("span",{contenteditable:!I(n)&&"true",spellcheck:"false",style:"white-space:pre;"}),b=A("span",n.placeholder+"");j(l,d),j(d,g),j(g,y),j(g,b),E(n,c+"__self"),p=l,_(v=n).insertBefore(p,h(v,!0)),C("blur",l,$),C("blur",y,F),C("contextmenu",l,G),C("copy",k,J),C("cut",k,Q),C("focus",l,Y),C("focus",n,X),C("focus",k,U),C("focus",y,V),C("keydown",l,nt),C("keydown",k,at),C("keydown",y,rt),C("keyup",l,it),C("mousedown",l,ct),C("paste",k,ut),C("paste",y,ot),C("touchstart",l,ct),n.tabIndex=-1,l[f]=o,k[f]=o,y[f]=o;var w={};if(w.copy=k,w.hint=b,w.input=y,w.of=n,w.self=l,w.tags=d,w.text=g,o._mask=w,a(i)&&t(i.with))for(var x=0,L=u(i.with);x<L;++x){var S=i.with[x];r(S)&&(S=W[S]),e(S)?S.call(o,n,i):s(S)&&e(S.attach)&&S.attach.call(o,n,i)}return o},Z.blur=function(){},Z.click=function(){},Z.detach=function(){var n=this,a=n._mask,i=n.mask,o=n.self,c=n.state,f=a.copy,l=a.input;if(n._active=!1,K("blur",l,F),K("blur",i,$),K("contextmenu",i,G),K("copy",f,J),K("cut",f,Q),K("focus",f,U),K("focus",l,V),K("focus",i,Y),K("focus",o,X),K("keydown",f,at),K("keydown",l,rt),K("keydown",i,nt),K("keydown",i,it),K("mousedown",i,ct),K("paste",f,ut),K("paste",l,ot),K("touchstart",i,ct),t(c.with))for(var v=0,p=u(c.with);v<p;++v){var h=c.with[v];r(h)&&(h=W[h]),s(h)&&e(h.detach)&&h.detach.call(n,o,c)}return o.tabIndex=null,b(o,c.class+"__self"),w(i),n._mask={of:o},n.mask=null,n},Z.focus=function(){var t=this._mask.input;return t&&t.focus(),M(t),this},Z.get=function(t){var e=this._active,n=this._tags;return!!e&&(n[t]?t:null)},Z.let=function(t){var e=this,n=e._active,s=e._tags,a=e.self,r=e.state;if(!n)return e;if(!s[t])return!1;var i=s[t],u=i.firstElementChild||null;return K("blur",i,z),K("focus",i,tt),K("keydown",i,st),K("mousedown",i,ft),K("mousedown",u,lt),K("touchstart",i,ft),K("touchstart",u,lt),w(i),delete e._tags[t],a.value=o(e._tags).join(r.join),e},Z.set=function(t){var n=this,s=n._active,a=n._filter,i=n._mask,u=n._tags,c=n.self,f=n.state,l=i.text,v=f.pattern,p=f.class;if(!s)return n;if(e(a)&&(t=a.call(n,t)),r(v)&&T(v)&&!T(v).test(t))return!1;if(""===t||u[t])return!1;var h,m,d=A("span",{class:p+="__tag",tabindex:-1,title:t}),g=A("span",{class:p+="-x",tabindex:-1});return C("blur",d,z),C("focus",d,tt),C("keydown",d,st),C("mousedown",d,ft),C("mousedown",g,lt),C("touchstart",d,ft),C("touchstart",g,lt),d["_"+W.name]=n,j(d,g),m=d,_(h=l).insertBefore(m,h),n._tags[t]=d,c.value=o(n._tags).join(f.join),n},W}));