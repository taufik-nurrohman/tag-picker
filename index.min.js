/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2021 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).TP=n()}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},n=function(t,n){return t&&u(n)&&t instanceof n},e=function(t){return"number"==typeof t},r=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||n(t,Object))},u=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},i=function(t){return"string"==typeof t},o=function n(e){if(t(e))return e.map((function(t){return n(e)}));if(r(e)){for(var u in e)e[u]=n(e[u]);return e}return!1===e?"false":null===e?"null":!0===e?"true":""+e},f=function(t,n){var e=n.indexOf(t);return-1!==e?e:null},c=function(t){return t.toLowerCase()},s=function(t){return t.length},a=function(t){return Object.keys(t)},l=function n(e){if(t(e))return e.map((function(t){return n(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(e))return function(t,n){return void 0===n&&(n=10),n?parseInt(t,n):parseFloat(t)}(e);if(r(e)){for(var u in e)e[u]=n(e[u]);return e}return"false"!==e&&("null"===e?null:"true"===e||e)},g=document,p=window,d=function(t,n,e){if(void 0===e&&(e=!0),!k(t,n))return null;var r=t.getAttribute(n);return e?l(r):r},v=function(t,n){var r=t.children;return e(n)?r[n]||null:r||[]},m=function(t){return c(t&&t.nodeName||"")||null},b=function(t){return t.nextElementSibling||null},h=function(t){return t.parentNode||null},y=function(t){return t.previousElementSibling||null},x=function(t,n){void 0===n&&(n=!0);var e="textContent";if(!w(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},k=function(t,n){return t.hasAttribute(n)},E=function(t,n){return t.classList.contains(n)},L=function(t){return null!==h(t)},w=function(t,n){return n in t},A=function(t,n){return t.removeAttribute(n),t},T=function(t,n){return t.classList.remove(n),t},R=function(n,e){if(t(e))return e.forEach((function(t){return n.classList.remove(t)})),n;if(r(e)){for(var u in e)e[u]&&n.classList.remove(u);return n}return n.className="",n},O=function(t){var n=h(t);return t.remove(),n},C=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,o(e)),t},P=function(t,n){return t.append(n),n},N=function(t,n){return t.classList.add(n),t},S=function(n,e){if(t(e))return e.forEach((function(t){return n.classList.add(t)})),n;if(r(e))for(var u in e)e[u]?n.classList.add(u):n.classList.remove(u);return n.className=e,n},K=function(t,n,e){return t=i(t)?g.createElement(t):t,r(n)&&(e=n,n=!1),i(n)&&B(t,n),r(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?C(t,r,e):A(t,r)}(t,e),t},B=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="innerHTML";return w(t,r)&&(t[r]=e?n.trim():n),t},_=function(t,n){return h(t).insertBefore(n,t),n},D=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="textContent";return w(t,r)&&(t[r]=e?n.trim():n),t},H=function(t,n,e){n.removeEventListener(t,e)},z=function(t){return t&&t.preventDefault()},F=function(t,n,e){t.forEach((function(t){return H(t,n,e)}))},I=function(t,n,e,r){void 0===r&&(r=!1),n.addEventListener(t,e,r)},M=function(t,n,e,r){void 0===r&&(r=!1),t.forEach((function(t){return I(t,n,e,r)}))},$=function(t,n){return-1!==n.indexOf(t)};var q=function(t,e){return function(t){return n(t,RegExp)}(t)?t:(t=t.replace(/\//g,"\\/"),RegExp(t,u(e)?e:"g"))};let G=p.setTimeout;const J="ArrowLeft",Q="Backspace";function U(r,o={}){if(!r)return;const l=this;if(r.TP)return;if(!n(l,U))return new U(r,o);let k=()=>r.disabled,A=()=>r.readOnly,C=d(r,"placeholder"),B=d(r,"tabindex"),{hooks:V,fire:W}=function(t){var n={};return t.hooks=n,t.fire=function(e,r){return u(n[e])?(n[e].forEach((function(n){return n.apply(t,r)})),t):t},t.off=function(e,r){if(!u(e))return n={},t;if(u(n[e]))if(u(r)){for(var i=0,o=n[e].length;i<o;++i)if(r===n[e][i]){n[e].splice(i,1);break}0===j&&delete n[e]}else delete n[e];return t},t.on=function(e,r){return u(n[e])||(n[e]=[]),u(r)&&n[e].push(r),t},t}(l);var X;l.state=o=function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];return Object.assign.apply(Object,[{}].concat(n))}(U.state,i(o)?{join:o}:o||{}),l.source=r,U.instances[r.id||r.name||(X=U.instances,s(a(X)))]=l,r.TP=1;let Y,Z,tt=o.class,nt=tt+"__",et=tt+"--",rt=function(t){var n="form";if(w(t,n)&&n===m(t.form))return t.form;for(var e=h(t);e&&n!==m(e);)e=h(e);return e||null}(r),ut=K("span",{class:tt,tabindex:!k()&&"-1"}),it=K("span",{class:nt+"tag "+nt+"text"}),ot=K("input",{class:nt+"copy",type:"text"}),ft=K("span",{contenteditable:!k()&&"true",spellcheck:"false",style:"white-space:pre;"}),ct=K("span"),st=K("span",{class:nt+"tags"}),at=0,lt={};function gt(t,n){let r=f(t,l.tags);return n&&W("get.tag",[t,r]),e(r)?t:null}function pt(){lt={};let t,n=v(st),e=s(n)-1;for(t=0;t<e;++t)E(n[t],nt+"tag--focus")&&(lt[t]=n[t])}function dt(t,n){e(n)?(n=n<0?0:n,l.tags.splice(n,0,t)):l.tags.push(t),r.value=l.tags.join(o.join)}function vt(t,n){let r=K("span",{class:nt+"tag",tabindex:!k()&&"0",title:t}),u=K("a",{class:nt+"tag-x",href:"",tabindex:"-1",target:"_top"});I("click",u,Kt),P(r,u),I("click",r,St),M(["blur","focus"],r,Ot),L(st)&&(e(n)&&l.tags[n]?_(v(st,n),r):_(it,r))}function mt(t){if(t=t?t.split(o.join):[],L(ut)){let n,e,r;for(;n=y(it);)ht(r=n.title),$(r,t)||(e=f(r,l.tags),W("change",[r,e]),W("let.tag",[r,e]))}l.tags=[],r.value="";for(let n,e=0,r=o.max;e<r&&t[e];++e)""!==(n=At(t[e]))&&(vt(n),dt(n),W("change",[n,e]),W("set.tag",[n,e]))}function bt(t){let n=f(t,l.tags);e(n)&&n>=0&&(l.tags.splice(n,1),r.value=l.tags.join(o.join))}function ht(t){let n,r=f(t,l.tags);if(e(r)&&r>=0&&(n=v(st,r))){H("click",n,St),F(["blur","focus"],n,Ot);let t=n.firstElementChild||null;t&&(H("click",t,Kt),O(t)),O(n)}}function yt(t){O(ot),t&&kt("",1)}function xt(t){P(ut,ot),ot.value=l.tags.join(o.join),t&&(ot.focus(),ot.select())}function kt(t,n){if(D(ft,t),D(ct,t?"":C),n){ft.focus();let t=g.createRange(),n=p.getSelection();t.selectNodeContents(ft),t.collapse(!1),n.removeAllRanges(),n.addRange(t)}}function Et(t){wt(t,(function(){T(this,nt+"tag--focus")}))}function jt(t){wt(t,(function(){N(this,nt+"tag--focus")}))}function Lt(){let t=Tt(x(ft)).trim();if(o.pattern&&!q(o.pattern,"").test(t))return W("not.tag",[t,-1]),void kt(t,1);if(t=At(t),kt(""),!k()&&!A()&&t)if(gt(t))W("has.tag",[t,f(t,l.tags)]);else{vt(t),dt(t);let n=s(l.tags);W("change",[t,n]),W("set.tag",[t,n])}}function wt(t,n){let e,r=v(st),u=s(r)-1;for(e=0;e<u;++e)t!==r[e]&&n.call(r[e],e)}function At(t){return Tt(l.f(t)).trim()}function Tt(t){return t=t||"",o.escape.forEach((n=>{t=t.split(n).join("")})),t}function Rt(t){"blur"===t.type?(Et(),R(ut,[et+"focus",et+"focus-self"])):S(ut,[et+"focus",et+"focus-self"])}function Ot(t){if(A())return;lt={};let n=this,e=t.type,r=n.title,u=l.tags,i=f(r,u),o=nt+"tag--";"blur"===e?Y&&!Z||(Et(n),T(n,o+"focus"),R(ut,[et+"focus",et+"focus-tag"])):(N(n,o+"focus"),S(ut,[et+"focus",et+"focus-tag"]),at=i,lt[i]=n),W(e+".tag",[r,i])}function Ct(t){let n=l.tags,e=t.type,r=nt+"text--";"blur"===e?(T(it,r+"focus"),R(ut,[et+"focus",et+"focus-text"]),Lt()):(N(it,r+"focus"),S(ut,[et+"focus",et+"focus-text"]),Et(it)),W(e,[n,s(n)])}function Pt(t){"blur"===t.type?T(ut,et+"focus"):N(ut,et+"focus")}function Nt(t){t&&ut===t.target&&ft.focus();let n=l.tags;W("click",[n,s(n)])}function St(){let t=this.title,n=l.tags;W("click.tag",[t,f(t,n)])}function Kt(t){if(!k()&&!A()){let t=h(this).title,n=f(t,l.tags);ht(t),bt(t),kt("",1),W("change",[t,n]),W("click.tag",[t,n]),W("let.tag",[t,n])}z(t)}function Bt(t){let n=t.type;"copy"===n?G((()=>yt(1))):"cut"===n?(!A()&&mt(""),G((()=>yt(1)))):"paste"===n&&G((()=>{!A()&&mt(ot.value),yt(1)})),G((()=>{let t=l.tags;W(n,[t,s(t)])}),1)}function _t(){Et(),T(ut,et+"focus-self")}function Dt(){ft.focus()}function Ht(t){if(k())return;l.tags;let n,e,r,u,i,o,f=t.key,c=t.ctrlKey,g=Y=t.shiftKey,p=nt+"tag--";if(Z="Tab"===f,!A())if(c)"a"===f&&(xt(1),jt(),pt(),z(t));else if(g||Q!==f&&"Delete"!==f){if("Home"===f)(n=v(st,0))&&(n.focus(),z(t));else if("End"===f)(n=v(st,s(l.tags)-1))&&(n.focus(),z(t));else if(J===f)if(n=v(st,at-1)){let e=E(n,p+"focus");n.focus(),z(t),g?(r=b(n),e&&T(r,p+"focus")):Et(n)}else g||Et(v(st,0));else if("ArrowRight"===f&&(n=v(st,at+1))){let e=E(n,p+"focus");it!==n||g?n.focus():kt("",1),z(t),g?(u=y(n),e&&T(u,p+"focus")):Et(n)}}else{pt(),o=lt;let r=Q===f;for(e in o)n=o[e],ht(i=n.title),bt(i);at=+(a(o)[0]||0),(n=v(st,r?at-1:at))?it===n?kt("",1):n.focus():kt("",1),z(t)}}function zt(t){!function(t){t&&t.stopPropagation()}(t),A()&&z(t);let n,e=o.escape,r=y(it),u=s(l.tags),i=o.max,f=At(x(ft)),c=t.key,a=t.ctrlKey,g="Enter"===c;t.shiftKey;let d="Tab"===c;if(G((()=>{let n=At(x(ft));D(ct,n?"":C),$(function(t){let n,e=p.getSelection();if(e.rangeCount>0)return n=e.getRangeAt(0).cloneRange(),n.collapse(!0),n.setStart(t,0),(n+"").slice(-1)}(ft),e)&&(u<i?Lt():(kt(""),W("max.tags",[i])),z(t))})),!d){if(g)return Mt()&&rt&&rt.dispatchEvent(new Event("submit",{cancelable:!0})),void z(t);if(a&&""===f&&"a"===c)return xt(1),jt(),pt(),void z(t);if(g?c="\n":d&&(c="\t"),$(c,e))return u<i?Lt():(kt(""),W("max.tags",[i])),void z(t);if(r&&""===f&&!A()){if(Q===c)return n=l.tags[u-1],ht(n),bt(n),W("change",[n,u-1]),W("let.tag",[n,u-1]),void z(t);if(J===c)return void r.focus()}}}function Ft(){Y=!1}function It(){G((()=>{k()||A()||x(ft).split(o.join).forEach((t=>{$(t,l.tags)||(vt(t),dt(t))})),kt("")}))}function Mt(t){if(k())return;let n=o.min;return Lt(),n>0&&s(l.tags)<n?(kt("",1),W("min.tags",[n]),void z(t)):1}var $t,qt;return kt(""),P(ut,st),P(it,ft),P(it,ct),P(st,it),N(r,nt+"source"),qt=ut,h($t=r).insertBefore(qt,b($t)),K(r,{tabindex:"-1"}),I("blur",ut,_t),I("click",ut,Nt),I("focus",r,Dt),I("keydown",ut,Ht),I("keydown",ft,zt),I("keyup",ut,Ft),I("paste",ft,It),M(["blur","focus"],ut,Pt),M(["blur","focus"],ot,Rt),M(["blur","focus"],ft,Ct),M(["copy","cut","paste"],ot,Bt),rt&&I("submit",rt,Mt),l.blur=()=>(!k()&&ft.blur(),l),l.click=()=>(ut.click(),Nt(),l),l.f=t=>c(t||"").replace(/[^ a-z\d-]/g,"").trim(),l.focus=()=>(k()||kt(x(ft),1),l),l.get=t=>k()?null:gt(t,1),l.input=ft,l.let=n=>{if(!k()&&!A()){let e=o.min;if(n)if(t(n))n.forEach((t=>{if(e>0&&s(l.tags)<e)return W("min.tags",[e]),l;ht(t),bt(t)}));else{if(e>0&&s(l.tags)<e)return W("min.tags",[e]),l;ht(n),bt(n)}else mt("")}return l},l.pop=()=>{if(!r.TP)return l;delete r.TP;let t=l.tags;return T(r,nt+"source"),H("blur",ut,_t),H("click",ut,Nt),H("focus",r,Dt),H("keydown",ut,Ht),H("keydown",ft,zt),H("keyup",ut,Ft),H("paste",ft,It),F(["blur","focus"],ut,Pt),F(["blur","focus"],ot,Rt),F(["blur","focus"],ft,Ct),F(["copy","cut","paste"],ot,Bt),rt&&H("submit",rt,Mt),t.forEach(ht),K(r,{tabindex:B}),O(ut),W("pop",[t])},l.self=ut,l.set=(n,e)=>{if(!n)return l;if(!k()&&!A())if(t(n))mt(n.join(o.join));else{let t=l.tags,r=o.max;gt(n)?W("has.tag",[n,f(n,t)]):s(t)<r?(vt(n,e),dt(n,e)):W("max.tags",[r])}return l},l.source=l.output=r,l.state=o,l.tags=[],mt(r.value),l}return U.instances={},U.state={class:"tag-picker",escape:[","],join:", ",max:9999,min:0,pattern:null},U.version="3.3.1",U}));