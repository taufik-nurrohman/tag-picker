/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=e()}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},e=function(t){return"function"==typeof t},n=function(t,e){return t&&a(e)&&t instanceof e},s=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||n(t,Object))},a=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},r=function(t){return"string"==typeof t},u=function(t){return t.toLowerCase()},o=function(t){return t.length},i=function(t){return Object.keys(t)},c=function(t){return Object.values(t)},f=function e(){for(var n=arguments.length,r=Array(n),u=0;u<n;u++)r[u]=arguments[u];for(var i,c=r.shift(),f=0,l=o(r);f<l;++f)for(var v in r[f])if(a(c[v]))if(t(c[v])&&t(r[f][v])){c[v]=[].concat(c[v]);for(var p=0,_=o(r[f][v]);p<_;++p)i=r[f][v][p],-1===c[v].indexOf(i)&&c[v].push(r[f][v][p])}else s(c[v])&&s(r[f][v])?c[v]=e({},c[v],r[f][v]):c[v]=r[f][v];else c[v]=r[f][v];return c},l=function e(n){if(t(n))return n.map((function(t){return e(n)}));if(s(n)){for(var a in n)n[a]=e(n[a]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},v=document,p=window,_=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},h=function(t,e){return e?t.closest(e)||null:t.parentNode||null},m=function(t){var e="form";return k(t,e)&&e===function(t){return u(t&&t.nodeName||"")||null}(t[e])?t[e]:h(t,e)},d=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!k(t,n))return!1;var s=t[n];return""!==(s=e?s.trim():s)?s:null},g=function(t,e){return t.classList.contains(e)},k=function(t,e){return e in t},y=function(t,e){return t.removeAttribute(e),t},b=function(t,e){return t.classList.remove(e),t},w=function(t){var e=h(t);return t.remove(),e},x=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,l(n)),t},j=function(t,e){return t.append(e),e},E=function(t,e){return t.classList.add(e),t},A=function(t,e,n){return t=r(t)?v.createElement(t):t,s(e)&&(n=e,e=!1),r(e)&&L(t,e),s(n)&&function(t,e){var n;for(var s in e)(n=e[s])||""===n||0===n?x(t,s,n):y(t,s)}(t,n),t},L=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var s="innerHTML";return k(t,s)&&(t[s]=n?e.trim():e),t},S=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var s="textContent";return k(t,s)&&(t[s]=n?e.trim():e),t},R=function(t,e,n){return t.classList.toggle(e,n),t};var C=function(t,e,n){e.removeEventListener(t,n)},T=function(t){return t&&t.preventDefault()},O=function(t,e,n,s){void 0===s&&(s=!1),e.addEventListener(t,n,s)},q=function(t,e){return function(t){return n(t,RegExp)}(t)?t:RegExp(t,a(e)?e:"g")},P="ArrowLeft",B="ArrowRight",N="Home",D="Backspace",H="End";function I(t,e,n){Object.defineProperty(t,e,n)}function K(t,e){return p.setTimeout(t,1)}function M(t){return t.disabled}function W(t,e){var s=this;return t?n(s,W)?(t["_"+W.name]=function(t,e){return(e=e||t).fire=function(t,e){var n=this,s=n.hooks;return a(s[t])?(s[t].forEach((function(t){return t.apply(n,e)})),n):n},e.off=function(t,e){var n=this,s=n.hooks;if(!a(t))return s={},n;if(a(s[t]))if(a(e)){var r=s[t].length;if(0===r)delete s[t];else for(var u=0;u<r;++u)if(e===s[t][u]){s[t].splice(u,1);break}}else delete s[t];return n},e.on=function(t,e){var n=this.hooks;return a(n[t])||(n[t]=[]),a(e)&&n[t].push(e),this},t.hooks={},t}(s,W.prototype),s.attach(t,f({},W.state,r(e)?{join:e}:e||{}))):new W(t,e):s}W.state={class:"tag-picker",escape:[","],join:", ",max:9999,min:0,pattern:null,with:[]},W.version="4.0.0",I(W,"name",{value:"TagPicker"});var Z=W.prototype;function $(){var t=this["_"+W.name].state;b(this,t.class+"--focus")}function z(){var t=this["_"+W.name];t._mask;var e=t.mask,n=t.state.class;b(e,n+="--focus"),b(e,n+="-tag")}function F(){var t=this["_"+W.name],e=t._mask,n=t.mask,s=t.state,a=e.text,r=s.class;b(a,r+"__text--focus"),b(n,r+="--focus"),b(n,r+="-text")}function G(t){var e=this["_"+W.name],n=e._mask,s=e._tags,a=e.mask,r=e.state,u=n.copy,i=r.class,c=[];for(var f in s)g(s[f],i+"__tag--selected")&&c.push(f);o(c)&&(a!==h(u)&&(u.value=c.join(r.join),j(a,u)),u.focus(),u.select())}function J(){var t=this,e=t["_"+W.name]._mask.input;K((function(){return w(t),e.focus()}))}function Q(){var t=this,e=t["_"+W.name],n=e._mask,s=e.state,a=n.input;t.value.split(s.join).forEach((function(t){return e.let(t)})),K((function(){return w(t),a.focus()}))}function U(){var t=this["_"+W.name];t._tags;var e=t.mask,n=t.state.class;E(e,n+"--focus"),E(e,n+"--select")}function V(){var t,e,n,s=this["_"+W.name],a=s._mask,r=s._tags,u=s.mask,o=s.self,i=s.state,c=a.copy,f=a.hint,l=a.input,_=a.text,h=i.class;for(var m in r)b(r[m],h+"__tag--selected");w(c),b(u,h+"--select"),E(_,h+"__text--focus"),E(u,h+="--focus"),E(u,h+="-text"),t=l,(n=v.createRange()).selectNodeContents(t),n.collapse(!1),(e=p.getSelection()).removeAllRanges(),e.addRange(n),K((function(){return S(f,d(l)?"":o.placeholder)}))}function X(){this["_"+W.name].focus()}function Y(){var t=this["_"+W.name].state.class;E(this,t+"--focus")}function tt(){var t=this["_"+W.name];t._mask;var e=t.mask,n=t.state.class;E(e,n+="--focus"),E(e,n+="-tag")}I(Z,"tags",{get:function(){return i(this._tags)},set:function(t){var e=this,n=e.self,s=e.set;e._tags={},n.value="",t.forEach((function(t){return s(t)}))}}),I(Z,"value",{get:function(){var t=this.self.value;return""===t?null:t},set:function(t){this.self.value=t}}),Z._filter=function(t){var e,n,s=this.state;return t=(t||"").split(s.join).join("").trim(),(e=t,void 0===n&&(n="-"),e.replace(/[A-Z]/g,(function(t){return n+u(t)})).replace(/\W+/g,n)).replace(/^-+|-+$/g,"")};var et=!1,nt=!1;function st(t){et=t.ctrlKey,nt=t.shiftKey}function at(t){var e,n,s,a=this,r=t.key,u=a["_"+W.name],o=u._mask,i=u._tags,f=u.mask,l=u.state,v=o.copy,p=o.text,h=a.previousElementSibling||null,m=_(a),d=l.class;if(et){if(!nt&&"a"===r){for(var g in i)E(i[g],d+"__tag--selected");v.value=u.value,j(f,v),v.focus(),v.select(),e=!0}}else b(a,d+"__tag--selected"),N===r?((n=c(i).shift())&&n.focus(),e=!0):H===r?((s=c(i).pop())&&s.focus(),e=!0):P===r?(h&&h.focus(),e=!0):B===r?(m&&p!==m?m.focus():u.focus(),e=!0):D===r?(u.let(a.title),h?h.focus():u.focus(),e=!0):"Delete"===r&&(u.let(a.title),m&&p!==m?m.focus():u.focus(),e=!0);e&&T(t)}function rt(t){var e=t.key,n=this["_"+W.name],s=n._mask,a=n._tags,r=n.state,u=s.copy,o=s.input,i=r.class;function f(){for(var t in w(u),a)b(a[t],i+"__tag--selected")}et||(N===e||P===e?(f(),c(a).shift().focus()):H===e||B===e?(f(),c(a).pop().focus()):"Escape"===e?(f(),o.focus()):(this.value.split(r.join).forEach((function(t){return n.let(t)})),o.focus()))}function ut(t){var n,s,a,r,u=this,o=t.key,i=t.keyCode,f=u["_"+W.name],l=f._mask,_=f._tags,h=f.mask,g=f.self,k=f.state,y=l.copy,b=l.hint,w=k.class;if((escape=k.escape).includes(o)||escape.includes(i))return f.set(function(t){return d(t)}(u)),S(u,""),S(b,g.placeholder),f.focus(),T(t);K((function(){return S(b,d(u)?"":g.placeholder)}));var x,A=""===function(t){var e,n=p.getSelection();if(n.rangeCount>0)return(e=n.getRangeAt(0).cloneRange()).collapse(!0),e.setStart(t,0),(e+"").slice(-1)}(u),L=null===d(u);if(N===o&&(et||L))(a=c(_).shift())&&a.focus(),n=!0;else if(H===o&&(et||L))(r=c(_).pop())&&r.focus(),n=!0;else if(P===o&&(et||A))(r=c(_).pop())&&r.focus(),n=!0;else if(D===o&&L)(r=c(_).pop())&&f.let(r.title),f.focus(),n=!0;else if("Enter"===o){var R=m(g);if(R&&e(R.requestSubmit)){var C=(x="button:not([type]),button[type=submit],input[type=image],input[type=submit]",(R||v).querySelector(x));C?R.requestSubmit(C):R.requestSubmit()}n=!0}else if(et&&!nt&&"a"===o&&null===d(u)&&null!==(s=f.value)){for(var O in _)E(_[O],w+"__tag--selected");y.value=s,j(h,y),y.focus(),y.select(),n=!0}n&&T(t)}function ot(){var t=this["_"+W.name],e=t._mask,n=t._tags,s=t.mask,a=t.state,r=e.copy,u=a.class;et=nt=!1;var i=[];for(var c in n)g(n[c],u+"__tag--selected")&&i.push(c);o(i)>1&&(r.value=i.join(a.join),j(s,r),r.focus(),r.select())}function it(){var t=this,e=t.value,n=t["_"+W.name],s=n._mask,a=n.state,r=s.copy,u=s.input;K((function(){""!==e&&e.split(a.join).forEach((function(t){return n.let(t)})),""!==(e=t.value)&&e.split(a.join).forEach((function(t){return n.set(t)})),w(r),u.focus()}))}function ct(){var t=this,e=t["_"+W.name],n=e._mask,s=e.state,a=n.hint;K((function(){var n=d(t);null!==n&&n.split(s.join).forEach((function(t){return e.set(t)})),S(t,""),S(a,e.self.placeholder)}))}function ft(t){var e=this["_"+W.name],n=e._mask,s=e._tags,a=e.mask,r=e.state,u=n.copy,o=n.input,i=r.class;if(a===h(u))if(o===t.target){var c=0;for(var f in s)g(s[f],i+"__tag--selected")&&++c;c<2&&o.focus()}else u.focus(),u.select();else o.focus();T(t)}function lt(t){var e=this,n=e["_"+W.name],s=n._mask,a=n._tags,r=n.mask,u=n.state,o=s.copy,i=u.class+"__tag--selected",c=r===h(o),f=0;if(!et){for(var l in a)e!==a[l]&&(g(a[l],i)&&++f,c||b(a[l],i));w(o)}c&&f>1?(E(e,i),++f):(R(e,i),g(e,i)&&++f),R(r,u.class+"--select",f>0),function(t){t&&t.stopPropagation()}(t)}function vt(t){var e=h(this),n=e["_"+W.name],s=n._mask.input;C("click",this,vt),n.let(e.title),s.focus(),T(t)}return Z.attach=function(n,u){var i=this;n=n||i.self,u=u||i.state,i._active=!0,i._tags={},i._value=function(t){return t.value.replace(/\r/g,"")}(n),i.self=n,i.state=u;var c=u.class,f="_"+W.name;m(n);var l=A("div",{class:c,tabindex:!M(n)&&-1});i.mask=l;var v,p,d=A("span",{class:c+"__tags"}),g=A("span",{class:c+"__text"}),k=A("input",{class:c+"__copy",tabindex:-1,type:"text"}),y=A("span",{contenteditable:!M(n)&&"true",spellcheck:"false",style:"white-space:pre;"}),b=A("span",n.placeholder+"");j(l,d),j(d,g),j(g,y),j(g,b),E(n,c+"__self"),p=l,h(v=n).insertBefore(p,_(v,!0)),O("blur",l,$),O("blur",y,F),O("contextmenu",l,G),O("copy",k,J),O("cut",k,Q),O("focus",l,Y),O("focus",n,X),O("focus",k,U),O("focus",y,V),O("keydown",l,st),O("keydown",k,rt),O("keydown",y,ut),O("keyup",l,ot),O("mousedown",l,ft),O("paste",k,it),O("paste",y,ct),O("touchstart",l,ft),n.tabIndex=-1,l[f]=i,k[f]=i,y[f]=i;var w={};if(w.copy=k,w.hint=b,w.input=y,w.of=n,w.self=l,w.tags=d,w.text=g,i._mask=w,a(u)&&t(u.with))for(var x=0,L=o(u.with);x<L;++x){var S=u.with[x];r(S)&&(S=W[S]),e(S)?S.call(i,n,u):s(S)&&e(S.attach)&&S.attach.call(i,n,u)}return i},Z.blur=function(){},Z.click=function(){},Z.detach=function(){var n=this,a=n._mask,u=n.mask,i=n.self,c=n.state,f=a.copy,l=a.input;if(n._active=!1,C("blur",l,F),C("blur",u,$),C("contextmenu",u,G),C("copy",f,J),C("cut",f,Q),C("focus",f,U),C("focus",l,V),C("focus",u,Y),C("focus",i,X),C("keydown",f,rt),C("keydown",l,ut),C("keydown",u,st),C("keydown",u,ot),C("mousedown",u,ft),C("paste",f,it),C("paste",l,ct),C("touchstart",u,ft),t(c.with))for(var v=0,p=o(c.with);v<p;++v){var _=c.with[v];r(_)&&(_=W[_]),s(_)&&e(_.detach)&&_.detach.call(n,i,c)}return i.tabIndex=null,b(i,c.class+"__self"),w(u),n._mask={of:i},n.mask=null,n},Z.focus=function(){var t=this._mask.input;return t&&t.focus(),this},Z.get=function(t){var e=this._active,n=this._tags;return!!e&&(n[t]?t:null)},Z.let=function(t){var e=this,n=e._active,s=e._tags,a=e.self,r=e.state;if(!n)return e;if(!s[t])return!1;var u=s[t],o=u.firstElementChild||null;return C("blur",u,z),C("focus",u,tt),C("keydown",u,at),C("mousedown",u,lt),C("mousedown",o,vt),C("touchstart",u,lt),C("touchstart",o,vt),w(u),delete e._tags[t],a.value=i(e._tags).join(r.join),e},Z.set=function(t){var n=this,s=n._active,a=n._filter,u=n._mask,o=n._tags,c=n.self,f=n.state,l=u.text,v=f.pattern,p=f.class;if(!s)return n;if(e(a)&&(t=a.call(n,t)),r(v)&&q(v)&&!q(v).test(t))return!1;if(""===t||o[t])return!1;var _,m,d=A("span",{class:p+="__tag",tabindex:-1,title:t}),g=A("span",{class:p+="-x",tabindex:-1});return O("blur",d,z),O("focus",d,tt),O("keydown",d,at),O("mousedown",d,lt),O("mousedown",g,vt),O("touchstart",d,lt),O("touchstart",g,vt),d["_"+W.name]=n,j(d,g),m=d,h(_=l).insertBefore(m,_),n._tags[t]=d,c.value=i(n._tags).join(f.join),n},W}));