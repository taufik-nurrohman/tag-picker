/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2022 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).TP=n()}(this,(function(){"use strict";var t=function(t,n){return-1!==n.indexOf(t)},n=function(t){return Array.isArray(t)},e=function(t,n){return t&&u(n)&&t instanceof n},r=function(t){return"number"==typeof t},i=function(t,n){return void 0===n&&(n=!0),"object"==typeof t&&(!n||e(t,Object))},u=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},o=function(t){return"string"==typeof t},f=function(t,n){var e=n.indexOf(t);return-1!==e?e:null},c=function(t){return t.toLowerCase()},s=function(t){return t.length},a=function(t){return Object.keys(t)},l=function t(e){if(n(e))return e.map((function(n){return t(n)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(e))return function(t,n){return void 0===n&&(n=10),n?parseInt(t,n):parseFloat(t)}(e);if(i(e)){for(var r in e)e[r]=t(e[r]);return e}return"false"!==e&&("null"===e?null:"true"===e||e)},g=function e(){for(var r=arguments.length,o=Array(r),f=0;f<r;f++)o[f]=arguments[f];for(var c=o.shift(),a=0,l=s(o);a<l;++a)for(var g in o[a])if(u(c[g]))if(n(c[g])&&n(o[a][g])){c[g]=[].concat(c[g]);for(var d=0,p=s(o[a][g]);d<p;++d)t(o[a][g][d],c[g])||c[g].push(o[a][g][d])}else i(c[g])&&i(o[a][g])?c[g]=e({},c[g],o[a][g]):c[g]=o[a][g];else c[g]=o[a][g];return c},d=function t(e){if(n(e))return e.map((function(n){return t(e)}));if(i(e)){for(var r in e)e[r]=t(e[r]);return e}return!1===e?"false":null===e?"null":!0===e?"true":""+e},p=document,v=window,m=function(t,n,e){if(void 0===e&&(e=!0),!E(t,n))return null;var r=t.getAttribute(n);return e?l(r):r},h=function(t,n){var e=t.children;return r(n)?e[n]||null:e||[]},b=function(t,n){return n?t.closest(n)||null:t.parentNode||null},y=function(t){var n="form";return A(t,n)&&n===function(t){return c(t&&t.nodeName||"")||null}(t.form)?t.form:b(t,n)},k=function(t){return t.previousElementSibling||null},x=function(t,n){void 0===n&&(n=!0);var e="textContent";if(!A(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},E=function(t,n){return t.hasAttribute(n)},L=function(t,n){return t.classList.contains(n)},w=function(t,n){return null!==b(t,n)},A=function(t,n){return n in t},T=function(t,n){return t.removeAttribute(n),t},R=function(t,n){return t.classList.remove(n),t},P=function(t,e){if(n(e))return e.forEach((function(n){return t.classList.remove(n)})),t;if(i(e)){for(var r in e)e[r]&&t.classList.remove(r);return t}return t.className="",t},C=function(t){var n=b(t);return t.remove(),n},S=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,d(e)),t},N=function(t,n){return t.append(n),n},O=function(t,n){return t.classList.add(n),t},K=function(t,e){if(n(e))return e.forEach((function(n){return t.classList.add(n)})),t;if(i(e))for(var r in e)e[r]?t.classList.add(r):t.classList.remove(r);return t.className=e,t},B=function(t,n,e){return t=o(t)?p.createElement(t):t,i(n)&&(e=n,n=!1),o(n)&&_(t,n),i(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?S(t,r,e):T(t,r)}(t,e),t},_=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="innerHTML";return A(t,r)&&(t[r]=e?n.trim():n),t},D=function(t,n){return b(t).insertBefore(n,t),n},H=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="textContent";return A(t,r)&&(t[r]=e?n.trim():n),t},z=function(t,n){return function(){var e=arguments,r=this;setTimeout((function(){return t.apply(r,e)}),n)}};var F=function(t,n,e){n.removeEventListener(t,e)},I=function(t){return t&&t.preventDefault()},M=function(t,n,e){t.forEach((function(t){return F(t,n,e)}))},$=function(t,n,e,r){void 0===r&&(r=!1),n.addEventListener(t,e,r)},q=function(t,n,e,r){void 0===r&&(r=!1),t.forEach((function(t){return $(t,n,e,r)}))},G=function(t,n){return function(t){return e(t,RegExp)}(t)?t:(t=t.replace(/\//g,"\\/"),RegExp(t,u(n)?n:"g"))};const J="ArrowLeft",Q="Home",U="Backspace",V="Tab";function W(i,l={}){const d=this;if(!i)return d;if(i.TP)return i.TP;if(!e(d,W))return new W(i,l);let E=()=>i.disabled,A=()=>i.readOnly,T=m(i,"placeholder"),S=m(i,"tabindex"),{hooks:_,fire:X}=function(t){var n={};return t.hooks=n,t.fire=function(e,r){return u(n[e])?(n[e].forEach((function(n){return n.apply(t,r)})),t):t},t.off=function(e,r){if(!u(e))return n={},t;if(u(n[e]))if(u(r)){for(var i=0,o=n[e].length;i<o;++i)if(r===n[e][i]){n[e].splice(i,1);break}0===j&&delete n[e]}else delete n[e];return t},t.on=function(e,r){return u(n[e])||(n[e]=[]),u(r)&&n[e].push(r),t},t}(d);var Y;d.state=l=g({},W.state,o(l)?{join:l}:l||{}),d.source=i,W.instances[i.id||i.name||(Y=W.instances,s(a(Y)))]=d,i.TP=d;let Z,tt,nt,et=l.class,rt=et+"__",it=et+"--",ut=y(i),ot=B("div",{class:et,tabindex:!E()&&-1}),ft=B("span",{class:rt+"tag "+rt+"input"}),ct=B("input",{class:rt+"copy",tabindex:-1,type:"text"}),st=B("span",{contenteditable:!E()&&"true",spellcheck:"false",style:"white-space:pre;"}),at=B("span"),lt=B("span",{class:rt+"tags"}),gt=0,dt={};function pt(t,n){let e=f(t,d.tags);return n&&X("get.tag",[t,e]),r(e)?t:null}function vt(){dt={};let t,n=h(lt),e=s(n)-1;for(t=0;t<e;++t)L(n[t],rt+"tag--selected")&&(dt[t]=n[t])}function mt(t,n){r(n)?(n=n<0?0:n,d.tags.splice(n,0,t)):d.tags.push(t),i.value=d.tags.join(l.join)}function ht(t,n){let e=B("span",{class:rt+"tag",tabindex:!E()&&!A()&&0,title:t}),i=B("a",{class:rt+"tag-x",href:"",tabindex:-1,target:"_top"});$("click",i,_t),N(e,i),$("click",e,Bt),q(["blur","focus"],e,St),w(lt)&&(r(n)&&d.tags[n]?D(h(lt,n),e):D(ft,e))}function bt(n){if(n=n?n.split(l.join):[],w(ot)){let e,r,i;for(;e=k(ft);)kt(i=e.title),t(i,n)||(r=f(i,d.tags),X("change",[i,r]),X("let.tag",[i,r]))}d.tags=[],i.value="";for(let t,e=0,r=l.max;e<r&&n[e];++e)""!==(t=Rt(n[e]))&&(ht(t),mt(t),X("change",[t,e]),X("set.tag",[t,e]))}function yt(t){let n=f(t,d.tags);r(n)&&n>=0&&(d.tags.splice(n,1),i.value=d.tags.join(l.join))}function kt(t){let n,e=f(t,d.tags);if(r(e)&&e>=0&&(n=h(lt,e))){F("click",n,Bt),M(["blur","focus"],n,St);let t=n.firstElementChild||null;t&&(F("click",t,_t),C(t)),C(n)}}function xt(t){C(ct),t&&jt("",1)}function Et(t){N(ot,ct),ct.value=d.tags.join(l.join),t&&(ct.focus(),ct.select())}function jt(t,n){if(H(st,t),H(at,t?"":T),n){st.focus();let t=p.createRange(),n=v.getSelection();t.selectNodeContents(st),t.collapse(!1),n.removeAllRanges(),n.addRange(t)}}function Lt(t){Tt(t,(function(){R(this,rt+"tag--selected")}))}function wt(t){Tt(t,(function(){O(this,rt+"tag--selected")}))}function At(){if(E()||A())return;let t=Pt(x(st)).trim(),n=l.pattern;if(n&&t&&!G(n,"").test(t))return X("not.tag",[t,-1]),void jt(t,1);if(jt(""),t=Rt(t))if(pt(t))X("has.tag",[t,f(t,d.tags)]);else{ht(t),mt(t);let n=s(d.tags);X("change",[t,n]),X("set.tag",[t,n])}}function Tt(t,n){let e,r=h(lt),i=s(r)-1;for(e=0;e<i;++e)t!==r[e]&&n.call(r[e],e)}function Rt(t){return Pt(d.f(t)).trim()}function Pt(t){return t=t||"",l.escape.forEach((n=>{t=t.split(n).join("")})),t}function Ct(t){"blur"===t.type?(Lt(),P(ot,[it+"focus",it+"focus-self"])):K(ot,[it+"focus",it+"focus-self"])}function St(t){if(A())return;dt={};let n=this,e=t.type,r=n.title,i=d.tags,u=f(r,i),o=rt+"tag--";"blur"===e?(!Z&&!tt||tt&&nt)&&(Lt(n),R(n,o+"selected"),P(ot,[it+"focus",it+"focus-tag"])):(O(n,o+"selected"),K(ot,[it+"focus",it+"focus-tag"]),gt=u,dt[u]=n),X(e+".tag",[r,u])}function Nt(t){let n=d.tags,e=t.type,r=rt+"text--";R(ot,it+"focus-tag"),"blur"===e?(R(ft,r+"focus"),P(ot,[it+"focus",it+"focus-input"]),At()):(O(ft,r+"focus"),K(ot,[it+"focus",it+"focus-input"]),Lt(ft)),X(e,[n,s(n)])}function Ot(t){"blur"===t.type?R(ot,it+"focus"):O(ot,it+"focus")}function Kt(t){t&&ot===t.target&&st.focus();let n=d.tags;X("click",[n,s(n)])}function Bt(){let t=this.title,n=d.tags;X("click.tag",[t,f(t,n)])}function _t(t){if(!E()&&!A()){let t=b(this).title,n=f(t,d.tags);kt(t),yt(t),jt("",1),X("change",[t,n]),X("click.tag",[t,n]),X("let.tag",[t,n])}I(t)}function Dt(t){let n=t.type;"copy"===n?z((()=>xt(1)))():"cut"===n?(!A()&&bt(""),z((()=>xt(1)))()):"paste"===n&&z((()=>{!A()&&bt(ct.value),xt(1)}))(),z((()=>{let t=d.tags;X(n,[t,s(t)])}),1)()}function Ht(){Lt(),R(ot,it+"focus-self")}function zt(){st.focus()}function Ft(t){if(E()||A())return;d.tags;let n,e,r,i,u,o,f=t.key,c=Z=t.ctrlKey,l=tt=t.shiftKey,g=rt+"tag--";if(nt=V===f,!c){if(!l&&(U===f||"Delete"===f)){vt(),o=dt;let r=U===f;for(e in o)n=o[e],kt(u=n.title),yt(u);return gt=+(a(o)[0]||0),(n=h(lt,r?gt-1:gt))?ft===n?jt("",1):n.focus():jt("",1),void I(t)}if(Q===f)return void((n=h(lt,0))&&(n.focus(),I(t)));if("End"===f&&(n=h(lt,s(d.tags)-1)))return n.focus(),void I(t);if(J===f){if(n=h(lt,gt-1)){let e=L(n,g+"selected");return n.focus(),I(t),l?(r=n.nextElementSibling||null,void(e&&R(r,g+"selected"))):void Lt(n)}if(!l)return void Lt(h(lt,0))}if("ArrowRight"===f&&(n=h(lt,gt+1))){let e=L(n,g+"selected");return ft!==n||l?n.focus():jt("",1),I(t),l?(i=k(n),void(e&&R(i,g+"selected"))):void Lt(n)}}"a"===f&&(Et(1),wt(),vt(),I(t))}function It(n){!function(t){t&&t.stopPropagation()}(n),A()&&V!==n.key&&I(n);let e,r=l.escape,i=k(ft),u=s(d.tags),o=l.max,f=Rt(x(st)),c=n.key,a=Z=n.ctrlKey,g="Enter"===c;tt=n.shiftKey;let p=nt=V===c;if(g&&(c="\n"),p&&(c="\t"),z((()=>{let e=Rt(x(st));H(at,e?"":T),t(function(t){let n,e=v.getSelection();if(e.rangeCount>0)return n=e.getRangeAt(0).cloneRange(),n.collapse(!0),n.setStart(t,0),(n+"").slice(-1)}(st),r)&&(u<o?At():(jt(""),X("max.tags",[o])),I(n))}))(),""===f&&Q===c&&(e=h(lt,0)))return e.focus(),void I(n);if(""===f&&"End"===c&&(e=h(lt,s(d.tags)-1)))return e.focus(),void I(n);if(a&&""===f&&"a"===c)return Et(1),wt(),vt(),void I(n);if(t(c,r))return u<o?At():(jt(""),X("max.tags",[o])),void I(n);if(!p){if(!a&&g)return qt()&&ut&&ut.dispatchEvent(new Event("submit",{cancelable:!0})),void I(n);if(i&&""===f&&!A()){if(U===c)return e=d.tags[u-1],kt(e),yt(e),X("change",[e,u-1]),X("let.tag",[e,u-1]),void I(n);if(J===c)return void i.focus()}}}function Mt(){Z=tt=!1}function $t(){z((()=>{E()||A()||x(st).split(l.join).forEach((n=>{t(n,d.tags)||(ht(n),mt(n))})),jt("")}))()}function qt(t){if(E())return;let n=l.min;return At(),n>0&&s(d.tags)<n?(jt("",1),X("min.tags",[n]),void I(t)):1}return jt(""),N(ot,lt),N(ft,st),N(ft,at),N(lt,ft),O(i,rt+"source"),b(i).insertBefore(ot,i.nextSibling),B(i,{tabindex:-1}),$("blur",ot,Ht),$("click",ot,Kt),$("focus",i,zt),$("keydown",ot,Ft),$("keydown",st,It),$("keyup",ot,Mt),$("paste",st,$t),q(["blur","focus"],ot,Ot),q(["blur","focus"],ct,Ct),q(["blur","focus"],st,Nt),q(["copy","cut","paste"],ct,Dt),ut&&$("submit",ut,qt),d.blur=()=>(!E()&&st.blur(),d),d.click=()=>(ot.click(),Kt(),d),d.f=t=>c(t||"").replace(/[^ a-z\d-]/g,"").trim(),d.focus=()=>(E()||jt(x(st),1),d),d.get=t=>E()?null:pt(t,1),d.input=st,d.let=t=>{if(!E()&&!A()){let e=l.min;if(t)if(n(t))t.forEach((t=>{if(e>0&&s(d.tags)<e)return X("min.tags",[e]),d;kt(t),yt(t)}));else{if(e>0&&s(d.tags)<e)return X("min.tags",[e]),d;kt(t),yt(t)}else bt("")}return d},d.pop=()=>{if(!i.TP)return d;delete i.TP;let t=d.tags;return R(i,rt+"source"),F("blur",ot,Ht),F("click",ot,Kt),F("focus",i,zt),F("keydown",ot,Ft),F("keydown",st,It),F("keyup",ot,Mt),F("paste",st,$t),M(["blur","focus"],ot,Ot),M(["blur","focus"],ct,Ct),M(["blur","focus"],st,Nt),M(["copy","cut","paste"],ct,Dt),ut&&F("submit",ut,qt),t.forEach(kt),B(i,{tabindex:S}),C(ot),X("pop",[t])},d.self=ot,d.set=(t,e)=>{if(!t)return d;if(!E()&&!A())if(n(t))bt(t.join(l.join));else{let n=d.tags,r=l.max;pt(t)?X("has.tag",[t,f(t,n)]):s(n)<r?(ht(t,e),mt(t,e)):X("max.tags",[r])}return d},d.source=d.output=i,d.state=l,d.tags=[],bt(i.value),d}return W.instances={},W.state={class:"tag-picker",escape:[","],join:", ",max:9999,min:0,pattern:null},W.version="3.4.10",W}));