/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2025 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=e()}(this,(function(){"use strict";function t(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function e(e,n,r){if(n&&!Array.isArray(n)&&"number"==typeof n.length){var i=n.length;return t(n,r<i?r:i)}return e(n,r)}function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,u,a,o=[],f=!0,s=!1;try{if(u=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;f=!1}else for(;!(f=(r=u.call(n)).done)&&(o.push(r.value),o.length!==e);f=!0);}catch(t){s=!0,i=t}finally{try{if(!f&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw i}}return o}}(t,e)||r(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}var i=function(t){return Array.isArray(t)},u=function(t){return void 0!==t},a=function(t){return"function"==typeof t},o=function(t,e,n){return!(!t||"object"!=typeof t)&&(n?c(e)&&c(t.constructor)&&e===t.constructor:c(e)&&t instanceof e)},f=function(t){return"number"==typeof t},s=function(t,e){return void 0===e&&(e=!0),!(!t||"object"!=typeof t)&&(!e||o(t,Object,1))},c=function(t){return u(t)&&!function(t){return null===t}(t)},l=function(t){return"string"==typeof t},v=function(t,e){return-1!==e.indexOf(t)},p=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var r=e.shift(),u=0,a=g(e);u<a;++u)for(var o in e[u])if(c(r[o]))if(i(r[o])&&i(e[u][o])){r[o]=[].concat(r[o]);for(var f=0,l=g(e[u][o]);f<l;++f)v(e[u][o][f],r[o])||r[o].push(e[u][o][f])}else s(r[o])&&s(e[u][o])?r[o]=p({},r[o],e[u][o]):r[o]=e[u][o];else r[o]=e[u][o];return r},h=function(t){if(i(t))return t.map((function(e){return h(t)}));if(s(t)){for(var e in t)t[e]=h(t[e]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},_=function(t){return t.replace(/[-_.](\w)/g,(function(t,e){return d(e)}))},d=function(t){return t.toUpperCase()},g=function(t){return t.length},m=function(t){if(i(t))return t.map((function(t){return m(t)}));if(s(t)){for(var e in t)t[e]=m(t[e]);return t}return l(t)&&function(t){return/^[+-]?(?:\d*\.)?\d+$/.test(t+"")}(t)?"0"===t[0]&&-1===t.indexOf(".")?t:function(t,e){return void 0===e&&(e=10),e?parseInt(t,e):parseFloat(t)}(t):"false"!==t&&("null"===t?null:"true"===t||t)},y=function(t,e){for(var n,r=0,i=g(t);r<i;++r)if(-1!==(n=e(t[r],r))){if(0===n)break}else t.splice(r,1);return t},b=function(t,i){for(var u,a=function(t){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=r(t))||t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t);!(u=a()).done;){var o=e(n,u.value,2),f=o[0],s=o[1];if(-1!==(s=i(s,f))){if(0===s)break}else A(f,t)}return t},k=function(t,e){var n;for(var r in t)if(-1!==(n=e(t[r],r))){if(0===n)break}else delete t[r];return t},x=function(t){return w(t,L)||null},w=function(t,e){return e.get(t)},j=function(t,e){return e.has(t)},A=function(t,e){return e.delete(t)},S=function(t,e){return E(t,e,L)},E=function(t,e,n){return n.set(t,e)},T=function(t){var e=[];return b(t,(function(t,n){e.push(n)})),e},D=function(t){return R(t).shift()},C=function(t){return R(t).pop()},R=function(t){var e=[];return b(t,(function(t){e.push(t)})),e},L=new WeakMap;function O(t){return Array.from(t)}var I=document,N=window,q=function(t,e,n){return z(t,e||0,n)},M=function(t,e){return t["first"+(e?"":"Element")+"Child"]||null},z=function(t,e,n){var r=O(t["child"+(n?"Nodes":"ren")]);return f(e)?r[e]||null:r},B=function(t,e,n){var r=function(t,e,n){if(void 0===n&&(n=!0),!W(t,e))return null;var r=t.getAttribute(e);return n?m(r):r}(t,"data-"+e,n);return r},K=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},P=function(t,e){return e?t.closest(e)||null:t.parentNode||null},H=function(t){var e="form";return Q(t,e)&&e===function(t){return(t&&t.nodeName||"").toLowerCase()||null}(t[e])?t[e]:P(t,e)},F=function(t,e){return t.previousElementSibling||null},U=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!Q(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},$=function(t){return t&&t.nodeType||null},J=function(t,e){var n=(t.value||"").replace(/\r?\n|\r/g,"\n");return""!==n?n:null},W=function(t,e){return t.hasAttribute(e)},G=function(t,e){return t.classList.contains(e)},Q=function(t,e){return e in t},V=function(t){return t.disabled},X=function(t,e){return t.removeAttribute(e),t},Y=function(t,e){return t.classList.remove(e),t},Z=function(t){var e=P(t);return t.remove(),e},tt=function(t,e){return k(e,(function(e,n){e||""===e||0===e?function(t,e,n){et(t,"aria-"+e,!0===n?"true":n)}(t,n,e):function(t,e){X(t,"aria-"+e)}(t,n)})),t},et=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,h(n)),t},nt=function(t,e){return t.append(e),e},rt=function(t,e){return t.classList.add(e),t},it=function(t,e){return i(e)?(y(e,(function(e){return rt(t,e)})),t):s(e)?(k(e,(function(e,n){return e?rt(t,n):Y(t,n)})),t):(t.className=e,t)},ut=function(t,e){return k(e,(function(e,n){e||""===e||0===e?at(t,n,e):function(t,e){X(t,"data-"+e)}(t,n)})),t},at=function(t,e,n){return(i(n)||s(n))&&(n=JSON.stringify(n)),et(t,"data-"+e,!0===n?"true":n)},ot=function(t,e,n,r){return t=l(t)?I.createElement(t,l(r)?{is:r}:r):t,i(e)&&g(e)?(!function(t){var e="innerHTML";Q(t,e)&&(t[e]="")}(t),y(e,(function(t){return nt(l(t)?ft(t):t)}))):s(e)&&(n=e,e=!1),l(e)&&st(t,e),s(n)?(function(t,e){k(e,(function(e,n){return"aria"===n&&s(e)?(tt(t,e),1):"class"===n?(it(t,e),1):"data"===n&&s(e)?(ut(t,e),1):"style"===n&&s(e)?(lt(t,e),1):void(e||""===e||0===e?et(t,n,e):X(t,n))}))}(t,n),t):t},ft=function(t){return l(t)&&(t=I.createTextNode(t)),t},st=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="innerHTML";return Q(t,r)&&(t[r]=n?e.trim():e),t},ct=function(t,e){return P(t).insertBefore(e,t),e},lt=function(t,e){return k(e,(function(e,n){e||""===e||0===e?function(t,e,n){f(n)&&(n+="px"),t.style[_(e)]=h(n)}(t,n,e):function(t,e){t.style[_(e)]=null}(t,n)})),t},vt=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="textContent";return Q(t,r)&&(t[r]=n?e.trim():e),t},pt=function(t,e,n){return t.classList.toggle(e,n),t},ht=function(t,e){return function(){var n=arguments,r=this;setTimeout((function(){return t.apply(r,n)}),e)}};var _t=function(t,e,n){e.removeEventListener(t,n)},dt=function(t){return t&&t.preventDefault()},gt=function(t,e,n,r){void 0===r&&(r=!1),e.addEventListener(t,n,r)},mt=function(){return I.getSelection()},yt=function(){return I.createRange()},bt=function(t,e){return(e=e||mt()).empty(),e},kt=function(t,e,n){var r=0,i=yt();i.setStart(t,0),i.collapse(!0);for(var u,a,o,f=[t];!u&&(o=f.pop());)if(3===$(o)){var s=r+g(o);!a&&e[0]>=r&&e[0]<=s&&(i.setStart(o,e[0]-r),a=!0),a&&e[1]>=r&&e[1]<=s&&(u=!0,i.setEnd(o,e[1]-r)),r=s}else y(z(o,null,1),(function(t){return f.push(t)}));return jt(t,i,bt(0,n))},xt=function(t,e,n){n=n||mt(),bt(0,n);var r=yt();r.selectNodeContents(t),n=jt(t,r,n),1===e?n.collapseToEnd():-1===e&&n.collapseToStart()},wt=function(t){return(t=t||mt()).rangeCount&&t.removeRange(t.getRangeAt(0)),t},jt=function(t,e,n){return n=n||mt(),i(e)?kt(t,e,n):(n.addRange(e),n)},At=function(t,e){return function(t){return o(t,RegExp)}(t)?t:RegExp(t,c(e)?e:"g")},St="ArrowLeft",Et="ArrowRight",Tt="Home",Dt="Backspace",Ct="End",Rt="Enter";function Lt(t,e,n){Object.defineProperty(t,e,n)}function Ot(t){t.focus()}function It(t){return B(t,"value",!1)}function Nt(t,e){var n=this;if(!t)return n;if(!o(n,Nt))return new Nt(t,e);S(t,function(t,e){return(e=e||t).fire=function(t,e,n){var r=this,i=r.hooks;return c(i[t])?(y(i[t],(function(t){t.apply(n||r,e)})),r):r},e.off=function(t,e){var n=this,r=n.hooks;if(!c(t))return r={},n;if(c(r[t]))if(c(e)){var i=g(r[t]);if(0===i)delete r[t];else for(var u=0;u<i;++u)if(e===r[t][u]){r[t].splice(u,1);break}}else delete r[t];return n},e.on=function(t,e){var n=this.hooks;return c(n[t])||(n[t]=[]),c(e)&&n[t].push(e),this},t.hooks={},t}(n,Nt._));var r=p({},Nt.state,l(e)?{join:e}:e||{});return s(e)&&e.escape&&(r.escape=e.escape),n.attach(t,r)}Nt.from=function(t,e){return new Nt(t,e)},Nt.of=x,Nt.state={escape:[","],join:", ",max:1/0,min:0,n:"tag-picker",pattern:null,with:[]},Nt.version="4.1.0",Lt(Nt,"name",{value:"TagPicker"});var qt=Nt._=Nt.prototype;Lt(qt,"text",{get:function(){return U(this._mask.input)},set:function(t){var e=this._mask,n=this.self,r=e.hint,i=e.input;vt(r,""===(t+="")?n.placeholder:""),vt(i,t),xt(i)}}),Lt(qt,"value",{get:function(){var t=J(this.self);return""===t?null:t},set:function(t){var e=this,n=e._event,r=e.state;e.value&&y(e.value.split(r.join),(function(t){return e.let(t,1)})),y(t.split(r.join),(function(t){return e.set(t,-1,1)})),e.fire("change",[n])}}),qt._let=!1,qt._set=!1,qt._valid=function(t){var e=this.state;return(t||"").replace(/[^ -~]/g," ").split(e.join).join("").replace(/\s+/g," ").trim()};var Mt=!1,zt=!1;function Bt(t){wt();var e=x(this);e._mask;var n=e._tags,r=e.mask,i=e.state.n;e._event=t,Mt||zt||b(n,(function(t){return Y(t,i+"__tag--selected")})),Y(r,i+="--focus"),Y(r,i+="-tag")}function Kt(t){wt();var e=x(this),n=e._mask,r=e.mask,i=e.state,u=n.text,a=i.n;e._event=t,Y(u,a+"__text--focus"),Y(r,a+="--focus"),Y(r,a+="-text"),e.fire("blur",[t])}function Pt(t){var e=x(this),n=t.target,r=e.state.n+"__tag";e._event=t,G(n,r)||P(n,"."+r)||e.focus()}function Ht(t){var e=this,n=x(e),r=n.state.n+"__tag--selected";n._event=t,rt(e,r),Ot(e),xt(M(e))}function Ft(t){var e=x(this),n=e._tags,r=e.state,i=r.n+"__tag--selected",u=[];e._event=t,b(n,(function(t,e){G(t,i)&&u.push(e)})),t.clipboardData.setData("text/plain",u.join(r.join)),e.fire("copy",[t,u]).focus(),dt(t)}function Ut(t){var e=x(this),n=e._mask,r=e._tags,i=e.state;n.input;var u=i.n+"__tag--selected",a=[];e._event=t,b(r,(function(t,n){G(t,u)&&(a.push(n),e.let(n,1))})),t.clipboardData.setData("text/plain",a.join(i.join)),e.fire("cut",[t,a]).fire("change",[t,It(this)]).focus(),dt(t)}function $t(t){var e=x(this),n=e._mask,r=e._tags,i=e.mask,u=e.self,a=e.state,o=n.hint,f=n.input,s=n.text,c=a.n;e._event=t,b(r,(function(t){return Y(t,c+"__tag--selected")})),rt(s,c+"__text--focus"),rt(i,c+="--focus"),rt(i,c+="-text"),ht((function(){return vt(o,U(f,!1)?"":u.placeholder)}),1)(),e.focus().fire("focus",[t])}function Jt(t){var e=x(this);e._event=t,e.focus()}function Wt(t){var e=x(this);e._event=t,e.fire("min.tags",[t]).focus(),dt(t)}function Gt(t){var e=x(this);e._mask;var n=e.mask,r=e.state.n;e._event=t,rt(n,r+="--focus"),rt(n,r+="-tag"),e.fire("focus.tag",[t])}function Qt(t){var e,n=this,r=t.key,i=Mt=t.ctrlKey,u=zt=t.shiftKey,a=x(n),o=a._mask,f=a._tags;a.mask;var s,c,l,v=a.state,p=o.text,h=F(n),_=K(n),d=v.n+"__tag--selected";if(a._event=t,u)rt(n,d),xt(M(n)),St===r?(h&&(G(h,d)?Y(n,d):rt(h,d),Ot(h),xt(M(h))),e=!0):Et===r&&(_&&p!==_&&(G(_,d)?Y(n,d):rt(_,d),Ot(_),xt(M(_))),e=!0);else if(i)"a"===r?(b(f,(function(t){Ot(t),xt(M(t)),rt(t,d)})),e=!0):St===r?(h&&Ot(h),e=!0):Et===r?(_&&p!==_?Ot(_):a.focus(),e=!0):Rt!==r&&" "!==r||(pt(n,d),G(n,d)?(Ot(n),xt(M(n))):xt(M(C(f))),e=!0);else{var m=[];if(b(f,(function(t,e){G(t,d)&&m.push(e),n!==t&&Y(t,d)})),Tt===r)(s=D(f))&&Ot(s),e=!0;else if(Ct===r)(c=C(f))&&Ot(c),e=!0;else if(Rt===r||" "===r)pt(n,d),G(n,d)?(Ot(n),xt(M(n))):xt(M(C(f))),e=!0;else if(St===r)h&&Ot(h),e=!0;else if(Et===r)_&&p!==_?Ot(_):a.focus(),e=!0;else if(Dt===r){if(a.let(l=It(n),1),g(m)>1)for(var y,k;k=m.pop();)h=(y=w(k,f))&&F(y),a.let(k,1);a.fire("change",[t,l]),h?(Ot(h),xt(M(h))):a.focus(),e=!0}else if("Delete"===r){if(a.let(l=It(n),1),g(m)>1)for(var j;j=m.shift();)_=w(j,f)&&K(j),a.let(j,1);a.fire("change",[t,l]),_&&p!==_?(Ot(_),xt(M(_))):a.focus(),e=!0}else"Escape"===r||"Tab"===r?(a.focus(),e=!0):(a.focus(),e=!1)}e&&dt(t)}function Vt(t){var e=t.key,n=x(this),r=n._tags,i=n.state.n+"__tag--selected";if(n._event=t,zt)if(St===e||Et===e);else{var u=0;b(r,(function(t){G(t,i)&&++u})),u<2&&Y(this,i)}Mt=zt=!1}function Xt(t){var e=t.data,n=x(this),r=n.state.escape,i=l(e)&&1===g(e)?e:0;if(n._event=t,"\n"===i&&(v("\n",r)||v(13,r))||"\t"===i&&(v("\t",r)||v(9,r))||v(i,r))return n.set(U(this)).focus().text="",dt(t)}function Yt(t){var e,n=this,r=t.key,i=t.keyCode,u=Mt=t.ctrlKey,o=zt=t.shiftKey,f=x(n),s=f._active,c=f._mask,l=f._tags;f.mask;var p,h,_=f.self,d=f.state,g=c.hint,m=d.n+"__tag--selected";if(escape=d.escape,!s)return dt(t);if(f._event=t,Rt===r&&(v("\n",escape)||v(13,escape))||"Tab"===r&&(v("\t",escape)||v(9,escape))||v(r,escape)||v(i,escape))return f.set(U(n)).focus().text="",dt(t);ht((function(){return vt(g,U(n,!1)?"":_.placeholder)}),1)();var y,k=""===function(t){var e,n=N.getSelection();if(n.rangeCount)return(e=n.getRangeAt(0).cloneRange()).collapse(!0),e.setStart(t,0),(e+"").slice(-1)}(n),w=null===U(n,!1);if(o)(w||k)&&St===r&&(h=C(l))&&(h&&(Ot(h),xt(M(h))),rt(h,m),e=!0);else if(u)"a"===r&&null===U(n,!1)&&null!==f.value?(b(l,(function(t){Ot(t),xt(M(t)),rt(t,m)})),e=!0):Tt===r?((p=D(l))&&Ot(p),e=!0):Ct===r||St===r?((h=C(l))&&Ot(h),e=!0):Dt===r&&((h=C(l))&&f.let(It(h)),f.focus(),e=!0);else if(Rt===r){var j=H(_);if(j&&a(j.requestSubmit)){var A=(y="button:not([type]),button[type=submit],input[type=image],input[type=submit]",(j||I).querySelector(y));A?j.requestSubmit(A):j.requestSubmit()}e=!0}else w?Tt===r?((p=D(l))&&Ot(p),e=!0):Ct===r||St===r?((h=C(l))&&Ot(h),e=!0):Dt===r&&((h=C(l))&&f.let(It(h)),f.focus(),e=!0):k&&St===r&&((h=C(l))&&Ot(h),e=!0);e&&dt(t)}function Zt(t){x(this)._event=t,Mt=zt=!1}function te(t){var e=x(this),n=e._tags,r=e.state,i=r.n+"__tag--selected",u=!0,a=(t.clipboardData||N.clipboardData).getData("text")+"";e._event=t;try{b(n,(function(t){if(!G(t,i))throw u=!1,""}))}catch(t){}u&&e.value&&y(e.value.split(r.join),(function(t){return e.let(t,1)}));var o=a.split(r.join);y(o,(function(t){return e.set(t,-1,1)})),e.fire("paste",[t,o]).focus().fire("change",[t]),dt(t)}function ee(t){var e=this,n=x(e),r=n._mask,u=n.self,a=n.state,o=r.hint,f=(t.clipboardData||N.clipboardData).getData("text")+"";n._event=t,function(t,e,n,r){var u,a,o;if((r=r||mt()).rangeCount){var f,s,c;if((a=r.getRangeAt(0)).deleteContents(),o=I.createDocumentFragment(),l(e))for(u=ot("div"),st(u,e);f=M(u,1);)c=nt(o,f);else i(e)?y(e,(function(t){return c=nt(o,t)})):c=nt(o,e);s=M(o,1),a.insertNode(o),c&&((a=a.cloneRange()).setStartAfter(c),a.setStartBefore(s),jt(t,a,wt(r)))}}(e,f),vt(o,U(e)?"":u.placeholder),ht((function(){if(f=U(e),n.text="",f){var r=f.split(a.join);y(r,(function(t){return n.set(t,-1,1)})),n.fire("paste",[t,r]).fire("change",[t])}}),1)(),dt(t)}function ne(t){var e=this,n=x(e),r=n._active,i=n._mask,u=n._tags,a=n.state,o=i.text,f=a.n+"__tag--selected";if(r){if(n._event=t,Ot(e),pt(e,f),Mt);else if(zt){wt();var s,c=P(e),l=(d="."+f,O((c||I).querySelectorAll(d))),v=l[0],p=l[g(l)-1];if(v!==p)for(;(s=K(v))&&o!==s&&v!==p;)rt(v=s,f)}else{wt();var h=2===t.button,_=0;b(u,(function(t){G(t,f)&&++_,e===t||h||Y(t,f)})),_>0&&rt(e,f)}var d;G(e,f)?(Ot(e),xt(M(e))):xt(C(u)),n.fire("touch.tag",[t]),dt(t),function(t){t&&t.stopPropagation()}(t)}}function re(t){var e=this,n=P(e),r=x(n);r._event=t,_t("mousedown",e,re),_t("touchstart",e,re),r.let(It(n)).focus(),dt(t)}function ie(t){var e=x(this);e._event=t,e.let().fire("reset",[t])}function ue(t){var e=x(this),n=e._tags,r=e.state;return e._event=t,n.size<r.min?(e.fire("min.tags",[t]).focus(),dt(t)):e.fire("submit",[t])}return qt.attach=function(t,e){var n=this;if(t=t||n.self,e&&l(e)&&(e={join:e}),e=p({},n.state,e||{}),G(t,e.n+"__self"))return n;t.required&&!e.min&&(e.min=1),n._active=!V(t)&&!function(t){return t.readOnly}(t),n._event=null,n._tags=new Map,n._value=J(t)||null,n.self=t,n.state=e;var r=e.n,u=H(t),o=ot("div",{class:r,tabindex:!V(t)&&-1});n.mask=o;var f=ot("span",{class:r+"__flex"}),v=ot("span",{class:r+"__text"}),h=ot("span",{autocapitalize:"off",contenteditable:!V(t)&&"",spellcheck:"false"}),_=ot("span",t.placeholder+"");nt(o,f),nt(f,v),nt(v,h),nt(v,_),rt(t,r+"__self"),function(t,e){P(t).insertBefore(e,K(t,!0))}(t,o),u&&(S(u,n),gt("reset",u,ie),gt("submit",u,ue)),gt("beforeinput",h,Xt),gt("blur",h,Kt),gt("click",o,Pt),gt("focus",t,Jt),gt("focus",h,$t),gt("invalid",t,Wt),gt("keydown",h,Yt),gt("keyup",h,Zt),gt("paste",h,ee),t.tabIndex=-1,S(o,n),S(h,n);var d={};if(d.flex=f,d.hint=_,d.input=h,d.of=t,d.self=o,d.text=v,n._mask=d,n._value&&y(n._value.split(e.join),(function(t){return n.set(t,-1,1,1)})),c(e)&&i(e.with))for(var m=0,b=g(e.with);m<b;++m){var k=e.with[m];l(k)&&(k=Nt[k]),a(k)?k.call(n,t,e):s(k)&&a(k.attach)&&k.attach.call(n,t,e)}return n},qt.blur=function(){wt();var t=this._mask,e=this._tags,n=t.input;return b(e,(function(t){return t.blur()})),n.blur()},qt.detach=function(){var t=this,e=t._mask,n=t.mask,r=t.self,u=t.state,o=e.input;if(!G(r,u.n+"__self"))return t;var f=H(r);if(t._active=!1,t._value=J(r)||null,f&&(_t("reset",f,ie),_t("submit",f,ue)),_t("beforeinput",o,Xt),_t("blur",o,Kt),_t("click",n,Pt),_t("focus",o,$t),_t("focus",r,Jt),_t("invalid",r,Wt),_t("keydown",o,Yt),_t("keyup",o,Zt),_t("paste",o,ee),i(u.with))for(var c=0,v=g(u.with);c<v;++c){var p=u.with[c];l(p)&&(p=Nt[p]),s(p)&&a(p.detach)&&p.detach.call(t,r,u)}return r.tabIndex=null,Y(r,u.n+"__self"),Z(n),t._mask={of:r},t.mask=null,t},qt.focus=function(t){var e=this._mask.input;return e&&(Ot(e),xt(e,t)),this},qt.get=function(t){var e=this,n=e._active,r=e._event,i=e._tags;if(!n)return!1;if(e.fire("get.tag",[r,t]),!j(t,i))return null;var u=-1;try{b(i,(function(e,n){if(++u,t===n)throw""}))}catch(t){}return u},qt.let=function(t,e){var n=this,r=n._active,o=n._event,f=n._let,s=n._tags,c=n._value,l=n.self,v=n.state;if(!r)return n;if(!u(t))return n.value&&y(n.value.split(v.join),(function(t){return n.let(t,1)})),y(c.split(v.join),(function(t){return n.set(t,-1,1)})),n.fire("change",[o]);if(i(t)||(t=[t,t]),s.size<v.min+1)return n.fire("min.tags",[o,t[0]]);if(!j(t[0],s))return n.fire("not.tag",[o,t[0]]);n.fire("is.tag",[o,t[0]]);var p=w(t[0],s);q(p,0);var h=q(p,1);return a(f)&&f.call(n,p),_t("blur",p,Bt),_t("contextmenu",p,Ht),_t("copy",p,Ft),_t("cut",p,Ut),_t("focus",p,Gt),_t("keydown",p,Qt),_t("keyup",p,Vt),_t("mousedown",p,ne),_t("mousedown",h,re),_t("paste",p,te),_t("touchstart",p,ne),_t("touchstart",h,re),Z(p),A(t[0],n._tags),l.value=T(n._tags).join(v.join),n.fire("let.tag",[o,t[0]]),e||n.fire("change",[o,t[0]]),n},qt.set=function(t,e,n,r){var u,o=this,s=o._active,c=o._event,v=o._mask,p=o._set,h=o._tags,_=o._valid,d=o.self,g=o.state,m=v.text,b=g.n,k=g.pattern;if(!s&&!r)return o;if(i(t)||(t=[t,t]),h.size>=g.max)return o.fire("max.tags",[c,t[0]]);if(a(_)&&(t[0]=_.call(o,t[0])),""===t[0]||l(k)&&!At(k).test(t[0]))return o.fire("not.tag",[c,t[0]]);if(j(t[0],h))return o.fire("has.tag",[c,t[0]]);o.fire("is.tag",[c,t[0]]);var x=ot("span",{class:b+"__tag","data-value":t[0],tabindex:!!s&&-1}),A=ot("span",(null!=(u=t[1])?u:t[0]).replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")),D=ot("span",{class:b+"__x",tabindex:-1});if(s&&(gt("blur",x,Bt),gt("contextmenu",x,Ht),gt("copy",x,Ft),gt("cut",x,Ut),gt("focus",x,Gt),gt("keydown",x,Qt),gt("keyup",x,Vt),gt("mousedown",x,ne),gt("mousedown",D,re),gt("paste",x,te),gt("touchstart",x,ne),gt("touchstart",D,re),S(x,o)),nt(x,A),nt(x,D),function(t){return f(t)&&0==t%1}(e)&&e>=0){var C=T(h);C.splice(e,0,t[0]),o._tags=new Map,E(t[0],x,h),a(p)&&p.call(o,x),y(C,(function(t){var e;E(t,e=w(t,h),o._tags),ct(m,e)}))}else E(t[0],x,o._tags),a(p)&&p.call(o,x),ct(m,x);return d.value=T(o._tags).join(g.join),o.fire("set.tag",[c,t[0]]),n||o.fire("change",[c,t[0]]),o},Nt}));