/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=e()}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},e=function(t){return"function"==typeof t},n=function(t,e){return t&&r(e)&&t instanceof e},s=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||n(t,Object))},r=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},a=function(t){return"string"==typeof t},i=function(t){return t.toLowerCase()},u=function(t){return t.length},o=function(t){return Object.keys(t)},c=function(t){return Object.values(t)},f=function e(){for(var n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];for(var o,c=a.shift(),f=0,l=u(a);f<l;++f)for(var v in a[f])if(r(c[v]))if(t(c[v])&&t(a[f][v])){c[v]=[].concat(c[v]);for(var h=0,p=u(a[f][v]);h<p;++h)o=a[f][v][h],-1===c[v].indexOf(o)&&c[v].push(a[f][v][h])}else s(c[v])&&s(a[f][v])?c[v]=e({},c[v],a[f][v]):c[v]=a[f][v];else c[v]=a[f][v];return c},l=function e(n){if(t(n))return n.map((function(t){return e(n)}));if(s(n)){for(var r in n)n[r]=e(n[r]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},v=document,h=window,p=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},_=function(t,e){return e?t.closest(e)||null:t.parentNode||null},m=function(t){var e="form";return k(t,e)&&e===function(t){return i(t&&t.nodeName||"")||null}(t[e])?t[e]:_(t,e)},d=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!k(t,n))return!1;var s=t[n];return""!==(s=e?s.trim():s)?s:null},g=function(t,e){return t.classList.contains(e)},k=function(t,e){return e in t},y=function(t,e){return t.removeAttribute(e),t},b=function(t,e){return t.classList.remove(e),t},w=function(t){var e=_(t);return t.remove(),e},x=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,l(n)),t},j=function(t,e){return t.append(e),e},E=function(t,e){return t.classList.add(e),t},A=function(t,e,n){return t=a(t)?v.createElement(t):t,s(e)&&(n=e,e=!1),a(e)&&L(t,e),s(n)&&function(t,e){var n;for(var s in e)(n=e[s])||""===n||0===n?x(t,s,n):y(t,s)}(t,n),t},L=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var s="innerHTML";return k(t,s)&&(t[s]=n?e.trim():e),t},T=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var s="textContent";return k(t,s)&&(t[s]=n?e.trim():e),t};var K=function(t,e,n){e.removeEventListener(t,n)},O=function(t){return t&&t.preventDefault()},C=function(t,e,n,s){void 0===s&&(s=!1),e.addEventListener(t,n,s)},P=function(t,e){return function(t){return n(t,RegExp)}(t)?t:RegExp(t,r(e)?e:"g")},R="ArrowLeft",S="Backspace",B="Delete";function D(t){return t.disabled}function I(t,e){var s=this;return t?n(s,I)?(t["_"+I.name]=function(t,e){return(e=e||t).fire=function(t,e){var n=this,s=n.hooks;return r(s[t])?(s[t].forEach((function(t){return t.apply(n,e)})),n):n},e.off=function(t,e){var n=this,s=n.hooks;if(!r(t))return s={},n;if(r(s[t]))if(r(e)){var a=s[t].length;if(0===a)delete s[t];else for(var i=0;i<a;++i)if(e===s[t][i]){s[t].splice(i,1);break}}else delete s[t];return n},e.on=function(t,e){var n=this.hooks;return r(n[t])||(n[t]=[]),r(e)&&n[t].push(e),this},t.hooks={},t}(s,I.prototype),s.attach(t,f({},I.state,a(e)?{join:e}:e||{}))):new I(t,e):s}I.state={class:"tag-picker",escape:[","],join:", ",max:9999,min:0,pattern:null,with:[]},I.version="4.0.0",Object.defineProperty(I,"name",{value:"TagPicker"});var N=I.prototype;function H(){var t=this["_"+I.name].state;b(this,t.class+"--focus")}function M(){var t=this["_"+I.name];t._mask;var e=t.mask,n=t.state.class;b(e,n+="--focus"),b(e,n+="-tag")}function W(){var t=this["_"+I.name],e=t._mask,n=t.mask,s=t.state,r=e.text,a=s.class;b(r,a+"__text--focus"),b(n,a+="--focus"),b(n,a+="-text")}function Z(t){var e=this["_"+I.name],n=e._mask,s=e.mask,r=n.copy,a=n.input;s===_(r)?(r.focus(),r.select()):a.focus(),O(t)}function $(t){var e,n,s=this,r=s["_"+I.name],a=r._mask,i=r._tags,u=r.mask,o=r.state,c=a.copy,f=o.class+"__tag--selected",l=u===_(c),v=0;if(!V){for(var h in i)g(i[h],f)&&++v,s!==i[h]&&b(i[h],f);w(c)}l&&v>1?E(s,f):(e=f,s.classList.toggle(e,n)),function(t){t&&t.stopPropagation()}(t)}function q(t){var e=_(this),n=e["_"+I.name],s=n._mask.input;K("click",this,q),n.let(e.title),s.focus(),O(t)}function z(){var t=this,e=t["_"+I.name]._mask.input;h.setTimeout((function(){return w(t),e.focus()}),1)}function F(){var t=this,e=t["_"+I.name],n=e._mask,s=e.state,r=n.input;t.value.split(s.join).forEach((function(t){return e.let(t)})),h.setTimeout((function(){return w(t),r.focus()}),1)}function G(){var t=this["_"+I.name],e=t._mask,n=t._tags,s=t.mask,r=t.state,a=e.copy,i=e.text,u=r.class;for(var o in n)b(n[o],u+"__tag--selected");b(s,u+"--focus-tags"),w(a),E(i,u+"__text--focus"),E(s,u+="--focus"),E(s,u+="-text")}function J(){this["_"+I.name].focus()}function Q(){var t=this["_"+I.name].state;E(this,t.class+"--focus")}function U(){var t=this["_"+I.name];t._mask;var e=t.mask,n=t.state.class;E(e,n+="--focus"),E(e,n+="-tag")}N._filter=function(t){var e,n,s=this.state;return t=(t||"").split(s.join).join("").trim(),(e=t,void 0===n&&(n="-"),e.replace(/[A-Z]/g,(function(t){return n+i(t)})).replace(/\W+/g,n)).replace(/^-+|-+$/g,"")};var V=!1;function X(t){V=t.ctrlKey,t.shiftKey}function Y(t){var e,n=this,s=t.key,r=t.ctrlKey,a=t.shiftKey,i=n["_"+I.name],u=i._mask,o=i._tags,c=i.mask,f=i.state,l=u.copy,v=u.text,h=n.previousElementSibling||null,_=p(n),m=f.class;if(R===s)h&&h.focus(),e=!0;else if("ArrowRight"===s)_&&v!==_?_.focus():i.focus(),e=!0;else if(S===s)i.let(n.title),h?h.focus():i.focus(),e=!0;else if(B===s)i.let(n.title),_&&v!==_?_.focus():i.focus(),e=!0;else if(r&&!a&&"a"===s){for(var d in o)E(o[d],m+"__tag--selected");l.value=i.value,j(c,l),l.focus(),l.select(),E(c,m+="--focus"),b(c,m+"-tag"),E(c,m+="-tags"),e=!0}e&&O(t)}function tt(t){var e=t.key,n=t.ctrlKey,s=t.shiftKey,r=this["_"+I.name],a=r._mask,i=r.state,u=a.input;S===e||B===e?(this.value.split(i.join).forEach((function(t){return r.let(t)})),u.focus()):"Escape"!==e&&(n||s)||u.focus()}function et(t){var e,n,s,r=this,a=t.key,i=t.keyCode,u=t.ctrlKey,o=t.shiftKey,f=r["_"+I.name],l=f._mask,v=f._tags,p=f.mask,_=f.self,m=f.state,g=l.copy,k=l.hint,y=m.class;if((escape=m.escape).includes(a)||escape.includes(i))return f.set(function(t){return d(t)}(r)),T(r,""),T(k,_.placeholder),f.focus(),O(t);if(h.setTimeout((function(){T(k,d(r)?"":_.placeholder)}),1),R===a&&""===function(t){var e,n=h.getSelection();if(n.rangeCount>0)return(e=n.getRangeAt(0).cloneRange()).collapse(!0),e.setStart(t,0),(e+"").slice(-1)}(r))(s=c(v).pop())&&s.focus(),e=!0;else if(S===a&&null===d(r))(s=c(v).pop())&&f.let(s.title),f.focus(),e=!0;else if(u&&!o&&"a"===a&&null===d(r)&&null!==(n=f.value)){for(var w in v)E(v[w],y+"__tag--selected");g.value=n,j(p,g),g.focus(),g.select(),E(p,y+="--focus"),b(p,y+"-tag"),E(p,y+="-tags"),e=!0}e&&O(t)}function nt(){var t=this["_"+I.name],e=t._mask,n=t._tags,s=t.mask,r=t.state,a=e.copy,i=r.class+"__tag--selected";V=!1;var o=[];for(var c in n)g(n[c],i)&&o.push(c);u(o)&&(a.value=o.join(r.join),j(s,a),a.focus(),a.select())}function st(){var t=this,e=t["_"+I.name],n=e._mask,s=e.state,r=n.hint;h.setTimeout((function(){var n=d(t);null!==n&&n.split(s.join).forEach((function(t){return e.set(t)})),T(t,""),T(r,e.self.placeholder)}),1)}return N.attach=function(n,i){var o=this;n=n||o.self,i=i||o.state,o._active=!0,o._tags={},o._value=function(t){return t.value.replace(/\r/g,"")}(n),o.self=n,o.state=i;var c=i.class,f="_"+I.name;m(n);var l=A("div",{class:c,tabindex:!D(n)&&-1});o.mask=l;var v,h,d=A("span",{class:c+"__tags"}),g=A("span",{class:c+"__text"}),k=A("input",{class:c+"__copy",tabindex:-1,type:"text"}),y=A("span",{contenteditable:!D(n)&&"true",spellcheck:"false",style:"white-space:pre;"}),b=A("span",n.placeholder+"");j(l,d),j(d,g),j(g,y),j(g,b),E(n,c+"__self"),h=l,_(v=n).insertBefore(h,p(v,!0)),C("blur",l,H),C("blur",y,W),C("copy",k,z),C("cut",k,F),C("focus",l,Q),C("focus",n,J),C("focus",y,G),C("keydown",l,X),C("keydown",k,tt),C("keydown",y,et),C("keyup",l,nt),C("mousedown",l,Z),C("paste",y,st),C("touchstart",l,Z),n.tabIndex=-1,l[f]=o,k[f]=o,y[f]=o;var w={};if(w.copy=k,w.hint=b,w.input=y,w.of=n,w.self=l,w.tags=d,w.text=g,o._mask=w,r(i)&&t(i.with))for(var x=0,L=u(i.with);x<L;++x){var T=i.with[x];a(T)&&(T=I[T]),e(T)?T.call(o,n,i):s(T)&&e(T.attach)&&T.attach.call(o,n,i)}return o},N.blur=function(){},N.click=function(){},N.detach=function(){var n=this,r=n._mask,i=n.mask,o=n.self,c=n.state,f=r.copy,l=r.input;if(n._active=!1,K("blur",l,W),K("blur",i,H),K("copy",f,z),K("cut",f,F),K("focus",l,G),K("focus",i,Q),K("focus",o,J),K("keydown",f,tt),K("keydown",l,et),K("keydown",i,X),K("keydown",i,nt),K("mousedown",i,Z),K("paste",l,st),K("touchstart",i,Z),t(c.with))for(var v=0,h=u(c.with);v<h;++v){var p=c.with[v];a(p)&&(p=I[p]),s(p)&&e(p.detach)&&p.detach.call(n,o,c)}return o.tabIndex=null,b(o,c.class+"__self"),w(i),n._mask={of:o},n.mask=null,n},N.focus=function(){var t=this._mask.input;return t&&t.focus(),this},N.get=function(t){var e=this._active,n=this._tags;return!!e&&(n[t]?t:null)},N.let=function(t){var e=this,n=e._active,s=e._tags,r=e.self,a=e.state;if(!n)return e;if(!s[t])return!1;var i=s[t],u=i.firstElementChild||null;return K("blur",i,M),K("click",u,q),K("focus",i,U),K("keydown",i,Y),K("mousedown",i,$),K("touchstart",i,$),w(i),delete e._tags[t],r.value=o(e._tags).join(a.join),e},N.set=function(t){var n=this,s=n._active,r=n._filter,i=n._mask,u=n._tags,c=n.state,f=i.text,l=c.pattern;if(!s)return n;if(e(r)&&(t=r.call(n,t)),a(l)&&P(l)&&!P(l).test(t))return!1;if(""===t||u[t])return!1;var v,h,p=A("span",{class:n.state.class+"__tag",tabindex:-1,title:t}),m=A("a",{class:n.state.class+"__tag-x",href:"",tabindex:-1,target:"_top"});return C("blur",p,M),C("click",m,q),C("focus",p,U),C("keydown",p,Y),C("mousedown",p,$),C("touchstart",p,$),p["_"+I.name]=n,j(p,m),h=p,_(v=f).insertBefore(h,v),n._tags[t]=p,n.self.value=o(n._tags).join(c.join),n},Object.defineProperty(N,"tags",{get:function(){return o(this._tags)},set:function(t){var e=this;e._tags={},e.self.value="",t.forEach((function(t){return e.set(t)}))}}),Object.defineProperty(N,"value",{get:function(){var t=this.self.value;return""===t?null:t},set:function(t){this.self.value=t}}),I}));