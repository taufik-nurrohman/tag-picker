/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=e()}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},e=function(t){return"function"==typeof t},n=function(t,e){return t&&s(e)&&t instanceof e},r=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||n(t,Object))},s=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},i=function(t){return"string"==typeof t},u=function(t){return t.toLowerCase()},a=function(t){return t.length},o=function(t){return Object.keys(t)},c=function(t){return Object.values(t)},f=function e(){for(var n=arguments.length,i=Array(n),u=0;u<n;u++)i[u]=arguments[u];for(var o,c=i.shift(),f=0,l=a(i);f<l;++f)for(var v in i[f])if(s(c[v]))if(t(c[v])&&t(i[f][v])){c[v]=[].concat(c[v]);for(var p=0,h=a(i[f][v]);p<h;++p)o=i[f][v][p],-1===c[v].indexOf(o)&&c[v].push(i[f][v][p])}else r(c[v])&&r(i[f][v])?c[v]=e({},c[v],i[f][v]):c[v]=i[f][v];else c[v]=i[f][v];return c},l=function e(n){if(t(n))return n.map((function(t){return e(n)}));if(r(n)){for(var s in n)n[s]=e(n[s]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},v=document,p=window,h=function(t){return t.firstElementChild||null},_=function(t,e){var n=t.children;return"number"==typeof e?n[e]||null:n||[]},d=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},g=function(t,e){return e?t.closest(e)||null:t.parentNode||null},m=function(t){var e="form";return b(t,e)&&e===function(t){return u(t&&t.nodeName||"")||null}(t[e])?t[e]:g(t,e)},k=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!b(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},y=function(t,e){return t.classList.contains(e)},b=function(t,e){return e in t},x=function(t,e){return t.removeAttribute(e),t},w=function(t,e){return t.classList.remove(e),t},j=function(t){var e=g(t);return t.remove(),e},E=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,l(n)),t},A=function(t,e){return t.append(e),e},S=function(t,e){return t.classList.add(e),t},L=function(t,e,n){return t=i(t)?v.createElement(t):t,r(e)&&(n=e,e=!1),i(e)&&R(t,e),r(n)&&function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?E(t,r,n):x(t,r)}(t,n),t},R=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="innerHTML";return b(t,r)&&(t[r]=n?e.trim():e),t},C=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="textContent";return b(t,r)&&(t[r]=n?e.trim():e),t},T=function(t,e,n){return t.classList.toggle(e,n),t},D=function(t,e){return function(){var n=arguments,r=this;setTimeout((function(){return t.apply(r,n)}),e)}};var O=function(t,e,n){e.removeEventListener(t,n)},q=function(t){return t&&t.preventDefault()},K=function(t,e,n,r){void 0===r&&(r=!1),e.addEventListener(t,n,r)},P=function(t,e){return function(t){return n(t,RegExp)}(t)?t:RegExp(t,s(e)?e:"g")},B="ArrowLeft",N="Home",H="Backspace",I="End",M="Enter",V={focusVisible:!0},W="TagPicker";function Z(t,e,n){Object.defineProperty(t,e,n)}function $(){v.getSelection().removeAllRanges()}function z(t){t.focus()}function F(t){return t.disabled}function G(t){var e=v.getSelection();$();var n=v.createRange();n.selectNodeContents(t),e.addRange(n)}function J(t,e){var r=this;return t?n(r,J)?(t["_"+W]=function(t,e){return(e=e||t).fire=function(t,e){var n=this,r=n.hooks;return s(r[t])?(r[t].forEach((function(t){return t.apply(n,e)})),n):n},e.off=function(t,e){var n=this,r=n.hooks;if(!s(t))return r={},n;if(s(r[t]))if(s(e)){var i=r[t].length;if(0===i)delete r[t];else for(var u=0;u<i;++u)if(e===r[t][u]){r[t].splice(u,1);break}}else delete r[t];return n},e.on=function(t,e){var n=this.hooks;return s(n[t])||(n[t]=[]),s(e)&&n[t].push(e),this},t.hooks={},t}(r,J.prototype),r.attach(t,f({},J.state,i(e)?{join:e}:e||{}))):new J(t,e):r}J.state={class:"tag-picker",escape:[","],join:", ",max:9999,min:0,pattern:null,with:[]},J.version="4.0.0",Z(J,"name",{value:W});var Q=J.prototype;Z(Q,"text",{get:function(){return k(this._mask.input)},set:function(t){var e=this._mask,n=this.self,r=e.hint,s=e.input;C(r,""===(t+="")?n.placeholder:""),C(s,t)}}),Z(Q,"value",{get:function(){var t=this.self.value;return""===t?null:t},set:function(t){var e=this,n=e.state;t.split(n.join).forEach((function(t){return e.set(t)}))}}),Q._filter=function(t){var e,n,r=this.state;return t=(t||"").split(r.join).join("").trim(),(e=t,void 0===n&&(n="-"),e.replace(/[A-Z]/g,(function(t){return n+u(t)})).replace(/\W+/g,n)).replace(/^-+|-+$/g,"")};var U=!1;function X(){var t=this["_"+W];t._mask,t._tags;var e=t.mask,n=t.state.class;w(e,n+="--focus"),w(e,n+="-tag"),$()}function Y(){var t=this["_"+W],e=t._mask,n=t.mask,r=t.state,s=e.text,i=r.class;w(s,i+"__text--focus"),w(n,i+="--focus"),w(n,i+="-text"),$()}function tt(t){var e=this,n=e["_"+W];n._tags;var r=n.state.class+"__tag--focus";S(e,r),z(e),G(h(e))}function et(t){var e=this["_"+W],n=e._tags,r=e.state,s=r.class+"__tag--focus",i=[];for(var u in n)y(n[u],s)&&i.push(u);t.clipboardData.setData("text/plain",i.join(r.join)),q(t),console.log(i)}function nt(t){var e=this["_"+W],n=e._mask,r=e._tags,s=e.state;n.input;var i=s.class+"__tag--focus",u=[];for(var a in r)y(r[a],i)&&(u.push(a),j(r[a]),delete r[a]);t.clipboardData.setData("text/plain",u.join(s.join)),e.focus(),q(t),console.log(u)}function rt(){var t=this["_"+W],e=t._mask,n=t._tags,r=t.mask,s=t.self,i=t.state,u=e.hint,a=e.input,o=e.text,c=i.class;for(var f in n)w(n[f],c+"__tag--focus");S(o,c+"__text--focus"),S(r,c+="--focus"),S(r,c+="-text"),t.focus(),D((function(){return C(u,k(a,!1)?"":s.placeholder)}),1)()}function st(){this["_"+W].focus()}function it(){var t=this["_"+W];t._mask;var e=t.mask,n=t.state.class;S(e,n+="--focus"),S(e,n+="-tag")}function ut(t){var e,n=this,r=t.key,s=U=t.ctrlKey,i=t.shiftKey,u=n["_"+W],a=u._mask,o=u._tags;u.mask;var f,l,v=u.state,p=a.text,_=n.previousElementSibling||null,g=d(n),m=v.class+"__tag--focus";if(i)S(n,m);else if(s){if("a"===r){for(var k in o)z(o[k]),G(h(o[k])),S(o[k],m);e=!0}}else N===r?((f=c(o).shift())&&f.focus(V),e=!0):I===r?((l=c(o).pop())&&l.focus(V),e=!0):M===r||" "===r?(T(n,m),y(n,m)?(z(n),G(h(n))):$(),e=!0):B===r?(_&&_.focus(V),e=!0):"ArrowRight"===r?(g&&p!==g?g.focus(V):u.focus(),e=!0):H===r?(u.let(n.title),_?(z(_),G(h(_))):u.focus(),e=!0):"Delete"===r?(u.let(n.title),g&&p!==g?(z(g),G(h(g))):u.focus(),e=!0):"Escape"!==r&&"Tab"!==r||(u.focus(),e=!0);e&&q(t)}function at(){U=!1}function ot(t){var n,r=this,s=t.key,i=t.keyCode,u=U=t.ctrlKey,a=t.shiftKey,o=r["_"+W],f=o._mask,l=o._tags;o.mask;var _,d,g=o.self,y=o.state,b=f.hint,x=y.class+"__tag--focus";if((escape=y.escape).includes(s)||escape.includes(i))return o.set(k(r)),C(r,""),C(b,g.placeholder),o.focus(),q(t);D((function(){return C(b,k(r,!1)?"":g.placeholder)}),1)();var w,j=""===function(t){var e,n=p.getSelection();if(n.rangeCount>0)return(e=n.getRangeAt(0).cloneRange()).collapse(!0),e.setStart(t,0),(e+"").slice(-1)}(r),E=null===k(r,!1);if(a)(E||j)&&B===s&&(d=c(l).pop())&&(d&&d.focus(V),S(d,x),n=!0);else if(u)if("a"===s&&null===k(r,!1)&&null!==o.value){for(var A in l)z(l[A]),G(h(l[A])),S(l[A],x);n=!0}else N===s?((_=c(l).shift())&&_.focus(V),n=!0):I===s||B===s?((d=c(l).pop())&&d.focus(V),n=!0):H===s&&((d=c(l).pop())&&o.let(d.title),o.focus(),n=!0);else if(M===s){var L=m(g);if(L&&e(L.requestSubmit)){var R=(w="button:not([type]),button[type=submit],input[type=image],input[type=submit]",(L||v).querySelector(w));R?L.requestSubmit(R):L.requestSubmit()}n=!0}else E?N===s?((_=c(l).shift())&&_.focus(V),n=!0):I===s||B===s?((d=c(l).pop())&&d.focus(V),n=!0):H===s&&((d=c(l).pop())&&o.let(d.title),o.focus(),n=!0):j&&B===s&&((d=c(l).pop())&&d.focus(V),n=!0);n&&q(t)}function ct(){U=!1}function ft(){var t=this,e=t["_"+W],n=e._mask,r=e.state,s=n.hint;D((function(){var n=k(t);null!==n&&n.split(r.join).forEach((function(t){return e.set(t)})),C(t,""),C(s,e.self.placeholder)}),1)()}function lt(t){var e=this,n=e["_"+W],r=n._tags,s=n.state.class+"__tag--focus";if(T(e,s),U);else{$();var i=2===t.button,u=0;for(var a in r)y(r[a],s)&&++u,e===r[a]||i||w(r[a],s);u>0&&S(e,s)}y(e,s)?(z(e),G(h(e))):$(),q(t),function(t){t&&t.stopPropagation()}(t)}function vt(t){var e=g(this),n=e["_"+W];n._mask.input,O("click",this,vt),n.let(e.title),n.focus(),q(t)}return Q.attach=function(n,u){var o=this;n=n||o.self,u=u||o.state,o._active=!0,o._tags={},o._value=function(t){return t.value.replace(/\r/g,"")}(n),o.self=n,o.state=u;var c=u.class,f="_"+W;m(n);var l=L("div",{class:c,tabindex:!F(n)&&-1});o.mask=l;var v,p,h=L("span",{class:c+"__tags"}),_=L("span",{class:c+"__text"}),k=L("span",{contenteditable:!F(n)&&"true",spellcheck:"false",style:"white-space:pre;"}),y=L("span",n.placeholder+"");A(l,h),A(h,_),A(_,k),A(_,y),S(n,c+"__self"),p=l,g(v=n).insertBefore(p,d(v,!0)),K("blur",k,Y),K("focus",n,st),K("focus",k,rt),K("keydown",k,ot),K("keyup",k,ct),K("paste",k,ft),n.tabIndex=-1,l[f]=o,k[f]=o;var b={};if(b.hint=y,b.input=k,b.of=n,b.self=l,b.tags=h,b.text=_,o._mask=b,s(u)&&t(u.with))for(var x=0,w=a(u.with);x<w;++x){var j=u.with[x];i(j)&&(j=J[j]),e(j)?j.call(o,n,u):r(j)&&e(j.attach)&&j.attach.call(o,n,u)}return o},Q.blur=function(){},Q.click=function(){},Q.detach=function(){var n=this,s=n._mask,u=n.mask,o=n.self,c=n.state,f=s.input;if(n._active=!1,O("blur",f,Y),O("focus",f,rt),O("focus",o,st),O("keydown",f,ot),O("keyup",f,ct),O("paste",f,ft),t(c.with))for(var l=0,v=a(c.with);l<v;++l){var p=c.with[l];i(p)&&(p=J[p]),r(p)&&e(p.detach)&&p.detach.call(n,o,c)}return o.tabIndex=null,w(o,c.class+"__self"),j(u),n._mask={of:o},n.mask=null,n},Q.focus=function(){var t=this._mask.input;return t&&(z(t),G(t)),this},Q.get=function(t){var e=this._active,n=this._tags;return!!e&&(n[t]?t:null)},Q.let=function(t){var e=this,n=e._active,r=e._tags,s=e.self,i=e.state;if(!n)return e;if(!r[t])return!1;var u=r[t];_(u,0);var a=_(u,1);return O("blur",u,X),O("contextmenu",u,tt),O("copy",u,et),O("cut",u,nt),O("focus",u,it),O("keydown",u,ut),O("keyup",u,at),O("mousedown",u,lt),O("mousedown",a,vt),O("touchstart",u,lt),O("touchstart",a,vt),j(u),delete e._tags[t],s.value=o(e._tags).join(i.join),e},Q.set=function(t){var n=this,r=n._active,s=n._filter,u=n._mask,a=n._tags,c=n.self,f=n.state,l=u.text,v=f.pattern,p=f.class;if(!r)return n;if(e(s)&&(t=s.call(n,t)),i(v)&&P(v)&&!P(v).test(t))return!1;if(""===t||a[t])return!1;var h,_,d=L("span",{class:p+="__tag",tabindex:-1,title:t}),m=L("span",t),k=L("span",{class:p+="-x",tabindex:-1});return K("blur",d,X),K("contextmenu",d,tt),K("copy",d,et),K("cut",d,nt),K("focus",d,it),K("keydown",d,ut),K("keyup",d,at),K("mousedown",d,lt),K("mousedown",k,vt),K("touchstart",d,lt),K("touchstart",k,vt),d["_"+W]=n,A(d,m),A(d,k),_=d,g(h=l).insertBefore(_,h),n._tags[t]=d,c.value=o(n._tags).join(f.join),n},J}));