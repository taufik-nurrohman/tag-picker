/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2020 Taufik Nurrohman
 *
 * <https://github.com/taufik-nurrohman/tag-picker>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(n="undefined"!=typeof globalThis?globalThis:n||self).TP=t()}(this,(function(){"use strict";var n=function(n){return Array.isArray(n)},t=function(n,t){return n&&u(t)&&n instanceof t},e=function(n){return"number"==typeof n},r=function(n,e){return void 0===e&&(e=!0),"object"==typeof n&&(!e||t(n,Object))},u=function(n){return function(n){return void 0!==n}(n)&&!function(n){return null===n}(n)},i=function(n){return"string"==typeof n},o=function t(e){if(n(e))return e.map((function(n){return t(e)}));if(r(e)){for(var u in e)e[u]=t(e[u]);return e}return!1===e?"false":null===e?"null":!0===e?"true":""+e},c=function t(e){if(n(e))return e.map((function(n){return t(n)}));if(function(n){return/^-?(?:\d*.)?\d+$/.test(n+"")}(e))return function(n,t){return void 0===t&&(t=10),parseInt(n,t)}(e);if(r(e)){for(var u in e)e[u]=t(e[u]);return e}return{false:!1,null:null,true:!0}[e]||e},f=document,a=window,s=function(n,t,e){if(void 0===e&&(e=!0),!h(n,t))return null;var r=n.getAttribute(t);return e?c(r):r},l=function(n,t){var r=n.children;return e(t)?r[t]||null:r||[]},g=function(n){return(n&&n.nodeName||"").toLowerCase()||null},v=function(n){return n.nextElementSibling||null},p=function(n){return n.parentNode||null},d=function(n){return n.previousElementSibling||null},m=function(n,t){void 0===t&&(t=!0);var e="textContent";if(!k(n,e))return!1;var r=n[e];return""!==(r=t?r.trim():r)?r:null},h=function(n,t){return n.hasAttribute(t)},b=function(n){return null!==p(n)},k=function(n,t){return t in n},y=function(n,t){return n.removeAttribute(t),n},x=function(n,t){return n.classList.remove(t),n},L=function(t,e){if(n(e))return e.forEach((function(n){return t.classList.remove(n)})),t;if(r(e)){for(var u in e)e[u]&&t.classList.remove(u);return t}return t.className="",t},w=function(n){var t=p(n);return n.remove(),t},E=function(n,t,e){return!0===e&&(e=t),n.setAttribute(t,o(e)),n},A=function(n,t){return n.append(t),t},T=function(n,t){return n.classList.add(t),n},C=function(n,t,e){return n=i(n)?f.createElement(n):n,r(t)&&(e=t,t=!1),i(t)&&O(n,t),r(e)&&function(n,t){var e;for(var r in t)(e=t[r])||""===e||0===e?E(n,r,e):y(n,r)}(n,e),n},O=function(n,t,e){if(void 0===e&&(e=!0),null===t)return n;var r="innerHTML";return k(n,r)&&(n[r]=e?t.trim():t),n},B=function(n,t){return p(n).insertBefore(t,n),t},P=function(n,t,e){if(void 0===e&&(e=!0),null===t)return n;var r="textContent";return k(n,r)&&(n[r]=e?t.trim():t),n},K=function(n){return n&&n.preventDefault()},N=function(n,t,e){t.removeEventListener(n,e)},R=function(n,t,e,r){void 0===r&&(r=!1),t.addEventListener(n,e,r)},D=function(n,t){return-1!==t.indexOf(n)};function S(n){var t={};return n.hooks=t,n.fire=function(e,r){return u(t[e])?(t[e].forEach((function(t){return t.apply(n,r)})),n):n},n.off=function(e,r){if(!u(e))return t={},n;if(u(t[e]))if(u(r)){for(var i=0,o=t[e].length;i<o;++i)if(r===t[e][i]){t[e].splice(i,1);break}0===j&&delete t[e]}else delete t[e];return n},n.on=function(e,r){return u(t[e])||(t[e]=[]),u(r)&&t[e].push(r),n},n}var z=S({}),H=(z.fire,z.off,z.on,z.hooks,function(n,e){return function(n){return t(n,RegExp)}(n)?n:(n=n.replace(/\//g,"\\/"),RegExp(n,u(e)?e:"g"))}),I=function(n,t){var e=t.indexOf(n);return-1!==e?e:null},M=function(n){return n.length},$=function(n){return Object.keys(n)},_=a.setTimeout;function q(u,o){if(void 0===o&&(o={}),u){var c=this;if(!u.TP){if(!t(c,q))return new q(u,o);var f,a=function(){return u.disabled},h=function(){return u.readOnly},y=s(u,"placeholder"),j=s(u,"tabindex"),E=S(c).fire;c.state=o=function(){for(var n=arguments.length,t=Array(n),e=0;e<n;e++)t[e]=arguments[e];return Object.assign.apply(Object,[{}].concat(t))}(q.state,i(o)?{join:o}:o||{}),c.source=u,q.instances[u.id||u.name||(f=q.instances,M($(f)))]=c,u.TP=1;var O,z,F=C("span",{class:"editor tag"}),G=C("span",{contenteditable:!a()&&"true",spellcheck:"false",style:"white-space:pre;"}),J=C("span"),Q=function(n){var t="form";if(k(n,t)&&t===g(n.form))return n.form;for(var e=p(n);e&&t!==g(e);)e=p(e);return e||null}(u),U=C("span",{class:o.class}),V=C("span",{class:"tags"});return vn(""),A(U,V),A(V,F),A(F,G),A(F,J),T(u,o.class+"-source"),z=U,p(O=u).insertBefore(z,v(O)),C(u,{tabindex:"-1"}),R("blur",G,Y),R("click",G,Z),R("click",U,on),R("focus",G,nn),R("focus",u,cn),R("keydown",G,tn),R("paste",G,un),Q&&R("submit",Q,rn),c.blur=function(){return!a()&&(G.blur(),Y())},c.click=function(){return U.click()},on(),c.f=function(n){return function(n){return n.toLowerCase()}(n||"").replace(/[^ a-z\d-]/g,"")},c.focus=function(){return a()||(G.focus(),nn()),c},c.get=function(n){return a()?null:pn(n,1)},c.input=G,c.let=function(n){if(!a()&&!h()){var t=o.min;if(X(),t>0&&M(c.tags)<t)return E("min.tags",[t]),c;bn(n),dn(n)}return c},c.pop=function(){if(!u.TP)return c;delete u.TP;var n=c.tags;return x(u,o.class+"-source"),N("blur",G,Y),N("click",G,Z),N("click",U,on),N("focus",G,nn),N("focus",u,cn),N("keydown",G,tn),N("paste",G,un),Q&&N("submit",Q,rn),n.forEach(bn),C(u,{tabindex:j}),w(U),E("pop",[n])},c.self=U,c.set=function(n,t){if(!a()&&!h()){var e=c.tags,r=o.max;pn(n)?E("has.tag",[n,I(n,e)]):M(e)<r?(hn(n,t),mn(n,t)):E("max.tags",[r])}return c},c.source=c.output=u,c.state=o,c.tags=[],en(u.value),c.value=function(n){return!a()&&!h()&&en(n)},c}}function W(n){return c.f(n).replace(H("("+o.escape.join("|").replace(/\\/g,"\\\\")+")+"),"").trim()}function X(){if(a()||h())return vn("");var n,t=W(m(G)),e=c.tags;t&&(pn(t)?E("has.tag",[t,I(t,e)]):(hn(t),mn(t),n=M(e),E("change",[t,n]),E("set.tag",[t,n])),vn(""))}function Y(){X(),L(U,["focus","focus.input"]),E("blur",[c.tags,M(c.tags)])}function Z(){E("click",[c.tags])}function nn(){T(U,"focus"),T(U,"focus.input"),E("focus",[c.tags])}function tn(n){var t,e=o.escape,r=n.key,u=n.keyCode,i=n.ctrlKey,f="Enter"===r||13===u,s=n.shiftKey,l="Tab"===r||9===u,g=d(F),v=M(c.tags),p=o.max,b=W(m(G));f?r="\n":l&&(r="\t"),l||(a()||h()?(f&&h()&&kn(),K(n)):D(r,e)||D(u,e)?(v<p?X():(vn(""),E("max.tags",[p])),K(n)):f?(kn(),K(n)):_((function(){var o=m(G)||"",f=W(o);D(o.slice(-1),e)?(v<p?X():(vn(""),E("max.tags",[p])),K(n)):""!==f||i||s||(""!==b||"Backspace"!==r&&"Backspace"!==u?"ArrowLeft"!==r&&37!==u||g&&g.focus():(x(U,"focus.tag"),bn(t=c.tags[v-1]),dn(t),g&&(E("change",[t,v-1]),E("let.tag",[t,v-1])))),P(J,f?"":y)}),0))}function en(n){if(b(U))for(var t;t=d(F);)bn(t.title);c.tags=[],u.value="",n=n?n.split(o.join):[];for(var e,r=0,i=o.max;r<i&&n[r];++r)if(""!==(e=W(n[r]))){if(pn(e))continue;hn(e),mn(e),E("change",[e,r]),E("set.tag",[e,r])}}function rn(n){if(!a()){var t=o.min;return X(),t>0&&M(c.tags)<t?(vn("",1),E("min.tags",[t]),void K(n)):1}}function un(){_((function(){a()||h()||en(m(G)),vn("")}),0)}function on(n){n&&U===n.target&&(G.focus(),Z())}function cn(){G.focus()}function fn(){var n=this.title,t=c.tags;L(U,["focus","focus.tag"]),E("blur.tag",[n,I(n,t)])}function an(){var n=this.title,t=c.tags;E("click.tag",[n,I(n,t)])}function sn(){var t=this.title,e=c.tags;!function(t,e){if(n(e))return e.forEach((function(n){return t.classList.add(n)})),t;if(r(e))for(var u in e)e[u]?t.classList.add(u):t.classList.remove(u);t.className=e}(U,["focus","focus.tag"]),E("focus.tag",[t,I(t,e)])}function ln(n){if(!a()&&!h()){var t=p(this).title,e=c.tags,r=I(t,e);bn(t),dn(t),vn("",1),E("change",[t,r]),E("click.tag",[t,r]),E("let.tag",[t,r])}K(n)}function gn(n){var t=n.key,e=n.keyCode,r=n.ctrlKey,u=n.shiftKey,i=this,o=v(i),f=d(i);if(!r&&!u)if(h()||"ArrowLeft"!==t&&37!==e)if(h()||"ArrowRight"!==t&&39!==e){if("Backspace"===t||8===e||"Delete"===t||46===e){if(!h()){var a=i.title,s=c.tags,l=I(a,s);x(U,"focus.tag"),bn(a),dn(a),"Backspace"===t||8===e?f?f.focus():vn("",1):o&&o!==F?o.focus():vn("",1),E("change",[a,l]),E("let.tag",[a,l])}K(n)}}else o&&o!==F?o.focus():vn("",1),K(n);else f&&(f.focus(),K(n))}function vn(n,t){P(G,n),P(J,n?"":y),t&&G.focus()}function pn(n,t){var r=c.tags,u=I(n,r);return t&&E("get.tag",[n,u]),e(u)?n:null}function dn(n){var t=c.tags,r=I(n,t);return!!(e(r)&&r>=0)&&(u.value=t.join(o.join),c.tags.splice(r,1),!0)}function mn(n,t){e(t)?(t=t<0?0:t,c.tags.splice(t,0,n)):c.tags.push(n),u.value=c.tags.join(o.join)}function hn(n,t){var r=C("span",{class:"tag",tabindex:!a()&&"0",title:n});if(o.x){var u=C("a",{href:"",tabindex:"-1",target:"_top"});R("click",u,ln),A(r,u)}R("blur",r,fn),R("click",r,an),R("focus",r,sn),R("keydown",r,gn),b(V)&&(e(t)&&c.tags[t]?B(l(V,t),r):B(F,r))}function bn(n){var t,r=I(n,c.tags);if(e(r)&&r>=0&&(t=l(V,r))){if(N("blur",t,fn),N("click",t,an),N("focus",t,sn),N("keydown",t,gn),o.x){var u=t.firstElementChild||null;u&&(N("click",u,ln),w(u))}w(t)}}function kn(){rn()&&Q&&Q.submit()}}return q.instances={},q.state={class:"tag-picker",escape:[",",188],join:", ",max:9999,min:0,x:!1},q.version="3.1.9",q}));