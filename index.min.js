/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=e()}(this,(function(){"use strict";var t=function(t,e){return-1!==e.indexOf(t)},e=function(t){return Array.isArray(t)},n=function(t){return void 0!==t},r=function(t){return"function"==typeof t},i=function(t,e){return t&&s(e)&&t instanceof e},a=function(t){return"number"==typeof t},u=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||i(t,Object))},s=function(t){return n(t)&&!function(t){return null===t}(t)},o=function(t){return"string"==typeof t},f=function(t){return t.length},c=function(t){return f(l(t))},l=function(t){return Object.keys(t)},p=function(t){return Object.values(t)},v=function(){for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];for(var a=r.shift(),o=0,c=f(r);o<c;++o)for(var l in r[o])if(s(a[l]))if(e(a[l])&&e(r[o][l])){a[l]=[].concat(a[l]);for(var p=0,h=f(r[o][l]);p<h;++p)t(r[o][l][p],a[l])||a[l].push(r[o][l][p])}else u(a[l])&&u(r[o][l])?a[l]=v({},a[l],r[o][l]):a[l]=r[o][l];else a[l]=r[o][l];return a},h=function(t){if(e(t))return t.map((function(e){return h(t)}));if(u(t)){for(var n in t)t[n]=h(t[n]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},g=document,_=window,d=function(t){return t.firstElementChild||null},m=function(t,e){var n=t.children;return a(e)?n[e]||null:n||[]},k=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},b=function(t,e){return e?t.closest(e)||null:t.parentNode||null},y=function(t){var e="form";return E(t,e)&&e===function(t){return(t&&t.nodeName||"").toLowerCase()||null}(t[e])?t[e]:b(t,e)},x=function(t,e){return t.previousElementSibling||null},j=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!E(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},w=function(t,e){return t.classList.contains(e)},E=function(t,e){return e in t},S=function(t,e){return t.removeAttribute(e),t},D=function(t,e){return t.classList.remove(e),t},A=function(t){var e=b(t);return t.remove(),e},T=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,h(n)),t},C=function(t,e){return t.append(e),e},R=function(t,e){return t.classList.add(e),t},L=function(t,e,n){return t=o(t)?g.createElement(t):t,u(e)&&(n=e,e=!1),o(e)&&O(t,e),u(n)&&function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?T(t,r,n):S(t,r)}(t,n),t},O=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="innerHTML";return E(t,r)&&(t[r]=n?e.trim():e),t},q=function(t,e){return b(t).insertBefore(e,t),e},N=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="textContent";return E(t,r)&&(t[r]=n?e.trim():e),t},K=function(t,e,n){return t.classList.toggle(e,n),t},P=function(t,e){return function(){var n=arguments,r=this;setTimeout((function(){return t.apply(r,n)}),e)}};var B=function(t,e,n){e.removeEventListener(t,n)},H=function(t){return t&&t.preventDefault()},I=function(t,e,n,r){void 0===r&&(r=!1),e.addEventListener(t,n,r)},M=function(t,e){return function(t){return i(t,RegExp)}(t)?t:RegExp(t,s(e)?e:"g")},W="ArrowLeft",z="ArrowRight",F="Home",G="Backspace",J="End",Q="Enter",U=new WeakMap;function V(t,e,n){Object.defineProperty(t,e,n)}function X(t){t.focus()}function Y(t){var e,n=_.getSelection();if(n.rangeCount)return(e=n.getRangeAt(0).cloneRange()).collapse(!0),e.setStart(t,0),(e+"").slice(-1)}function Z(t){return U.get(t)}function $(t){return(t.value||"").replace(/\r/g,"")}function tt(t){return t.disabled}function et(t){var e=g.getSelection();e.rangeCount&&e.removeRange(e.getRangeAt(0))}function nt(t,e){var n=g.getSelection();et();var r=g.createRange();r.selectNodeContents(t),n.addRange(r),1===e?n.collapseToEnd():-1===e&&n.collapseToStart()}function rt(t,e){return U.set(t,e)}function it(t,e){var n=this;if(!t)return n;if(!i(n,it))return new it(t,e);rt(t,function(t,e){return(e=e||t).fire=function(t,e){var n=this,r=n.hooks;return s(r[t])?(r[t].forEach((function(t){return t.apply(n,e)})),n):n},e.off=function(t,e){var n=this,r=n.hooks;if(!s(t))return r={},n;if(s(r[t]))if(s(e)){var i=r[t].length;if(0===i)delete r[t];else for(var a=0;a<i;++a)if(e===r[t][a]){r[t].splice(a,1);break}}else delete r[t];return n},e.on=function(t,e){var n=this.hooks;return s(n[t])||(n[t]=[]),s(e)&&n[t].push(e),this},t.hooks={},t}(n,it.prototype));var r=v({},it.state,o(e)?{join:e}:e||{});return u(e)&&e.escape&&(r.escape=e.escape),n.attach(t,r)}it.from=function(t,e){return new it(t,e)},it.of=Z,it.state={escape:[","],join:", ",max:1/0,min:0,n:"tag-picker",pattern:null,with:[]},it.version="4.1.0",V(it,"name",{value:"TagPicker"});var at=it.prototype;V(at,"text",{get:function(){return j(this._mask.input)},set:function(t){var e=this._mask,n=this.self,r=e.hint,i=e.input;N(r,""===(t+="")?n.placeholder:""),N(i,t),nt(i)}}),V(at,"value",{get:function(){var t=$(this.self);return""===t?null:t},set:function(t){var e=this;e._tags;var n=e.state;e.value&&e.value.split(n.join).forEach((function(t){return e.let(t,1)})),t.split(n.join).forEach((function(t){return e.set(t,-1,1)})),e.fire("change")}}),at._filter=function(t){var e=this.state;return(t||"").replace(/[^ -~]/g," ").split(e.join).join("").replace(/\s+/g," ").trim()};var ut=!1,st=!1;function ot(){et();var t=Z(this);t._mask;var e=t._tags,n=t.mask,r=t.state.n;if(!ut&&!st)for(var i in e)D(e[i],r+"__tag--selected");D(n,r+="--focus"),D(n,r+="-tag")}function ft(t){et();var e=Z(this),n=e._mask,r=e.mask,i=e.state,a=n.text,u=i.n;D(a,u+"__text--focus"),D(r,u+="--focus"),D(r,u+="-text"),e.fire("blur",[t])}function ct(t){var e=Z(this),n=t.target,r=e.state.n+"__tag";w(n,r)||b(n,"."+r)||e.focus()}function lt(t){var e=this,n=Z(e);n._tags;var r=n.state.n+"__tag--selected";R(e,r),X(e),nt(d(e))}function pt(t){var e=Z(this),n=e._tags,r=e.state,i=r.n+"__tag--selected",a=[];for(var u in n)w(n[u],i)&&a.push(u);t.clipboardData.setData("text/plain",a.join(r.join)),e.fire("copy",[t,a]).focus(),H(t)}function vt(t){var e=Z(this),n=e._mask,r=e._tags,i=e.state;n.input;var a=i.n+"__tag--selected",u=[];for(var s in r)w(r[s],a)&&(u.push(s),e.let(s,1));t.clipboardData.setData("text/plain",u.join(i.join)),e.fire("cut",[t,u]).fire("change",[this.title]).focus(),H(t)}function ht(t){var e=Z(this),n=e._mask,r=e._tags,i=e.mask,a=e.self,u=e.state,s=n.hint,o=n.input,f=n.text,c=u.n;for(var l in r)D(r[l],c+"__tag--selected");R(f,c+"__text--focus"),R(i,c+="--focus"),R(i,c+="-text"),P((function(){return N(s,j(o,!1)?"":a.placeholder)}),1)(),e.focus().fire("focus",[t])}function gt(){Z(this).focus()}function _t(t){Z(this).fire("min.tags").focus(),H(t)}function dt(t){var e=Z(this);e._mask;var n=e.mask,r=e.state.n;R(n,r+="--focus"),R(n,r+="-tag"),e.fire("focus.tag",[t])}function mt(t){var e,n=this,r=t.key,i=ut=t.ctrlKey,a=st=t.shiftKey,u=Z(n),s=u._mask,o=u._tags;u.mask;var c,l,v,h=u.state,g=s.text,_=x(n),m=k(n),b=h.n+"__tag--selected";if(a)R(n,b),nt(d(n)),W===r?(_&&(w(_,b)?D(n,b):R(_,b),X(_),nt(d(_))),e=!0):z===r&&(m&&g!==m&&(w(m,b)?D(n,b):R(m,b),X(m),nt(d(m))),e=!0);else if(i)if("a"===r){for(var y in o)X(o[y]),nt(d(o[y])),R(o[y],b);e=!0}else W===r?(_&&X(_),e=!0):z===r?(m&&g!==m?X(m):u.focus(),e=!0):Q!==r&&" "!==r||(K(n,b),w(n,b)?(X(n),nt(d(n))):nt(d(p(o).pop())),e=!0);else{var j=[];for(var E in o)w(o[E],b)&&j.push(E),n!==o[E]&&D(o[E],b);if(F===r)(c=p(o).shift())&&X(c),e=!0;else if(J===r)(l=p(o).pop())&&X(l),e=!0;else if(Q===r||" "===r)K(n,b),w(n,b)?(X(n),nt(d(n))):nt(d(p(o).pop())),e=!0;else if(W===r)_&&X(_),e=!0;else if(z===r)m&&g!==m?X(m):u.focus(),e=!0;else if(G===r){if(u.let(v=n.title,1),f(j)>1)for(var S;S=j.pop();)_=o[S]&&x(o[S]),u.let(S,1);u.fire("change",[v]),_?(X(_),nt(d(_))):u.focus(),e=!0}else if("Delete"===r){if(u.let(v=n.title,1),f(j)>1)for(var A;A=j.shift();)m=o[A]&&k(o[A]),u.let(A,1);u.fire("change",[v]),m&&g!==m?(X(m),nt(d(m))):u.focus(),e=!0}else"Escape"!==r&&"Tab"!==r||(u.focus(),e=!0)}e&&H(t)}function kt(t){var e=t.key,n=Z(this),r=n._tags,i=n.state.n+"__tag--selected";if(st)if(W===e||z===e);else{var a=0;for(var u in r)w(r[u],i)&&++a;a<2&&D(this,i)}ut=st=!1}function bt(e){var n=this,r=Y(n),i=Z(n),a=i.state.escape;if("\n"===r&&(t("\n",a)||t(13,a))||"\t"===r&&(t("\t",a)||t(9,a))||t(r,a))return i.set(j(n).slice(0,-1)).focus().text="",H(e)}function yt(e){var n,i=this,a=e.key,u=e.keyCode,s=ut=e.ctrlKey,o=st=e.shiftKey,f=Z(i),c=f._active,l=f._mask,v=f._tags;f.mask;var h,_,m=f.self,k=f.state,b=l.hint,x=k.n+"__tag--selected";if(escape=k.escape,!c)return H(e);if(Q===a&&(t("\n",escape)||t(13,escape))||"Tab"===a&&(t("\t",escape)||t(9,escape))||t(a,escape)||t(u,escape))return f.set(j(i)).focus().text="",H(e);P((function(){return N(b,j(i,!1)?"":m.placeholder)}),1)();var w,E=""===Y(i),S=null===j(i,!1);if(o)(S||E)&&W===a&&(_=p(v).pop())&&(_&&(X(_),nt(d(_))),R(_,x),n=!0);else if(s)if("a"===a&&null===j(i,!1)&&null!==f.value){for(var D in v)X(v[D]),nt(d(v[D])),R(v[D],x);n=!0}else F===a?((h=p(v).shift())&&X(h),n=!0):J===a||W===a?((_=p(v).pop())&&X(_),n=!0):G===a&&((_=p(v).pop())&&f.let(_.title),f.focus(),n=!0);else if(Q===a){var A=y(m);if(A&&r(A.requestSubmit)){var T=(w="button:not([type]),button[type=submit],input[type=image],input[type=submit]",(A||g).querySelector(w));T?A.requestSubmit(T):A.requestSubmit()}n=!0}else S?F===a?((h=p(v).shift())&&X(h),n=!0):J===a||W===a?((_=p(v).pop())&&X(_),n=!0):G===a&&((_=p(v).pop())&&f.let(_.title),f.focus(),n=!0):E&&W===a&&((_=p(v).pop())&&X(_),n=!0);n&&H(e)}function xt(){ut=st=!1}function jt(t){var e=Z(this),n=e._tags,r=e.state,i=r.n+"__tag--selected",a=!0,u=(t.clipboardData||_.clipboardData).getData("text")+"";for(var s in n)if(!w(n[s],i)){a=!1;break}a&&e.value&&e.value.split(r.join).forEach((function(t){return e.let(t,1)}));var o=u.split(r.join);o.forEach((function(t){return e.set(t,-1,1)})),e.fire("paste",[t,o]).focus().fire("change"),H(t)}function wt(t){var e=this,n=Z(e),r=n._mask,i=n.self,a=n.state,u=r.hint,s=(t.clipboardData||_.clipboardData).getData("text")+"";(function(t,e){var n,r=_.getSelection();r.rangeCount&&((n=r.getRangeAt(0)).deleteContents(),n.insertNode(g.createTextNode(e)))})(0,s),N(u,j(e)?"":i.placeholder),P((function(){if(s=j(e),n.text="",s){var r=s.split(a.join);r.forEach((function(t){return n.set(t,-1,1)})),n.fire("paste",[t,r]).fire("change")}}),1)(),H(t)}function Et(t){var e=this,n=Z(e),r=n._active,i=n._mask,a=n._tags,u=n.state,s=i.text,o=u.n+"__tag--selected";if(r){if(X(e),K(e,o),ut);else if(st){et();var c,l=b(e),v=(j="."+o,(l||g).querySelectorAll(j)),h=v[0],_=v[f(v)-1];if(h!==_)for(;(c=k(h))&&s!==c&&h!==_;)R(h=c,o)}else{et();var m=2===t.button,y=0;for(var x in a)w(a[x],o)&&++y,e===a[x]||m||D(a[x],o);y>0&&R(e,o)}var j;w(e,o)?(X(e),nt(d(e))):nt(p(a).pop()),n.fire("touch.tag",[t]),H(t),function(t){t&&t.stopPropagation()}(t)}}function St(t){var e=b(this),n=Z(e);n._mask.input,B("click",this,St),n.let(e.title).focus(),H(t)}function Dt(t){Z(this).let().fire("reset",[t])}function At(t){var e=Z(this),n=e._tags,r=e.state;return c(n)<r.min?(e.fire("min.tags").focus(),H(t)):e.fire("submit",[t])}return at.attach=function(t,n){var i=this;if(t=t||i.self,n&&o(n)&&(n={join:n}),n=v({},i.state,n||{}),w(t,n.n+"__self"))return i;(function(t){return t.required})(t)&&!n.min&&(n.min=1),i._active=!tt(t)&&!function(t){return t.readOnly}(t),i._tags={},i._value=$(t)||null,i.self=t,i.state=n;var a=n.n,c=y(t),l=L("div",{class:a,tabindex:!tt(t)&&-1});i.mask=l;var p,h,g=L("span",{class:a+"__tags"}),_=L("span",{class:a+"__text"}),d=L("span",{contenteditable:!tt(t)&&"",spellcheck:"false"}),m=L("span",t.placeholder+"");C(l,g),C(g,_),C(_,d),C(_,m),R(t,a+"__self"),h=l,b(p=t).insertBefore(h,k(p,!0)),c&&(rt(c,i),I("reset",c,Dt),I("submit",c,At)),I("blur",d,ft),I("click",l,ct),I("focus",t,gt),I("focus",d,ht),I("input",d,bt),I("invalid",t,_t),I("keydown",d,yt),I("keyup",d,xt),I("paste",d,wt),t.tabIndex=-1,rt(l,i),rt(d,i);var x={};if(x.hint=m,x.input=d,x.of=t,x.self=l,x.tags=g,x.text=_,i._mask=x,i._value&&i._value.split(n.join).forEach((function(t){return i.set(t,-1,1,1)})),s(n)&&e(n.with))for(var j=0,E=f(n.with);j<E;++j){var S=n.with[j];o(S)&&(S=it[S]),r(S)?S.call(i,t,n):u(S)&&r(S.attach)&&S.attach.call(i,t,n)}return i},at.blur=function(){et();var t=this._mask,e=this._tags,n=t.input;for(var r in e)e[r].blur();return n.blur()},at.detach=function(){var t=this,n=t._mask,i=t.mask,a=t.self,s=t.state,c=n.input;if(!w(a,s.n+"__self"))return t;var l=y(a);if(t._active=!1,t._value=$(a)||null,l&&(B("reset",l,Dt),B("submit",l,At)),B("blur",c,ft),B("click",i,ct),B("focus",c,ht),B("focus",a,gt),B("input",c,bt),B("invalid",a,_t),B("keydown",c,yt),B("keyup",c,xt),B("paste",c,wt),e(s.with))for(var p=0,v=f(s.with);p<v;++p){var h=s.with[p];o(h)&&(h=it[h]),u(h)&&r(h.detach)&&h.detach.call(t,a,s)}return a.tabIndex=null,D(a,s.n+"__self"),A(i),t._mask={of:a},t.mask=null,t},at.focus=function(t){var e=this._mask.input;return e&&(X(e),nt(e,t)),this},at.get=function(t){var e=this,n=e._active,r=e._tags;return!!n&&(e.fire("get.tag",[t]),r[t]?l(r).indexOf(t):null)},at.let=function(t,e){var r=this,i=r._active,a=r._tags,u=r._value,s=r.self,o=r.state;if(!i)return r;if(!n(t))return r.value&&r.value.split(o.join).forEach((function(t){return r.let(t,1)})),u.split(o.join).forEach((function(t){return r.set(t,-1,1)})),r.fire("change");if(c(a)<o.min)return r.fire("min.tags",[t]);if(!a[t])return r;var f=a[t];m(f,0);var p=m(f,1);return B("blur",f,ot),B("contextmenu",f,lt),B("copy",f,pt),B("cut",f,vt),B("focus",f,dt),B("keydown",f,mt),B("keyup",f,kt),B("mousedown",f,Et),B("mousedown",p,St),B("paste",f,jt),B("touchstart",f,Et),B("touchstart",p,St),A(f),delete r._tags[t],s.value=l(r._tags).join(o.join),r.fire("let.tag",[t]),e||r.fire("change",[t]),r},at.set=function(t,e,n,i){var u=this,s=u._active,f=u._filter,p=u._mask,v=u._tags,h=u.self,g=u.state,_=p.text,d=g.pattern,m=g.n;if(!s&&!i)return u;if(c(v)>=g.max)return u.fire("max.tags",[t]);if(r(f)&&(t=f.call(u,t)),u.fire("set.tag",[t]),""===t||o(d)&&!M(d).test(t))return u.fire("not.tag",[t]);if(v[t])return u.fire("has.tag",[t]);u.fire("is.tag",[t]);var k=L("span",{class:m+"__tag",tabindex:!!s&&-1,title:t}),b=L("span",t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")),y=L("span",{class:m+"__x",tabindex:-1});if(s&&(I("blur",k,ot),I("contextmenu",k,lt),I("copy",k,pt),I("cut",k,vt),I("focus",k,dt),I("keydown",k,mt),I("keyup",k,kt),I("mousedown",k,Et),I("mousedown",y,St),I("paste",k,jt),I("touchstart",k,Et),I("touchstart",y,St),rt(k,u)),C(k,b),C(k,y),function(t){return a(t)&&0==t%1}(e)&&e>=0){var x=l(v);x.splice(e,0,t),u._tags={},v[t]=k,x.forEach((function(t){u._tags[t]=v[t],q(_,v[t])}))}else q(_,k),u._tags[t]=k;return h.value=l(u._tags).join(g.join),u.fire("set.tag",[t]),n||u.fire("change",[t]),u},it}));