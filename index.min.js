/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2021 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).TP=n()}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},n=function(t,n){return t&&u(n)&&t instanceof n},e=function(t){return"number"==typeof t},r=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||n(t,Object))},u=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},i=function(t){return"string"==typeof t},o=function n(e){if(t(e))return e.map((function(t){return n(e)}));if(r(e)){for(var u in e)e[u]=n(e[u]);return e}return!1===e?"false":null===e?"null":!0===e?"true":""+e},c=function(t,n){var e=n.indexOf(t);return-1!==e?e:null},f=function(t){return t.toLowerCase()},s=function(t){return t.length},a=function(t){return Object.keys(t)},l=function n(e){if(t(e))return e.map((function(t){return n(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(e))return function(t,n){return void 0===n&&(n=10),n?parseInt(t,n):parseFloat(t)}(e);if(r(e)){for(var u in e)e[u]=n(e[u]);return e}return"false"!==e&&("null"===e?null:"true"===e||e)},g=document,p=window,d=function(t,n,e){if(void 0===e&&(e=!0),!x(t,n))return null;var r=t.getAttribute(n);return e?l(r):r},v=function(t,n){var r=t.children;return e(n)?r[n]||null:r||[]},m=function(t){return f(t&&t.nodeName||"")||null},b=function(t){return t.nextElementSibling||null},h=function(t){return t.parentNode||null},y=function(t){return t.previousElementSibling||null},k=function(t,n){void 0===n&&(n=!0);var e="textContent";if(!w(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},x=function(t,n){return t.hasAttribute(n)},E=function(t,n){return t.classList.contains(n)},L=function(t){return null!==h(t)},w=function(t,n){return n in t},A=function(t,n){return t.removeAttribute(n),t},T=function(t,n){return t.classList.remove(n),t},C=function(n,e){if(t(e))return e.forEach((function(t){return n.classList.remove(t)})),n;if(r(e)){for(var u in e)e[u]&&n.classList.remove(u);return n}return n.className="",n},O=function(t){var n=h(t);return t.remove(),n},B=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,o(e)),t},P=function(t,n){return t.append(n),n},R=function(t,n){return t.classList.add(n),t},K=function(n,e){if(t(e))return e.forEach((function(t){return n.classList.add(t)})),n;if(r(e))for(var u in e)e[u]?n.classList.add(u):n.classList.remove(u);return n.className=e,n},N=function(t,n,e){return t=i(t)?g.createElement(t):t,r(n)&&(e=n,n=!1),i(n)&&S(t,n),r(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?B(t,r,e):A(t,r)}(t,e),t},S=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="innerHTML";return w(t,r)&&(t[r]=e?n.trim():n),t},_=function(t,n){return h(t).insertBefore(n,t),n},D=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="textContent";return w(t,r)&&(t[r]=e?n.trim():n),t},z=function(t,n,e){n.removeEventListener(t,e)},F=function(t){return t&&t.preventDefault()},H=function(t,n,e){t.forEach((function(t){return z(t,n,e)}))},I=function(t,n,e,r){void 0===r&&(r=!1),n.addEventListener(t,e,r)},M=function(t,n,e,r){void 0===r&&(r=!1),t.forEach((function(t){return I(t,n,e,r)}))},$=function(t,n){return-1!==n.indexOf(t)};var q=function(t,e){return function(t){return n(t,RegExp)}(t)?t:(t=t.replace(/\//g,"\\/"),RegExp(t,u(e)?e:"g"))};let G=p.setTimeout;function J(r,o={}){if(!r)return;const l=this;if(r.TP)return;if(!n(l,J))return new J(r,o);let x=()=>r.disabled,A=()=>r.readOnly,B=d(r,"placeholder"),S=d(r,"tabindex"),{fire:Q}=function(t){var n={};return t.hooks=n,t.fire=function(e,r){return u(n[e])?(n[e].forEach((function(n){return n.apply(t,r)})),t):t},t.off=function(e,r){if(!u(e))return n={},t;if(u(n[e]))if(u(r)){for(var i=0,o=n[e].length;i<o;++i)if(r===n[e][i]){n[e].splice(i,1);break}0===j&&delete n[e]}else delete n[e];return t},t.on=function(e,r){return u(n[e])||(n[e]=[]),u(r)&&n[e].push(r),t},t}(l);var U;l.state=o=function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];return Object.assign.apply(Object,[{}].concat(n))}(J.state,i(o)?{join:o}:o||{}),l.source=r,J.instances[r.id||r.name||(U=J.instances,s(a(U)))]=l,r.TP=1;let V=o.class,W=V+"__",X=V+"--",Y=function(t){var n="form";if(w(t,n)&&n===m(t.form))return t.form;for(var e=h(t);e&&n!==m(e);)e=h(e);return e||null}(r),Z=N("span",{class:V,tabindex:!x()&&"-1"}),tt=N("span",{class:W+"tag "+W+"text"}),nt=N("span",{contenteditable:!x()&&"true",spellcheck:"false",style:"white-space:pre;"}),et=N("span"),rt=N("span",{class:W+"tags"}),ut=0,it={};function ot(){it={};let t,n=v(rt),e=s(n)-1;for(t=0;t<e;++t)E(n[t],W+"tag--focus")&&(it[t]=n[t])}function ct(t){return l.f(t).replace(q("("+o.escape.join("|").replace(/\\/g,"\\\\")+")+"),"").trim()}function ft(t){st(t,(function(t){T(this,W+"tag--focus")}))}function st(t,n){let e,r=v(rt),u=s(r)-1;for(e=0;e<u;++e)t!==r[e]&&n.call(r[e],e)}function at(t){it={};let n=this,e=t.type,r=n.title,u=l.tags,i=c(r,u),o=W+"tag--";"blur"===e?(T(n,o+"focus"),C(Z,[X+"focus",X+"focus-tag"])):(R(n,o+"focus"),K(Z,[X+"focus",X+"focus-tag"]),ut=i,it[i]=n),Q(e+".tag",[r,i])}function lt(t){let n=l.tags,e=t.type,r=W+"text--";"blur"===e?(T(tt,r+"focus"),C(Z,[X+"focus",X+"focus-text"]),vt()):(R(tt,r+"focus"),K(Z,[X+"focus",X+"focus-text"]),ft(tt)),Q(e,[n,s(n)])}function gt(t){"blur"===t.type?T(Z,X+"focus"):R(Z,X+"focus")}function pt(t){t&&Z===t.target&&nt.focus();let n=l.tags;Q("click",[n,s(n)])}function dt(){let t=this.title,n=l.tags;Q("click.tag",[t,c(t,n)])}function vt(){if(x()||A())return wt("");let t,n=ct(k(nt));n&&(At(n)?Q("has.tag",[n,c(n,l.tags)]):(Ot(n),Ct(n),t=s(l.tags),Q("change",[n,t]),Q("set.tag",[n,t])),wt(""))}function mt(){T(Z,X+"focus-self")}function bt(t){!function(t){t&&t.stopPropagation()}(t);let n,e=o.escape,r=t.key,u=t.keyCode,i=t.ctrlKey,c="Enter"===r||13===u,f=t.shiftKey,a="Tab"===r||9===u,g=y(tt),p=s(l.tags),d=o.max,v=ct(k(nt));c?r="\n":a&&(r="\t"),a||(!i||""!==v||"a"!==r&&65!==u?x()||A()?(c&&A()&&Pt(),F(t)):$(r,e)||$(u,e)?(p<d?vt():(wt(""),Q("max.tags",[d])),F(t)):c?(Pt(),F(t)):G((()=>{let o=k(nt)||"",c=ct(o);$(o.slice(-1),e)?(p<d?vt():(wt(""),Q("max.tags",[d])),F(t)):""!==c||i||f||(""!==v||"Backspace"!==r&&"Backspace"!==u?"ArrowLeft"!==r&&37!==u||g&&g.focus():(T(Z,X+"focus-tag"),n=l.tags[p-1],Bt(n),Tt(n),g&&(Q("change",[n,p-1]),Q("let.tag",[n,p-1])))),D(et,c?"":B)}),0):(Z.focus(),jt(t),F(t)))}function ht(t){l.tags;let n=t.key,e=t.keyCode,r=t.ctrlKey,u=t.shiftKey;if(A())return;let i,o,c,f,s,g=W+"tag--";if(r)"a"!==n&&65!==e||(Z.focus(),st(p,(function(t){R(this,W+"tag--focus")})),ot(),F(t));else if(u||"Backspace"!==n&&8!==e&&"Delete"!==n&&46!==e){if("ArrowLeft"===n||37===e)if(i=v(rt,ut-1)){let n=E(i,g+"focus");i.focus(),F(t),u?(R(o=b(i),g+"focus"),n&&T(o,g+"focus")):ft(i)}else u||ft(v(rt,0));else if(("ArrowRight"===n||39===e)&&(i=v(rt,ut+1))){let n=E(i,g+"focus");tt!==i||u?i.focus():wt("",1),F(t),u?(R(c=y(i),g+"focus"),n&&T(c,g+"focus")):ft(i)}}else{ot(),f=it;let r,u="Backspace"===n||8===e;for(s in f)i=f[s],Bt(r=i.title),Tt(r);ut=a(f),ut=+(ut[0]||0),(i=v(rt,u?ut-1:ut))?tt===i?wt("",1):i.focus():wt("",1),F(t)}var p}function yt(t){if(L(Z)){let t;for(;t=y(tt);)Bt(t.title)}l.tags=[],r.value="",t=t?t.split(o.join):[];for(let n,e=0,r=o.max;e<r&&t[e];++e)if(""!==(n=ct(t[e]))){if(At(n))continue;Ot(n),Ct(n),Q("change",[n,e]),Q("set.tag",[n,e])}}function kt(t){if(x())return;let n=o.min;return vt(),n>0&&s(l.tags)<n?(wt("",1),Q("min.tags",[n]),void F(t)):1}function xt(){G((()=>{x()||A()||yt(k(nt)),wt("")}),0)}function jt(t){t.key,t.keyCode,t.ctrlKey,R(Z,X+"focus-self")}function Et(){nt.focus()}function Lt(t){if(!x()&&!A()){let t=h(this).title,n=c(t,l.tags);Bt(t),Tt(t),wt("",1),Q("change",[t,n]),Q("click.tag",[t,n]),Q("let.tag",[t,n])}F(t)}function wt(t,n){if(D(nt,t),D(et,t?"":B),n){nt.focus();let t=g.createRange(),n=p.getSelection();t.selectNodeContents(nt),t.collapse(!1),n.removeAllRanges(),n.addRange(t)}}function At(t,n){let r=c(t,l.tags);return n&&Q("get.tag",[t,r]),e(r)?t:null}function Tt(t){let n=c(t,l.tags);return!!(e(n)&&n>=0)&&(l.tags.splice(n,1),r.value=l.tags.join(o.join),!0)}function Ct(t,n){e(n)?(n=n<0?0:n,l.tags.splice(n,0,t)):l.tags.push(t),r.value=l.tags.join(o.join)}function Ot(t,n){let r=N("span",{class:W+"tag",tabindex:!x()&&"0",title:t}),u=N("a",{class:W+"tag-x",href:"",tabindex:"-1",target:"_top"});I("click",u,Lt),P(r,u),I("click",r,dt),M(["blur","focus"],r,at),L(rt)&&(e(n)&&l.tags[n]?_(v(rt,n),r):_(tt,r))}function Bt(t){let n,r=c(t,l.tags);if(e(r)&&r>=0&&(n=v(rt,r))){z("click",n,dt),H(["blur","focus"],n,at);let t=n.firstElementChild||null;t&&(z("click",t,Lt),O(t)),O(n)}}function Pt(){kt()&&Y&&Y.dispatchEvent(new Event("submit",{cancelable:!0}))}var Rt,Kt;return wt(""),P(Z,rt),P(rt,tt),P(tt,nt),P(tt,et),R(r,W+"source"),Kt=Z,h(Rt=r).insertBefore(Kt,b(Rt)),N(r,{tabindex:"-1"}),M(["blur","focus"],nt,lt),I("blur",Z,mt),I("click",Z,pt),M(["blur","focus"],Z,gt),I("focus",Z,jt),I("focus",r,Et),I("keydown",nt,bt),I("keydown",Z,ht),I("paste",nt,xt),Y&&I("submit",Y,kt),l.click=()=>(Z.click(),pt(),l),l.f=t=>f(t||"").replace(/[^ a-z\d-]/g,""),l.get=t=>x()?null:At(t,1),l.input=nt,l.let=t=>{if(!x()&&!A())if(t){let n=o.min;if(vt(),n>0&&s(l.tags)<n)return Q("min.tags",[n]),l;Bt(t),Tt(t)}else yt("");return l},l.pop=()=>{if(!r.TP)return l;delete r.TP;let t=l.tags;return T(r,W+"source"),H(["blur","focus"],nt,lt),z("blur",Z,mt),z("click",Z,pt),H(["blur","focus"],Z,gt),z("focus",Z,jt),z("focus",r,Et),z("keydown",nt,bt),z("keydown",Z,ht),z("paste",nt,xt),Y&&z("submit",Y,kt),t.forEach(Bt),N(r,{tabindex:S}),O(Z),Q("pop",[t])},l.self=Z,l.set=(n,e)=>{if(!n)return l;if(!x()&&!A())if(t(n))yt(n.join(o.join));else{let t=l.tags,r=o.max;At(n)?Q("has.tag",[n,c(n,t)]):s(t)<r?(Ot(n,e),Ct(n,e)):Q("max.tags",[r])}return l},l.source=l.output=r,l.state=o,l.tags=[],yt(r.value),l}return J.instances={},J.state={class:"tag-picker",escape:[",",188],join:", ",max:9999,min:0},J.version="3.3.0",J}));