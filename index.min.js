/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=e()}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},e=function(t){return"function"==typeof t},n=function(t,e){return t&&u(e)&&t instanceof e},s=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||n(t,Object))},u=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},r=function(t){return"string"==typeof t},o=function(t){return t.toLowerCase()},i=function(t){return t.length},a=function(t){return Object.keys(t)},c=function(t){return Object.values(t)},f=function e(){for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];for(var a,c=r.shift(),f=0,l=i(r);f<l;++f)for(var v in r[f])if(u(c[v]))if(t(c[v])&&t(r[f][v])){c[v]=[].concat(c[v]);for(var p=0,h=i(r[f][v]);p<h;++p)a=r[f][v][p],-1===c[v].indexOf(a)&&c[v].push(r[f][v][p])}else s(c[v])&&s(r[f][v])?c[v]=e({},c[v],r[f][v]):c[v]=r[f][v];else c[v]=r[f][v];return c},l=function e(n){if(t(n))return n.map((function(t){return e(n)}));if(s(n)){for(var u in n)n[u]=e(n[u]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},v=document,p=window,h=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},_=function(t,e){return e?t.closest(e)||null:t.parentNode||null},m=function(t){var e="form";return y(t,e)&&e===function(t){return o(t&&t.nodeName||"")||null}(t[e])?t[e]:_(t,e)},d=function(t,e){return t.previousElementSibling||null},g=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!y(t,n))return!1;var s=t[n];return""!==(s=e?s.trim():s)?s:null},k=function(t,e){return t.classList.contains(e)},y=function(t,e){return e in t},b=function(t,e){return t.removeAttribute(e),t},x=function(t,e){return t.classList.remove(e),t},j=function(t){var e=_(t);return t.remove(),e},w=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,l(n)),t},E=function(t,e){return t.append(e),e},A=function(t,e){return t.classList.add(e),t},L=function(t,e,n){return t=r(t)?v.createElement(t):t,s(e)&&(n=e,e=!1),r(e)&&S(t,e),s(n)&&function(t,e){var n;for(var s in e)(n=e[s])||""===n||0===n?w(t,s,n):b(t,s)}(t,n),t},S=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var s="innerHTML";return y(t,s)&&(t[s]=n?e.trim():e),t},K=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var s="textContent";return y(t,s)&&(t[s]=n?e.trim():e),t},R=function(t,e,n){return t.classList.toggle(e,n),t},C=function(t,e){return function(){var n=arguments,s=this;setTimeout((function(){return t.apply(s,n)}),e)}};var T=function(t,e,n){e.removeEventListener(t,n)},O=function(t){return t&&t.preventDefault()},q=function(t,e,n,s){void 0===s&&(s=!1),e.addEventListener(t,n,s)},P=function(t,e){return function(t){return n(t,RegExp)}(t)?t:RegExp(t,u(e)?e:"g")},B="ArrowLeft",N="ArrowRight",D="Home",H="Backspace",I="End",M="Enter",V={focusVisible:!0},W="TagPicker";function Z(t,e,n){Object.defineProperty(t,e,n)}function $(t){return t.disabled}function z(t){var e,n=v.createRange();n.selectNodeContents(t),n.collapse(!1),(e=p.getSelection()).removeAllRanges(),e.addRange(n)}function F(t,e){var s=this;return t?n(s,F)?(t["_"+W]=function(t,e){return(e=e||t).fire=function(t,e){var n=this,s=n.hooks;return u(s[t])?(s[t].forEach((function(t){return t.apply(n,e)})),n):n},e.off=function(t,e){var n=this,s=n.hooks;if(!u(t))return s={},n;if(u(s[t]))if(u(e)){var r=s[t].length;if(0===r)delete s[t];else for(var o=0;o<r;++o)if(e===s[t][o]){s[t].splice(o,1);break}}else delete s[t];return n},e.on=function(t,e){var n=this.hooks;return u(n[t])||(n[t]=[]),u(e)&&n[t].push(e),this},t.hooks={},t}(s,F.prototype),s.attach(t,f({},F.state,r(e)?{join:e}:e||{}))):new F(t,e):s}F.state={class:"tag-picker",escape:[","],join:", ",max:9999,min:0,pattern:null,with:[]},F.version="4.0.0",Z(F,"name",{value:W});var G=F.prototype;function J(){var t=this["_"+W].state;x(this,t.class+"--focus")}function Q(){var t=this["_"+W];t._mask;var e=t.mask,n=t.state.class;x(e,n+="--focus"),x(e,n+="-tag")}function U(){var t=this["_"+W],e=t._mask,n=t.mask,s=t.state,u=e.text,r=s.class;x(u,r+"__text--focus"),x(n,r+="--focus"),x(n,r+="-text")}function X(t){var e=this["_"+W],n=e._mask,s=e._tags,u=e.mask,r=e.state,o=n.copy,a=r.class+"__tag--focus",c=[];for(var f in s)k(s[f],a)&&c.push(f);i(c)&&(u!==_(o)&&(o.value=c.join(r.join),E(u,o)),o.focus(),o.select())}function Y(){var t=this,e=t["_"+W];e._mask.input,C((function(){return j(t),e.focus()}),1)()}function tt(){var t=this,e=t["_"+W],n=e._mask,s=e.state;n.input,t.value.split(s.join).forEach((function(t){return e.let(t)})),C((function(){return j(t),e.focus()}),1)()}function et(){var t=this["_"+W];t._tags;var e=t.mask,n=t.state.class;A(e,n+"--focus"),A(e,n+"--select")}function nt(){var t=this["_"+W],e=t._mask,n=t._tags,s=t.mask,u=t.self,r=t.state,o=e.copy,i=e.hint,a=e.input,c=e.text,f=r.class;for(var l in n)x(n[l],f+"__tag--focus");j(o),x(s,f+"--select"),A(c,f+"__text--focus"),A(s,f+="--focus"),A(s,f+="-text"),z(a),C((function(){return K(i,g(a,!1)?"":u.placeholder)}),1)()}function st(){this["_"+W].focus()}function ut(){var t=this["_"+W].state.class;A(this,t+"--focus")}function rt(){var t=this["_"+W];t._mask;var e=t.mask,n=t.state.class;A(e,n+="--focus"),A(e,n+="-tag")}Z(G,"text",{get:function(){return g(this._mask.input)},set:function(t){K(this._mask.input,t)}}),Z(G,"value",{get:function(){var t=this.self.value;return""===t?null:t},set:function(t){var e=this,n=e.state;t.split(n.join).forEach((function(t){return e.set(t)}))}}),G._filter=function(t){var e,n,s=this.state;return t=(t||"").split(s.join).join("").trim(),(e=t,void 0===n&&(n="-"),e.replace(/[A-Z]/g,(function(t){return n+o(t)})).replace(/\W+/g,n)).replace(/^-+|-+$/g,"")};var ot=!1;function it(t){t.key;var e=this["_"+W];e.mask,e.state.class,ot=t.ctrlKey,t.shiftKey}function at(t){var e,n,s,u=this,r=t.key,o=ot=t.ctrlKey,i=t.shiftKey,a=u["_"+W],f=a._mask,l=a._tags,v=a.mask,p=a.state,_=f.copy,m=f.text,g=d(u),k=h(u),y=p.class+"__tag--focus";if(o){if(!i&&"a"===r){for(var b in l)A(l[b],y);_.value=a.value,E(v,_),_.focus(),_.select(),e=!0}}else i||x(u,y),D===r?((n=c(l).shift())&&n.focus(V),e=!0):I===r?((s=c(l).pop())&&s.focus(V),e=!0):M===r||" "===r?(R(u,y),e=!0):B===r?(g&&g.focus(V),e=!0):N===r?(k&&m!==k?k.focus(V):a.focus(),e=!0):H===r?(a.let(u.title),g?g.focus(V):a.focus(),e=!0):"Delete"===r&&(a.let(u.title),k&&m!==k?k.focus(V):a.focus(),e=!0);e&&O(t)}function ct(t){var e=this,n=t.key,s=ot=t.ctrlKey;t.shiftKey;var u=e["_"+W],r=u._mask,o=u._tags,i=u.state,a=r.copy;r.input;var f,l,v,p,_=r.text,m=i.class+"__tag--focus";function g(){for(var t in j(a),o)x(o[t],m)}if(s){if("a"===n){for(var k in o)A(o[k],m);a.value=u.value,a.focus(),a.select()}}else B===n?(f=o[e.value.split(i.join).shift()],g(),(p=d(f))?p.focus(V):f.focus(V)):N===n?(l=o[e.value.split(i.join).pop()],g(),(v=h(l))&&_!==v?v.focus(V):l.focus(V)):D===n?(g(),c(o).shift().focus(V)):I===n?(g(),c(o).pop().focus(V)):M===n||" "===n?(l=e.value.split(i.join).pop(),g(),o[l].focus(V),O(t)):"Escape"===n?(g(),u.focus()):(e.value.split(i.join).forEach((function(t){return u.let(t)})),u.focus())}function ft(t){var n,s,u,r,o=this,i=t.key,a=t.keyCode,f=ot=t.ctrlKey,l=t.shiftKey,h=o["_"+W],_=h._mask,d=h._tags,k=h.mask,y=h.self,b=h.state,x=_.copy,j=_.hint,w=b.class+"__tag--focus";if((escape=b.escape).includes(i)||escape.includes(a))return h.set(g(o)),K(o,""),K(j,y.placeholder),h.focus(),O(t);C((function(){return K(j,g(o,!1)?"":y.placeholder)}),1)();var L,S=""===function(t){var e,n=p.getSelection();if(n.rangeCount>0)return(e=n.getRangeAt(0).cloneRange()).collapse(!0),e.setStart(t,0),(e+"").slice(-1)}(o),R=null===g(o,!1);if(D===i&&(f||R))(u=c(d).shift())&&u.focus(V),n=!0;else if(I===i&&(f||R))(r=c(d).pop())&&r.focus(V),n=!0;else if(B===i&&(f||S))(r=c(d).pop())&&r.focus(V),n=!0;else if(H===i&&R)(r=c(d).pop())&&h.let(r.title),h.focus(),n=!0;else if(M===i){var T=m(y);if(T&&e(T.requestSubmit)){var q=(L="button:not([type]),button[type=submit],input[type=image],input[type=submit]",(T||v).querySelector(L));q?T.requestSubmit(q):T.requestSubmit()}n=!0}else if(f&&!l&&"a"===i&&null===g(o,!1)&&null!==(s=h.value)){for(var P in d)A(d[P],w);x.value=s,E(k,x),x.focus(),x.select(),n=!0}n&&O(t)}function lt(){var t=this["_"+W],e=t._mask,n=t._tags,s=t.mask,u=t.state,r=e.copy,o=u.class+"__tag--focus";ot=!1;var a=[];for(var c in n)k(n[c],o)&&a.push(c);i(a)&&(r.value=a.join(u.join),E(s,r),r.focus(),r.select())}function vt(){var t=this,e=t.value,n=t["_"+W],s=n._mask,u=n.state,r=s.copy;s.input,C((function(){""!==e&&e.split(u.join).forEach((function(t){return n.let(t)})),""!==(e=t.value)&&e.split(u.join).forEach((function(t){return n.set(t)})),j(r),n.focus()}),1)()}function pt(){var t=this,e=t["_"+W],n=e._mask,s=e.state,u=n.hint;C((function(){var n=g(t);null!==n&&n.split(s.join).forEach((function(t){return e.set(t)})),K(t,""),K(u,e.self.placeholder)}),1)()}function ht(t){var e=this["_"+W],n=e._mask,s=e._tags,u=e.mask,r=e.state,o=n.copy,i=n.input,a=r.class+"__tag--focus";if(u===_(o))if(i===t.target){for(var c in s)k(s[c],a);e.focus()}else o.focus(),o.select();else e.focus();O(t)}function _t(t){var e=this,n=e["_"+W],s=n._mask,u=n._tags,r=n.mask,o=n.state,i=s.copy,a=o.class+"__tag--focus";if(ot){R(e,a);var c=[];for(var f in u)k(u[f],a)&&c.push(f);i.value=c.join(o.join),i.focus(),i.select()}else{var l=0;for(var v in u)e!==u[v]&&(k(u[v],a)&&++l,x(u[v],a));l>1?A(e,a):R(e,a),k(e,a)?(i.value=e.title,E(r,i),C((function(){return i.focus(),i.select()}),1)()):j(i)}!function(t){t&&t.stopPropagation()}(t)}function mt(t){var e=_(this),n=e["_"+W];n._mask.input,T("click",this,mt),n.let(e.title),n.focus(),O(t)}return G.attach=function(n,o){var a=this;n=n||a.self,o=o||a.state,a._active=!0,a._tags={},a._value=function(t){return t.value.replace(/\r/g,"")}(n),a.self=n,a.state=o;var c=o.class,f="_"+W;m(n);var l=L("div",{class:c,tabindex:!$(n)&&-1});a.mask=l;var v,p,d=L("span",{class:c+"__tags"}),g=L("span",{class:c+"__text"}),k=L("input",{class:c+"__copy",tabindex:-1,type:"text"}),y=L("span",{contenteditable:!$(n)&&"true",spellcheck:"false",style:"white-space:pre;"}),b=L("span",n.placeholder+"");E(l,d),E(d,g),E(g,y),E(g,b),A(n,c+"__self"),p=l,_(v=n).insertBefore(p,h(v,!0)),q("blur",l,J),q("blur",y,U),q("contextmenu",l,X),q("copy",k,Y),q("cut",k,tt),q("focus",l,ut),q("focus",n,st),q("focus",k,et),q("focus",y,nt),q("keydown",l,it),q("keydown",k,ct),q("keydown",y,ft),q("keyup",l,lt),q("mousedown",l,ht),q("paste",k,vt),q("paste",y,pt),q("touchstart",l,ht),n.tabIndex=-1,l[f]=a,k[f]=a,y[f]=a;var x={};if(x.copy=k,x.hint=b,x.input=y,x.of=n,x.self=l,x.tags=d,x.text=g,a._mask=x,u(o)&&t(o.with))for(var j=0,w=i(o.with);j<w;++j){var S=o.with[j];r(S)&&(S=F[S]),e(S)?S.call(a,n,o):s(S)&&e(S.attach)&&S.attach.call(a,n,o)}return a},G.blur=function(){},G.click=function(){},G.detach=function(){var n=this,u=n._mask,o=n.mask,a=n.self,c=n.state,f=u.copy,l=u.input;if(n._active=!1,T("blur",l,U),T("blur",o,J),T("contextmenu",o,X),T("copy",f,Y),T("cut",f,tt),T("focus",f,et),T("focus",l,nt),T("focus",o,ut),T("focus",a,st),T("keydown",f,ct),T("keydown",l,ft),T("keydown",o,it),T("keydown",o,lt),T("mousedown",o,ht),T("paste",f,vt),T("paste",l,pt),T("touchstart",o,ht),t(c.with))for(var v=0,p=i(c.with);v<p;++v){var h=c.with[v];r(h)&&(h=F[h]),s(h)&&e(h.detach)&&h.detach.call(n,a,c)}return a.tabIndex=null,x(a,c.class+"__self"),j(o),n._mask={of:a},n.mask=null,n},G.focus=function(){var t=this._mask.input;return t&&t.focus(),z(t),this},G.get=function(t){var e=this._active,n=this._tags;return!!e&&(n[t]?t:null)},G.let=function(t){var e=this,n=e._active,s=e._tags,u=e.self,r=e.state;if(!n)return e;if(!s[t])return!1;var o=s[t],i=o.firstElementChild||null;return T("blur",o,Q),T("focus",o,rt),T("keydown",o,at),T("mousedown",o,_t),T("mousedown",i,mt),T("touchstart",o,_t),T("touchstart",i,mt),j(o),delete e._tags[t],u.value=a(e._tags).join(r.join),e},G.set=function(t){var n=this,s=n._active,u=n._filter,o=n._mask,i=n._tags,c=n.self,f=n.state,l=o.text,v=f.pattern,p=f.class;if(!s)return n;if(e(u)&&(t=u.call(n,t)),r(v)&&P(v)&&!P(v).test(t))return!1;if(""===t||i[t])return!1;var h,m,d=L("span",{class:p+="__tag",tabindex:-1,title:t}),g=L("span",{class:p+="-x",tabindex:-1});return q("blur",d,Q),q("focus",d,rt),q("keydown",d,at),q("mousedown",d,_t),q("mousedown",g,mt),q("touchstart",d,_t),q("touchstart",g,mt),d["_"+W]=n,E(d,g),m=d,_(h=l).insertBefore(m,h),n._tags[t]=d,c.value=a(n._tags).join(f.join),n},F}));