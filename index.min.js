/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2021 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TP=e()}(this,(function(){"use strict";var t=function(t,e){return-1!==e.indexOf(t)},e=function(t){return Array.isArray(t)},n=function(t,e){return t&&i(e)&&t instanceof e},r=function(t){return"number"==typeof t},u=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||n(t,Object))},i=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},o=function(t){return"string"==typeof t},f=function(t,e){var n=e.indexOf(t);return-1!==n?n:null},c=function(t){return t.toLowerCase()},s=function(t){return t.length},a=function(t){return Object.keys(t)},l=function t(n){if(e(n))return n.map((function(e){return t(e)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(n))return function(t,e){return void 0===e&&(e=10),e?parseInt(t,e):parseFloat(t)}(n);if(u(n)){for(var r in n)n[r]=t(n[r]);return n}return"false"!==n&&("null"===n?null:"true"===n||n)},g=function n(){for(var r=arguments.length,o=Array(r),f=0;f<r;f++)o[f]=arguments[f];for(var c=o.shift(),a=0,l=s(o);a<l;++a)for(var g in o[a])if(i(c[g]))if(e(c[g])&&e(o[a][g])){c[g]=[].concat(c[g]);for(var p=0,d=s(o[a][g]);p<d;++p)t(o[a][g][p],c[g])||c[g].push(o[a][g][p])}else u(c[g])&&u(o[a][g])?c[g]=n({},c[g],o[a][g]):c[g]=o[a][g];else c[g]=o[a][g];return c},p=function t(n){if(e(n))return n.map((function(e){return t(n)}));if(u(n)){for(var r in n)n[r]=t(n[r]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},d=document,v=window,m=function(t,e,n){if(void 0===n&&(n=!0),!L(t,e))return null;var r=t.getAttribute(e);return n?l(r):r},h=function(t,e){var n=t.children;return r(e)?n[e]||null:n||[]},b=function(t){return c(t&&t.nodeName||"")||null},y=function(t){return t.nextElementSibling||null},x=function(t){return t.parentNode||null},k=function(t){return t.previousElementSibling||null},E=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!T(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},L=function(t,e){return t.hasAttribute(e)},w=function(t,e){return t.classList.contains(e)},A=function(t){return null!==x(t)},T=function(t,e){return e in t},R=function(t,e){return t.removeAttribute(e),t},C=function(t,e){return t.classList.remove(e),t},P=function(t,n){if(e(n))return n.forEach((function(e){return t.classList.remove(e)})),t;if(u(n)){for(var r in n)n[r]&&t.classList.remove(r);return t}return t.className="",t},N=function(t){var e=x(t);return t.remove(),e},O=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,p(n)),t},S=function(t,e){return t.append(e),e},K=function(t,e){return t.classList.add(e),t},B=function(t,n){if(e(n))return n.forEach((function(e){return t.classList.add(e)})),t;if(u(n))for(var r in n)n[r]?t.classList.add(r):t.classList.remove(r);return t.className=n,t},_=function(t,e,n){return t=o(t)?d.createElement(t):t,u(e)&&(n=e,e=!1),o(e)&&D(t,e),u(n)&&function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?O(t,r,n):R(t,r)}(t,n),t},D=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="innerHTML";return T(t,r)&&(t[r]=n?e.trim():e),t},H=function(t,e){return x(t).insertBefore(e,t),e},z=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="textContent";return T(t,r)&&(t[r]=n?e.trim():e),t},F=function(t,e,n){e.removeEventListener(t,n)},I=function(t){return t&&t.preventDefault()},M=function(t,e,n){t.forEach((function(t){return F(t,e,n)}))},$=function(t,e,n,r){void 0===r&&(r=!1),e.addEventListener(t,n,r)},q=function(t,e,n,r){void 0===r&&(r=!1),t.forEach((function(t){return $(t,e,n,r)}))};var G=function(t,e){return function(t){return n(t,RegExp)}(t)?t:(t=t.replace(/\//g,"\\/"),RegExp(t,i(e)?e:"g"))};let J=v.setTimeout;const Q="ArrowLeft",U="Backspace";function V(u,l={}){if(!u)return;const p=this;if(u.TP)return;if(!n(p,V))return new V(u,l);let L=()=>u.disabled,R=()=>u.readOnly,O=m(u,"placeholder"),D=m(u,"tabindex"),{hooks:W,fire:X}=function(t){var e={};return t.hooks=e,t.fire=function(n,r){return i(e[n])?(e[n].forEach((function(e){return e.apply(t,r)})),t):t},t.off=function(n,r){if(!i(n))return e={},t;if(i(e[n]))if(i(r)){for(var u=0,o=e[n].length;u<o;++u)if(r===e[n][u]){e[n].splice(u,1);break}0===j&&delete e[n]}else delete e[n];return t},t.on=function(n,r){return i(e[n])||(e[n]=[]),i(r)&&e[n].push(r),t},t}(p);var Y;p.state=l=g({},V.state,o(l)?{join:l}:l||{}),p.source=u,V.instances[u.id||u.name||(Y=V.instances,s(a(Y)))]=p,u.TP=1;let Z,tt,et=l.class,nt=et+"__",rt=et+"--",ut=function(t){var e="form";if(T(t,e)&&e===b(t.form))return t.form;for(var n=x(t);n&&e!==b(n);)n=x(n);return n||null}(u),it=_("span",{class:et,tabindex:!L()&&"-1"}),ot=_("span",{class:nt+"tag "+nt+"text"}),ft=_("input",{class:nt+"copy",type:"text"}),ct=_("span",{contenteditable:!L()&&"true",spellcheck:"false",style:"white-space:pre;"}),st=_("span"),at=_("span",{class:nt+"tags"}),lt=0,gt={};function pt(t,e){let n=f(t,p.tags);return e&&X("get.tag",[t,n]),r(n)?t:null}function dt(){gt={};let t,e=h(at),n=s(e)-1;for(t=0;t<n;++t)w(e[t],nt+"tag--selected")&&(gt[t]=e[t])}function vt(t,e){r(e)?(e=e<0?0:e,p.tags.splice(e,0,t)):p.tags.push(t),u.value=p.tags.join(l.join)}function mt(t,e){let n=_("span",{class:nt+"tag",tabindex:!L()&&"0",title:t}),u=_("a",{class:nt+"tag-x",href:"",tabindex:"-1",target:"_top"});$("click",u,Bt),S(n,u),$("click",n,Kt),q(["blur","focus"],n,Pt),A(at)&&(r(e)&&p.tags[e]?H(h(at,e),n):H(ot,n))}function ht(e){if(e=e?e.split(l.join):[],A(it)){let n,r,u;for(;n=k(ot);)yt(u=n.title),t(u,e)||(r=f(u,p.tags),X("change",[u,r]),X("let.tag",[u,r]))}p.tags=[],u.value="";for(let t,n=0,r=l.max;n<r&&e[n];++n)""!==(t=Tt(e[n]))&&(mt(t),vt(t),X("change",[t,n]),X("set.tag",[t,n]))}function bt(t){let e=f(t,p.tags);r(e)&&e>=0&&(p.tags.splice(e,1),u.value=p.tags.join(l.join))}function yt(t){let e,n=f(t,p.tags);if(r(n)&&n>=0&&(e=h(at,n))){F("click",e,Kt),M(["blur","focus"],e,Pt);let t=e.firstElementChild||null;t&&(F("click",t,Bt),N(t)),N(e)}}function xt(t){N(ft),t&&Et("",1)}function kt(t){S(it,ft),ft.value=p.tags.join(l.join),t&&(ft.focus(),ft.select())}function Et(t,e){if(z(ct,t),z(st,t?"":O),e){ct.focus();let t=d.createRange(),e=v.getSelection();t.selectNodeContents(ct),t.collapse(!1),e.removeAllRanges(),e.addRange(t)}}function jt(t){At(t,(function(){C(this,nt+"tag--selected")}))}function Lt(t){At(t,(function(){K(this,nt+"tag--selected")}))}function wt(){if(L()||R())return;let t=Rt(E(ct)).trim(),e=l.pattern;if(e&&t&&!G(e,"").test(t))return X("not.tag",[t,-1]),void Et(t,1);if(Et(""),t=Tt(t))if(pt(t))X("has.tag",[t,f(t,p.tags)]);else{mt(t),vt(t);let e=s(p.tags);X("change",[t,e]),X("set.tag",[t,e])}}function At(t,e){let n,r=h(at),u=s(r)-1;for(n=0;n<u;++n)t!==r[n]&&e.call(r[n],n)}function Tt(t){return Rt(p.f(t)).trim()}function Rt(t){return t=t||"",l.escape.forEach((e=>{t=t.split(e).join("")})),t}function Ct(t){"blur"===t.type?(jt(),P(it,[rt+"focus",rt+"focus-self"])):B(it,[rt+"focus",rt+"focus-self"])}function Pt(t){if(R())return;gt={};let e=this,n=t.type,r=e.title,u=p.tags,i=f(r,u),o=nt+"tag--";"blur"===n?Z&&!tt||(jt(e),C(e,o+"selected"),P(it,[rt+"focus",rt+"focus-tag"])):(K(e,o+"selected"),B(it,[rt+"focus",rt+"focus-tag"]),lt=i,gt[i]=e),X(n+".tag",[r,i])}function Nt(t){let e=p.tags,n=t.type,r=nt+"text--";"blur"===n?(C(ot,r+"focus"),P(it,[rt+"focus",rt+"focus-text"]),wt()):(K(ot,r+"focus"),B(it,[rt+"focus",rt+"focus-text"]),jt(ot)),X(n,[e,s(e)])}function Ot(t){"blur"===t.type?C(it,rt+"focus"):K(it,rt+"focus")}function St(t){t&&it===t.target&&ct.focus();let e=p.tags;X("click",[e,s(e)])}function Kt(){let t=this.title,e=p.tags;X("click.tag",[t,f(t,e)])}function Bt(t){if(!L()&&!R()){let t=x(this).title,e=f(t,p.tags);yt(t),bt(t),Et("",1),X("change",[t,e]),X("click.tag",[t,e]),X("let.tag",[t,e])}I(t)}function _t(t){let e=t.type;"copy"===e?J((()=>xt(1))):"cut"===e?(!R()&&ht(""),J((()=>xt(1)))):"paste"===e&&J((()=>{!R()&&ht(ft.value),xt(1)})),J((()=>{let t=p.tags;X(e,[t,s(t)])}),1)}function Dt(){jt(),C(it,rt+"focus-self")}function Ht(){ct.focus()}function zt(t){if(L())return;p.tags;let e,n,r,u,i,o,f=t.key,c=t.ctrlKey,l=Z=t.shiftKey,g=nt+"tag--";if(tt="Tab"===f,!R())if(c)"a"===f&&(kt(1),Lt(),dt(),I(t));else if(l||U!==f&&"Delete"!==f){if("Home"===f)(e=h(at,0))&&(e.focus(),I(t));else if("End"===f)(e=h(at,s(p.tags)-1))&&(e.focus(),I(t));else if(Q===f)if(e=h(at,lt-1)){let n=w(e,g+"selected");e.focus(),I(t),l?(r=y(e),n&&C(r,g+"selected")):jt(e)}else l||jt(h(at,0));else if("ArrowRight"===f&&(e=h(at,lt+1))){let n=w(e,g+"selected");ot!==e||l?e.focus():Et("",1),I(t),l?(u=k(e),n&&C(u,g+"selected")):jt(e)}}else{dt(),o=gt;let r=U===f;for(n in o)e=o[n],yt(i=e.title),bt(i);lt=+(a(o)[0]||0),(e=h(at,r?lt-1:lt))?ot===e?Et("",1):e.focus():Et("",1),I(t)}}function Ft(e){!function(t){t&&t.stopPropagation()}(e),R()&&I(e);let n,r=l.escape,u=k(ot),i=s(p.tags),o=l.max,f=Tt(E(ct)),c=e.key,a=e.ctrlKey,g="Enter"===c;e.shiftKey;let d="Tab"===c;if(g&&(c="\n"),d&&(c="\t"),J((()=>{let n=Tt(E(ct));z(st,n?"":O),t(function(t){let e,n=v.getSelection();if(n.rangeCount>0)return e=n.getRangeAt(0).cloneRange(),e.collapse(!0),e.setStart(t,0),(e+"").slice(-1)}(ct),r)&&(i<o?wt():(Et(""),X("max.tags",[o])),I(e))})),a&&""===f&&"a"===c)return kt(1),Lt(),dt(),void I(e);if(t(c,r))return i<o?wt():(Et(""),X("max.tags",[o])),void I(e);if(!d){if(!a&&g)return $t()&&ut&&ut.dispatchEvent(new Event("submit",{cancelable:!0})),void I(e);if(u&&""===f&&!R()){if(U===c)return n=p.tags[i-1],yt(n),bt(n),X("change",[n,i-1]),X("let.tag",[n,i-1]),void I(e);if(Q===c)return void u.focus()}}}function It(){Z=!1}function Mt(){J((()=>{L()||R()||E(ct).split(l.join).forEach((e=>{t(e,p.tags)||(mt(e),vt(e))})),Et("")}))}function $t(t){if(L())return;let e=l.min;return wt(),e>0&&s(p.tags)<e?(Et("",1),X("min.tags",[e]),void I(t)):1}var qt,Gt;return Et(""),S(it,at),S(ot,ct),S(ot,st),S(at,ot),K(u,nt+"source"),Gt=it,x(qt=u).insertBefore(Gt,y(qt)),_(u,{tabindex:"-1"}),$("blur",it,Dt),$("click",it,St),$("focus",u,Ht),$("keydown",it,zt),$("keydown",ct,Ft),$("keyup",it,It),$("paste",ct,Mt),q(["blur","focus"],it,Ot),q(["blur","focus"],ft,Ct),q(["blur","focus"],ct,Nt),q(["copy","cut","paste"],ft,_t),ut&&$("submit",ut,$t),p.blur=()=>(!L()&&ct.blur(),p),p.click=()=>(it.click(),St(),p),p.f=t=>c(t||"").replace(/[^ a-z\d-]/g,"").trim(),p.focus=()=>(L()||Et(E(ct),1),p),p.get=t=>L()?null:pt(t,1),p.input=ct,p.let=t=>{if(!L()&&!R()){let n=l.min;if(t)if(e(t))t.forEach((t=>{if(n>0&&s(p.tags)<n)return X("min.tags",[n]),p;yt(t),bt(t)}));else{if(n>0&&s(p.tags)<n)return X("min.tags",[n]),p;yt(t),bt(t)}else ht("")}return p},p.pop=()=>{if(!u.TP)return p;delete u.TP;let t=p.tags;return C(u,nt+"source"),F("blur",it,Dt),F("click",it,St),F("focus",u,Ht),F("keydown",it,zt),F("keydown",ct,Ft),F("keyup",it,It),F("paste",ct,Mt),M(["blur","focus"],it,Ot),M(["blur","focus"],ft,Ct),M(["blur","focus"],ct,Nt),M(["copy","cut","paste"],ft,_t),ut&&F("submit",ut,$t),t.forEach(yt),_(u,{tabindex:D}),N(it),X("pop",[t])},p.self=it,p.set=(t,n)=>{if(!t)return p;if(!L()&&!R())if(e(t))ht(t.join(l.join));else{let e=p.tags,r=l.max;pt(t)?X("has.tag",[t,f(t,e)]):s(e)<r?(mt(t,n),vt(t,n)):X("max.tags",[r])}return p},p.source=p.output=u,p.state=l,p.tags=[],ht(u.value),p}return V.instances={},V.state={class:"tag-picker",escape:[","],join:", ",max:9999,min:0,pattern:null},V.version="3.4.0",V}));