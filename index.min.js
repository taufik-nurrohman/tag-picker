/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2021 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).TP=n()}(this,(function(){"use strict";var t=function(t,n){return-1!==n.indexOf(t)},n=function(t){return Array.isArray(t)},e=function(t,n){return t&&i(n)&&t instanceof n},r=function(t){return"number"==typeof t},u=function(t,n){return void 0===n&&(n=!0),"object"==typeof t&&(!n||e(t,Object))},i=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},o=function(t){return"string"==typeof t},f=function(t,n){var e=n.indexOf(t);return-1!==e?e:null},c=function(t){return t.toLowerCase()},s=function(t){return t.length},a=function(t){return Object.keys(t)},l=function t(e){if(n(e))return e.map((function(n){return t(n)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(e))return function(t,n){return void 0===n&&(n=10),n?parseInt(t,n):parseFloat(t)}(e);if(u(e)){for(var r in e)e[r]=t(e[r]);return e}return"false"!==e&&("null"===e?null:"true"===e||e)},g=function e(){for(var r=arguments.length,o=Array(r),f=0;f<r;f++)o[f]=arguments[f];for(var c=o.shift(),a=0,l=s(o);a<l;++a)for(var g in o[a])if(i(c[g]))if(n(c[g])&&n(o[a][g])){c[g]=[].concat(c[g]);for(var d=0,p=s(o[a][g]);d<p;++d)t(o[a][g][d],c[g])||c[g].push(o[a][g][d])}else u(c[g])&&u(o[a][g])?c[g]=e({},c[g],o[a][g]):c[g]=o[a][g];else c[g]=o[a][g];return c},d=function t(e){if(n(e))return e.map((function(n){return t(e)}));if(u(e)){for(var r in e)e[r]=t(e[r]);return e}return!1===e?"false":null===e?"null":!0===e?"true":""+e},p=document,v=window,m=function(t,n,e){if(void 0===e&&(e=!0),!L(t,n))return null;var r=t.getAttribute(n);return e?l(r):r},h=function(t,n){var e=t.children;return r(n)?e[n]||null:e||[]},b=function(t){return t.nextElementSibling||null},y=function(t,n){return n?t.closest(n)||null:t.parentNode||null},k=function(t){var n="form";return T(t,n)&&n===function(t){return c(t&&t.nodeName||"")||null}(t.form)?t.form:y(t,n)},x=function(t){return t.previousElementSibling||null},E=function(t,n){void 0===n&&(n=!0);var e="textContent";if(!T(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},L=function(t,n){return t.hasAttribute(n)},w=function(t,n){return t.classList.contains(n)},A=function(t,n){return null!==y(t,n)},T=function(t,n){return n in t},R=function(t,n){return t.removeAttribute(n),t},P=function(t,n){return t.classList.remove(n),t},C=function(t,e){if(n(e))return e.forEach((function(n){return t.classList.remove(n)})),t;if(u(e)){for(var r in e)e[r]&&t.classList.remove(r);return t}return t.className="",t},N=function(t){var n=y(t);return t.remove(),n},O=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,d(e)),t},S=function(t,n){return t.append(n),n},K=function(t,n){return t.classList.add(n),t},B=function(t,e){if(n(e))return e.forEach((function(n){return t.classList.add(n)})),t;if(u(e))for(var r in e)e[r]?t.classList.add(r):t.classList.remove(r);return t.className=e,t},_=function(t,n,e){return t=o(t)?p.createElement(t):t,u(n)&&(e=n,n=!1),o(n)&&D(t,n),u(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?O(t,r,e):R(t,r)}(t,e),t},D=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="innerHTML";return T(t,r)&&(t[r]=e?n.trim():n),t},H=function(t,n){return y(t).insertBefore(n,t),n},z=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="textContent";return T(t,r)&&(t[r]=e?n.trim():n),t},F=function(t,n){return function(){var e=arguments,r=this;setTimeout((function(){return t.apply(r,e)}),n)}};var I=function(t,n,e){n.removeEventListener(t,e)},M=function(t){return t&&t.preventDefault()},$=function(t,n,e){t.forEach((function(t){return I(t,n,e)}))},q=function(t,n,e,r){void 0===r&&(r=!1),n.addEventListener(t,e,r)},G=function(t,n,e,r){void 0===r&&(r=!1),t.forEach((function(t){return q(t,n,e,r)}))},J=function(t,n){return function(t){return e(t,RegExp)}(t)?t:(t=t.replace(/\//g,"\\/"),RegExp(t,i(n)?n:"g"))};const Q="ArrowLeft",U="Home",V="Backspace",W="Tab";function X(u,l={}){const d=this;if(!u)return d;if(u.TP)return u.TP;if(!e(d,X))return new X(u,l);let L=()=>u.disabled,T=()=>u.readOnly,R=m(u,"placeholder"),O=m(u,"tabindex"),{hooks:D,fire:Y}=function(t){var n={};return t.hooks=n,t.fire=function(e,r){return i(n[e])?(n[e].forEach((function(n){return n.apply(t,r)})),t):t},t.off=function(e,r){if(!i(e))return n={},t;if(i(n[e]))if(i(r)){for(var u=0,o=n[e].length;u<o;++u)if(r===n[e][u]){n[e].splice(u,1);break}0===j&&delete n[e]}else delete n[e];return t},t.on=function(e,r){return i(n[e])||(n[e]=[]),i(r)&&n[e].push(r),t},t}(d);var Z;d.state=l=g({},X.state,o(l)?{join:l}:l||{}),d.source=u,X.instances[u.id||u.name||(Z=X.instances,s(a(Z)))]=d,u.TP=d;let tt,nt,et,rt=l.class,ut=rt+"__",it=rt+"--",ot=k(u),ft=_("div",{class:rt,tabindex:!L()&&-1}),ct=_("span",{class:ut+"tag "+ut+"input"}),st=_("input",{class:ut+"copy",tabindex:-1,type:"text"}),at=_("span",{contenteditable:!L()&&"true",spellcheck:"false",style:"white-space:pre;"}),lt=_("span"),gt=_("span",{class:ut+"tags"}),dt=0,pt={};function vt(t,n){let e=f(t,d.tags);return n&&Y("get.tag",[t,e]),r(e)?t:null}function mt(){pt={};let t,n=h(gt),e=s(n)-1;for(t=0;t<e;++t)w(n[t],ut+"tag--selected")&&(pt[t]=n[t])}function ht(t,n){r(n)?(n=n<0?0:n,d.tags.splice(n,0,t)):d.tags.push(t),u.value=d.tags.join(l.join)}function bt(t,n){let e=_("span",{class:ut+"tag",tabindex:!L()&&!T()&&0,title:t}),u=_("a",{class:ut+"tag-x",href:"",tabindex:-1,target:"_top"});q("click",u,Dt),S(e,u),q("click",e,_t),G(["blur","focus"],e,Ot),A(gt)&&(r(n)&&d.tags[n]?H(h(gt,n),e):H(ct,e))}function yt(n){if(n=n?n.split(l.join):[],A(ft)){let e,r,u;for(;e=x(ct);)xt(u=e.title),t(u,n)||(r=f(u,d.tags),Y("change",[u,r]),Y("let.tag",[u,r]))}d.tags=[],u.value="";for(let t,e=0,r=l.max;e<r&&n[e];++e)""!==(t=Pt(n[e]))&&(bt(t),ht(t),Y("change",[t,e]),Y("set.tag",[t,e]))}function kt(t){let n=f(t,d.tags);r(n)&&n>=0&&(d.tags.splice(n,1),u.value=d.tags.join(l.join))}function xt(t){let n,e=f(t,d.tags);if(r(e)&&e>=0&&(n=h(gt,e))){I("click",n,_t),$(["blur","focus"],n,Ot);let t=n.firstElementChild||null;t&&(I("click",t,Dt),N(t)),N(n)}}function Et(t){N(st),t&&Lt("",1)}function jt(t){S(ft,st),st.value=d.tags.join(l.join),t&&(st.focus(),st.select())}function Lt(t,n){if(z(at,t),z(lt,t?"":R),n){at.focus();let t=p.createRange(),n=v.getSelection();t.selectNodeContents(at),t.collapse(!1),n.removeAllRanges(),n.addRange(t)}}function wt(t){Rt(t,(function(){P(this,ut+"tag--selected")}))}function At(t){Rt(t,(function(){K(this,ut+"tag--selected")}))}function Tt(){if(L()||T())return;let t=Ct(E(at)).trim(),n=l.pattern;if(n&&t&&!J(n,"").test(t))return Y("not.tag",[t,-1]),void Lt(t,1);if(Lt(""),t=Pt(t))if(vt(t))Y("has.tag",[t,f(t,d.tags)]);else{bt(t),ht(t);let n=s(d.tags);Y("change",[t,n]),Y("set.tag",[t,n])}}function Rt(t,n){let e,r=h(gt),u=s(r)-1;for(e=0;e<u;++e)t!==r[e]&&n.call(r[e],e)}function Pt(t){return Ct(d.f(t)).trim()}function Ct(t){return t=t||"",l.escape.forEach((n=>{t=t.split(n).join("")})),t}function Nt(t){"blur"===t.type?(wt(),C(ft,[it+"focus",it+"focus-self"])):B(ft,[it+"focus",it+"focus-self"])}function Ot(t){if(T())return;pt={};let n=this,e=t.type,r=n.title,u=d.tags,i=f(r,u),o=ut+"tag--";"blur"===e?(!tt&&!nt||nt&&et)&&(wt(n),P(n,o+"selected"),C(ft,[it+"focus",it+"focus-tag"])):(K(n,o+"selected"),B(ft,[it+"focus",it+"focus-tag"]),dt=i,pt[i]=n),Y(e+".tag",[r,i])}function St(t){let n=d.tags,e=t.type,r=ut+"text--";P(ft,it+"focus-tag"),"blur"===e?(P(ct,r+"focus"),C(ft,[it+"focus",it+"focus-input"]),Tt()):(K(ct,r+"focus"),B(ft,[it+"focus",it+"focus-input"]),wt(ct)),Y(e,[n,s(n)])}function Kt(t){"blur"===t.type?P(ft,it+"focus"):K(ft,it+"focus")}function Bt(t){t&&ft===t.target&&at.focus();let n=d.tags;Y("click",[n,s(n)])}function _t(){let t=this.title,n=d.tags;Y("click.tag",[t,f(t,n)])}function Dt(t){if(!L()&&!T()){let t=y(this).title,n=f(t,d.tags);xt(t),kt(t),Lt("",1),Y("change",[t,n]),Y("click.tag",[t,n]),Y("let.tag",[t,n])}M(t)}function Ht(t){let n=t.type;"copy"===n?F((()=>Et(1)))():"cut"===n?(!T()&&yt(""),F((()=>Et(1)))()):"paste"===n&&F((()=>{!T()&&yt(st.value),Et(1)}))(),F((()=>{let t=d.tags;Y(n,[t,s(t)])}),1)()}function zt(){wt(),P(ft,it+"focus-self")}function Ft(){at.focus()}function It(t){if(L()||T())return;d.tags;let n,e,r,u,i,o,f=t.key,c=tt=t.ctrlKey,l=nt=t.shiftKey,g=ut+"tag--";if(et=W===f,!c){if(!l&&(V===f||"Delete"===f)){mt(),o=pt;let r=V===f;for(e in o)n=o[e],xt(i=n.title),kt(i);return dt=+(a(o)[0]||0),(n=h(gt,r?dt-1:dt))?ct===n?Lt("",1):n.focus():Lt("",1),void M(t)}if(U===f)return void((n=h(gt,0))&&(n.focus(),M(t)));if("End"===f&&(n=h(gt,s(d.tags)-1)))return n.focus(),void M(t);if(Q===f){if(n=h(gt,dt-1)){let e=w(n,g+"selected");return n.focus(),M(t),l?(r=b(n),void(e&&P(r,g+"selected"))):void wt(n)}if(!l)return void wt(h(gt,0))}if("ArrowRight"===f&&(n=h(gt,dt+1))){let e=w(n,g+"selected");return ct!==n||l?n.focus():Lt("",1),M(t),l?(u=x(n),void(e&&P(u,g+"selected"))):void wt(n)}}"a"===f&&(jt(1),At(),mt(),M(t))}function Mt(n){!function(t){t&&t.stopPropagation()}(n),T()&&W!==n.key&&M(n);let e,r=l.escape,u=x(ct),i=s(d.tags),o=l.max,f=Pt(E(at)),c=n.key,a=tt=n.ctrlKey,g="Enter"===c;nt=n.shiftKey;let p=et=W===c;if(g&&(c="\n"),p&&(c="\t"),F((()=>{let e=Pt(E(at));z(lt,e?"":R),t(function(t){let n,e=v.getSelection();if(e.rangeCount>0)return n=e.getRangeAt(0).cloneRange(),n.collapse(!0),n.setStart(t,0),(n+"").slice(-1)}(at),r)&&(i<o?Tt():(Lt(""),Y("max.tags",[o])),M(n))}))(),""===f&&U===c&&(e=h(gt,0)))return e.focus(),void M(n);if(""===f&&"End"===c&&(e=h(gt,s(d.tags)-1)))return e.focus(),void M(n);if(a&&""===f&&"a"===c)return jt(1),At(),mt(),void M(n);if(t(c,r))return i<o?Tt():(Lt(""),Y("max.tags",[o])),void M(n);if(!p){if(!a&&g)return Gt()&&ot&&ot.dispatchEvent(new Event("submit",{cancelable:!0})),void M(n);if(u&&""===f&&!T()){if(V===c)return e=d.tags[i-1],xt(e),kt(e),Y("change",[e,i-1]),Y("let.tag",[e,i-1]),void M(n);if(Q===c)return void u.focus()}}}function $t(){tt=nt=!1}function qt(){F((()=>{L()||T()||E(at).split(l.join).forEach((n=>{t(n,d.tags)||(bt(n),ht(n))})),Lt("")}))()}function Gt(t){if(L())return;let n=l.min;return Tt(),n>0&&s(d.tags)<n?(Lt("",1),Y("min.tags",[n]),void M(t)):1}var Jt,Qt;return Lt(""),S(ft,gt),S(ct,at),S(ct,lt),S(gt,ct),K(u,ut+"source"),Qt=ft,y(Jt=u).insertBefore(Qt,b(Jt)),_(u,{tabindex:-1}),q("blur",ft,zt),q("click",ft,Bt),q("focus",u,Ft),q("keydown",ft,It),q("keydown",at,Mt),q("keyup",ft,$t),q("paste",at,qt),G(["blur","focus"],ft,Kt),G(["blur","focus"],st,Nt),G(["blur","focus"],at,St),G(["copy","cut","paste"],st,Ht),ot&&q("submit",ot,Gt),d.blur=()=>(!L()&&at.blur(),d),d.click=()=>(ft.click(),Bt(),d),d.f=t=>c(t||"").replace(/[^ a-z\d-]/g,"").trim(),d.focus=()=>(L()||Lt(E(at),1),d),d.get=t=>L()?null:vt(t,1),d.input=at,d.let=t=>{if(!L()&&!T()){let e=l.min;if(t)if(n(t))t.forEach((t=>{if(e>0&&s(d.tags)<e)return Y("min.tags",[e]),d;xt(t),kt(t)}));else{if(e>0&&s(d.tags)<e)return Y("min.tags",[e]),d;xt(t),kt(t)}else yt("")}return d},d.pop=()=>{if(!u.TP)return d;delete u.TP;let t=d.tags;return P(u,ut+"source"),I("blur",ft,zt),I("click",ft,Bt),I("focus",u,Ft),I("keydown",ft,It),I("keydown",at,Mt),I("keyup",ft,$t),I("paste",at,qt),$(["blur","focus"],ft,Kt),$(["blur","focus"],st,Nt),$(["blur","focus"],at,St),$(["copy","cut","paste"],st,Ht),ot&&I("submit",ot,Gt),t.forEach(xt),_(u,{tabindex:O}),N(ft),Y("pop",[t])},d.self=ft,d.set=(t,e)=>{if(!t)return d;if(!L()&&!T())if(n(t))yt(t.join(l.join));else{let n=d.tags,r=l.max;vt(t)?Y("has.tag",[t,f(t,n)]):s(n)<r?(bt(t,e),ht(t,e)):Y("max.tags",[r])}return d},d.source=d.output=u,d.state=l,d.tags=[],yt(u.value),d}return X.instances={},X.state={class:"tag-picker",escape:[","],join:", ",max:9999,min:0,pattern:null},X.version="3.4.8",X}));