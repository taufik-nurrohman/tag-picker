/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2020 Taufik Nurrohman
 *
 * <https://github.com/taufik-nurrohman/tag-picker>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TP=e()}(this,(function(){"use strict";const t=t=>Array.isArray(t),e=(t,e)=>t&&i(e)&&t instanceof e,n=t=>"number"==typeof t,r=(t,n=!0)=>"object"==typeof t&&(!n||e(t,Object)),i=t=>(t=>void 0!==t)(t)&&!(t=>null===t)(t),s=t=>"string"==typeof t,a=e=>{if(t(e))return e.map((t=>a(e)));if(r(e)){for(let t in e)e[t]=a(e[t]);return e}return!1===e?"false":null===e?"null":!0===e?"true":""+e},u=t=>t.toLowerCase(),c=e=>{if(t(e))return e.map((t=>c(t)));if((t=>/^-?(?:\d*.)?\d+$/.test(t+""))(e))return((t,e=10)=>parseInt(t,e))(e);if(r(e)){for(let t in e)e[t]=c(e[t]);return e}return{false:!1,null:null,true:!0}[e]||e},o=document,f=window,l=(t,e,n=!0)=>{if(!b(t,e))return null;let r=t.getAttribute(e);return n?c(r):r},g=(t,e)=>{let r=t.children;return n(e)?r[e]||null:r||[]},p=t=>u(t&&t.nodeName||"")||null,d=t=>t.nextElementSibling||null,v=t=>t.parentNode||null,m=t=>t.previousElementSibling||null,h=(t,e=!0)=>{let n="textContent";if(!y(t,n))return!1;let r=t[n];return r=e?r.trim():r,""!==r?r:null},b=(t,e)=>t.hasAttribute(e),k=t=>null!==v(t),y=(t,e)=>e in t,x=(t,e)=>(t.removeAttribute(e),t),w=(t,e)=>(t.classList.remove(e),t),E=(e,n)=>{if(t(n))return n.forEach((t=>e.classList.remove(t))),e;if(r(n)){for(let t in n)n[t]&&e.classList.remove(t);return e}return e.className="",e},L=t=>{let e=v(t);return t.remove(),e},T=(t,e,n)=>(!0===n&&(n=e),t.setAttribute(e,a(n)),t),A=(t,e)=>(t.append(e),e),B=(t,e)=>(t.classList.add(e),t),C=(t,e,n)=>(t=s(t)?o.createElement(t):t,r(e)&&(n=e,e=!1),s(e)&&O(t,e),r(n)&&((t,e)=>{let n;for(let r in e)n=e[r],n||""===n||0===n?T(t,r,n):x(t,r)})(t,n),t),O=(t,e,n=!0)=>{if(null===e)return t;let r="innerHTML";return y(t,r)&&(t[r]=n?e.trim():e),t},P=(t,e)=>(v(t).insertBefore(e,t),e),K=(t,e,n=!0)=>{if(null===e)return t;let r="textContent";return y(t,r)&&(t[r]=n?e.trim():e),t},N=t=>t&&t.preventDefault(),R=(t,e,n)=>{e.removeEventListener(t,n)},D=(t,e,n,r=!1)=>{e.addEventListener(t,n,r)};function S(t,e){const n=this;return i(z[t])?(z[t].forEach((t=>t.apply(n,e))),n):n}const z={};function H(t,e){const n=this;if(!i(t))return z={},n;if(i(z[t]))if(i(e)){for(let n=0,r=z[t].length;n<r;++n)if(e===z[t][n]){z[t].splice(n,1);break}0===j&&delete z[t]}else delete z[t];return n}function I(t,e){return i(z[t])||(z[t]=[]),i(e)&&z[t].push(e),this}const M=(t,n)=>(t=>e(t,RegExp))(t)?t:(t=t.replace(/\//g,"\\/"),RegExp(t,i(n)?n:"g"));var $=f.setTimeout;function _(t){return t.length}function q(t,e){var n=e.indexOf(t);return n<0?null:n}function F(t,e){return e.indexOf(t)>=0}function G(i,a){if(void 0===a&&(a={}),i){var c=this;if(i.TP)return c;if(!e(c,G))return new G(i,a);var o=function(){return i.disabled},f=function(){return i.readOnly},b=l(i,"placeholder"),x=l(i,"tabindex");c.state=a=Object.assign({},G.state,s(a)?{join:a}:a||{}),c.source=i;var j=S.bind(c),T=H.bind(c),O=I.bind(c);G.instances[i.id||i.name||_(Object.keys(G.instances))]=c,i.TP=1;var J,Q,U=C("span",{class:"editor tag"}),V=C("span",{contenteditable:!o()&&"true",spellcheck:"false",style:"white-space:pre;"}),W=C("span"),X=(t=>{let e="form";if(y(t,e)&&e===p(t.form))return t.form;let n=v(t);for(;n&&e!==p(n);)n=v(n);return n||null})(i),Y=C("span",{class:"tags"}),Z=C("span",{class:a.class});return mt(""),A(Z,Y),A(Y,U),A(U,V),A(U,W),B(i,a.class+"-source"),Q=Z,v(J=i).insertBefore(Q,d(J)),C(i,{tabindex:"-1"}),D("blur",V,nt),D("click",V,rt),D("click",Z,ot),D("focus",V,it),D("focus",i,ft),D("keydown",V,st),D("paste",V,ct),X&&D("submit",X,ut),c.blur=function(){return!o()&&(V.blur(),nt())},c.click=function(){return Z.click()},ot(),c.f=function(t){return u(t||"").replace(/[^ a-z\d-]/g,"")},c.fire=j,c.focus=function(){return o()||(V.focus(),it()),c},c.get=function(t){return o()?null:ht(t,1)},c.hooks=z,c.input=V,c.let=function(t){if(!o()&&!f()){var e=a.min;if(et(),e>0&&_(c.tags)<e)return j("min.tags",[e]),c;xt(t),bt(t)}return c},c.off=T,c.on=O,c.pop=function(){if(!i.TP)return c;delete i.TP;var t=c.tags;return w(i,a.class+"-source"),R("blur",V,nt),R("click",V,rt),R("click",Z,ot),R("focus",V,it),R("focus",i,ft),R("keydown",V,st),R("paste",V,ct),X&&R("submit",X,ut),t.forEach(xt),C(i,{tabindex:x}),L(Z),j("pop",[t])},c.self=c.view=Z,c.set=function(t,e){if(!o()&&!f()){var n=c.tags,r=a.max;ht(t)?j("has.tag",[t,q(t,n)]):_(n)<r?(yt(t,e),kt(t,e)):j("max.tags",[r])}return c},c.source=c.output=i,c.state=a,c.tags=[],at(i.value),c.value=function(t){return!o()&&!f()&&at(t)},c}function tt(t){return c.f(t).replace(M("("+a.escape.join("|").replace(/\\/g,"\\\\")+")+"),"").trim()}function et(){if(o()||f())return mt("");var t,e=tt(h(V)),n=c.tags;e&&(ht(e)?j("has.tag",[e,q(e,n)]):(yt(e),kt(e),t=_(n),j("change",[e,t]),j("set.tag",[e,t])),mt(""))}function nt(){et(),E(Z,["focus","focus.input"]),j("blur",[c.tags,_(c.tags)])}function rt(){j("click",[c.tags])}function it(){B(Z,"focus"),B(Z,"focus.input"),j("focus",[c.tags])}function st(t){var e,n=a.escape,r=t.key,i=t.keyCode,s=t.ctrlKey,u="Enter"===r||13===i,l=t.shiftKey,g="Tab"===r||9===i,p=m(U),d=_(c.tags),v=a.max,k=tt(h(V));u?r="\n":g&&(r="\t"),g||(o()||f()?(u&&f()&&jt(),N(t)):F(r,n)||F(i,n)?(d<v?et():(mt(""),j("max.tags",[v])),N(t)):u?(jt(),N(t)):$((function(){var a=h(V)||"",u=tt(a);F(a.slice(-1),n)?(d<v?et():(mt(""),j("max.tags",[v])),N(t)):""!==u||s||l||(""!==k||"Backspace"!==r&&"Backspace"!==i?"ArrowLeft"!==r&&37!==i||p&&p.focus():(w(Z,"focus.tag"),xt(e=c.tags[d-1]),bt(e),p&&(j("change",[e,d-1]),j("let.tag",[e,d-1])))),K(W,u?"":b)}),0))}function at(t){if(k(Z))for(var e;e=m(U);)xt(e.title);c.tags=[],i.value="",t=t?t.split(a.join):[];for(var n,r=0,s=a.max;r<s&&t[r];++r)if(""!==(n=tt(t[r]))){if(ht(n))continue;yt(n),kt(n),j("change",[n,r]),j("set.tag",[n,r])}}function ut(t){if(!o()){var e=a.min;return et(),e>0&&_(c.tags)<e?(mt("",1),j("min.tags",[e]),void N(t)):1}}function ct(){$((function(){o()||f()||at(h(V)),mt("")}),0)}function ot(t){t&&Z===t.target&&(V.focus(),rt())}function ft(){V.focus()}function lt(){var t=this.title,e=c.tags;E(Z,["focus","focus.tag"]),j("blur.tag",[t,q(t,e)])}function gt(){var t=this.title,e=c.tags;j("click.tag",[t,q(t,e)])}function pt(){var e=this.title,n=c.tags;((e,n)=>{if(t(n))return n.forEach((t=>e.classList.add(t))),e;if(r(n))for(let t in n)n[t]?e.classList.add(t):e.classList.remove(t);e.className=n})(Z,["focus","focus.tag"]),j("focus.tag",[e,q(e,n)])}function dt(t){if(!o()&&!f()){var e=v(this).title,n=q(e,c.tags);xt(e),bt(e),mt("",1),j("change",[e,n]),j("click.tag",[e,n]),j("let.tag",[e,n])}N(t)}function vt(t){var e=t.key,n=t.keyCode,r=t.ctrlKey,i=t.shiftKey,s=this,a=d(s),u=m(s);if(!r&&!i)if(f()||"ArrowLeft"!==e&&37!==n)if(f()||"ArrowRight"!==e&&39!==n){if("Backspace"===e||8===n||"Delete"===e||46===n){if(!f()){var o=s.title,l=q(o,c.tags);w(Z,"focus.tag"),xt(o),bt(o),"Backspace"===e||8===n?u?u.focus():mt("",1):a&&a!==U?a.focus():mt("",1),j("change",[o,l]),j("let.tag",[o,l])}N(t)}}else a&&a!==U?a.focus():mt("",1),N(t);else u&&(u.focus(),N(t))}function mt(t,e){K(V,t),K(W,t?"":b),e&&V.focus()}function ht(t,e){var r=q(t,c.tags);return e&&j("get.tag",[t,r]),n(r)?t:null}function bt(t){var e=c.tags,r=q(t,e);return!!(n(r)&&r>=0)&&(i.value=e.join(a.join),c.tags.splice(r,1),!0)}function kt(t,e){n(e)?(e=e<0?0:e,c.tags.splice(e,0,t)):c.tags.push(t),i.value=c.tags.join(a.join)}function yt(t,e){var r=C("span",{class:"tag",tabindex:!o()&&"0",title:t});if(a.x){var i=C("a",{href:"",tabindex:"-1",target:"_top"});D("click",i,dt),A(r,i)}D("blur",r,lt),D("click",r,gt),D("focus",r,pt),D("keydown",r,vt),k(Y)&&(n(e)&&c.tags[e]?P(g(Y,e),r):P(U,r))}function xt(t){var e,r=q(t,c.tags);if(n(r)&&r>=0&&(e=g(Y,r))){if(R("blur",e,lt),R("click",e,gt),R("focus",e,pt),R("keydown",e,vt),a.x){var i=e.firstElementChild||null;i&&(R("click",i,dt),L(i))}L(e)}}function jt(){ut()&&X&&X.submit()}}return G.instances={},G.state={class:"tag-picker",escape:[",",188],join:", ",max:9999,min:0,x:!1},G.version="3.1.0",G}));