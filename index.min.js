/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2020 Taufik Nurrohman
 *
 * <https://github.com/taufik-nurrohman/tag-picker>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(n="undefined"!=typeof globalThis?globalThis:n||self).TP=t()}(this,(function(){"use strict";var n=function(n){return Array.isArray(n)},t=function(n,t){return n&&i(t)&&n instanceof t},e=function(n){return"number"==typeof n},r=function(n,e){return void 0===e&&(e=!0),"object"==typeof n&&(!e||t(n,Object))},i=function(n){return function(n){return void 0!==n}(n)&&!function(n){return null===n}(n)},u=function(n){return"string"==typeof n},o=function t(e){if(n(e))return e.map((function(n){return t(e)}));if(r(e)){for(var i in e)e[i]=t(e[i]);return e}return!1===e?"false":null===e?"null":!0===e?"true":""+e},c=function(n){return n.toLowerCase()},a=function t(e){if(n(e))return e.map((function(n){return t(n)}));if(function(n){return/^-?(?:\d*.)?\d+$/.test(n+"")}(e))return function(n,t){return void 0===t&&(t=10),parseInt(n,t)}(e);if(r(e)){for(var i in e)e[i]=t(e[i]);return e}return{false:!1,null:null,true:!0}[e]||e},f=document,s=window,l=function(n,t,e){if(void 0===e&&(e=!0),!b(n,t))return null;var r=n.getAttribute(t);return e?a(r):r},g=function(n,t){var r=n.children;return e(t)?r[t]||null:r||[]},v=function(n){return c(n&&n.nodeName||"")||null},d=function(n){return n.nextElementSibling||null},p=function(n){return n.parentNode||null},m=function(n){return n.previousElementSibling||null},h=function(n,t){void 0===t&&(t=!0);var e="textContent";if(!y(n,e))return!1;var r=n[e];return""!==(r=t?r.trim():r)?r:null},b=function(n,t){return n.hasAttribute(t)},k=function(n){return null!==p(n)},y=function(n,t){return t in n},x=function(n,t){return n.removeAttribute(t),n},w=function(n,t){return n.classList.remove(t),n},E=function(t,e){if(n(e))return e.forEach((function(n){return t.classList.remove(n)})),t;if(r(e)){for(var i in e)e[i]&&t.classList.remove(i);return t}return t.className="",t},L=function(n){var t=p(n);return n.remove(),t},T=function(n,t,e){return!0===e&&(e=t),n.setAttribute(t,o(e)),n},A=function(n,t){return n.append(t),t},B=function(n,t){return n.classList.add(t),n},C=function(n,t,e){return n=u(n)?f.createElement(n):n,r(t)&&(e=t,t=!1),u(t)&&O(n,t),r(e)&&function(n,t){var e;for(var r in t)(e=t[r])||""===e||0===e?T(n,r,e):x(n,r)}(n,e),n},O=function(n,t,e){if(void 0===e&&(e=!0),null===t)return n;var r="innerHTML";return y(n,r)&&(n[r]=e?t.trim():t),n},P=function(n,t){return p(n).insertBefore(t,n),t},K=function(n,t,e){if(void 0===e&&(e=!0),null===t)return n;var r="textContent";return y(n,r)&&(n[r]=e?t.trim():t),n},N=function(n){return n&&n.preventDefault()},R=function(n,t,e){t.removeEventListener(n,e)},D=function(n,t,e,r){void 0===r&&(r=!1),t.addEventListener(n,e,r)};function S(n,t){var e=this;return i(z[n])?(z[n].forEach((function(n){return n.apply(e,t)})),e):e}var z={};function H(n,t){if(!i(n))return function(n){throw new TypeError('"'+n+'" is read-only')}("hooks"),z={},this;if(i(z[n]))if(i(t)){for(var e=0,r=z[n].length;e<r;++e)if(t===z[n][e]){z[n].splice(e,1);break}0===j&&delete z[n]}else delete z[n];return this}function I(n,t){return i(z[n])||(z[n]=[]),i(t)&&z[n].push(t),this}var M=function(n,e){return function(n){return t(n,RegExp)}(n)?n:(n=n.replace(/\//g,"\\/"),RegExp(n,i(e)?e:"g"))},$=s.setTimeout;function _(n){return n.length}function q(n,t){var e=t.indexOf(n);return e<0?null:e}function F(n,t){return t.indexOf(n)>=0}function G(i,o){if(void 0===o&&(o={}),i){var a=this;if(i.TP)return a;if(!t(a,G))return new G(i,o);var f=function(){return i.disabled},s=function(){return i.readOnly},b=l(i,"placeholder"),x=l(i,"tabindex");a.state=o=Object.assign({},G.state,u(o)?{join:o}:o||{}),a.source=i;var j=S.bind(a),T=H.bind(a),O=I.bind(a);G.instances[i.id||i.name||_(Object.keys(G.instances))]=a,i.TP=1;var J,Q,U=C("span",{class:"editor tag"}),V=C("span",{contenteditable:!f()&&"true",spellcheck:"false",style:"white-space:pre;"}),W=C("span"),X=function(n){var t="form";if(y(n,t)&&t===v(n.form))return n.form;for(var e=p(n);e&&t!==v(e);)e=p(e);return e||null}(i),Y=C("span",{class:"tags"}),Z=C("span",{class:o.class});return hn(""),A(Z,Y),A(Y,U),A(U,V),A(U,W),B(i,o.class+"-source"),Q=Z,p(J=i).insertBefore(Q,d(J)),C(i,{tabindex:"-1"}),D("blur",V,en),D("click",V,rn),D("click",Z,sn),D("focus",V,un),D("focus",i,ln),D("keydown",V,on),D("paste",V,fn),X&&D("submit",X,an),a.blur=function(){return!f()&&(V.blur(),en())},a.click=function(){return Z.click()},sn(),a.f=function(n){return c(n||"").replace(/[^ a-z\d-]/g,"")},a.fire=j,a.focus=function(){return f()||(V.focus(),un()),a},a.get=function(n){return f()?null:bn(n,1)},a.hooks=z,a.input=V,a.let=function(n){if(!f()&&!s()){var t=o.min;if(tn(),t>0&&_(a.tags)<t)return j("min.tags",[t]),a;wn(n),kn(n)}return a},a.off=T,a.on=O,a.pop=function(){if(!i.TP)return a;delete i.TP;var n=a.tags;return w(i,o.class+"-source"),R("blur",V,en),R("click",V,rn),R("click",Z,sn),R("focus",V,un),R("focus",i,ln),R("keydown",V,on),R("paste",V,fn),X&&R("submit",X,an),n.forEach(wn),C(i,{tabindex:x}),L(Z),j("pop",[n])},a.self=a.view=Z,a.set=function(n,t){if(!f()&&!s()){var e=a.tags,r=o.max;bn(n)?j("has.tag",[n,q(n,e)]):_(e)<r?(xn(n,t),yn(n,t)):j("max.tags",[r])}return a},a.source=a.output=i,a.state=o,a.tags=[],cn(i.value),a.value=function(n){return!f()&&!s()&&cn(n)},a}function nn(n){return a.f(n).replace(M("("+o.escape.join("|").replace(/\\/g,"\\\\")+")+"),"").trim()}function tn(){if(f()||s())return hn("");var n,t=nn(h(V)),e=a.tags;t&&(bn(t)?j("has.tag",[t,q(t,e)]):(xn(t),yn(t),n=_(e),j("change",[t,n]),j("set.tag",[t,n])),hn(""))}function en(){tn(),E(Z,["focus","focus.input"]),j("blur",[a.tags,_(a.tags)])}function rn(){j("click",[a.tags])}function un(){B(Z,"focus"),B(Z,"focus.input"),j("focus",[a.tags])}function on(n){var t,e=o.escape,r=n.key,i=n.keyCode,u=n.ctrlKey,c="Enter"===r||13===i,l=n.shiftKey,g="Tab"===r||9===i,v=m(U),d=_(a.tags),p=o.max,k=nn(h(V));c?r="\n":g&&(r="\t"),g||(f()||s()?(c&&s()&&jn(),N(n)):F(r,e)||F(i,e)?(d<p?tn():(hn(""),j("max.tags",[p])),N(n)):c?(jn(),N(n)):$((function(){var o=h(V)||"",c=nn(o);F(o.slice(-1),e)?(d<p?tn():(hn(""),j("max.tags",[p])),N(n)):""!==c||u||l||(""!==k||"Backspace"!==r&&"Backspace"!==i?"ArrowLeft"!==r&&37!==i||v&&v.focus():(w(Z,"focus.tag"),wn(t=a.tags[d-1]),kn(t),v&&(j("change",[t,d-1]),j("let.tag",[t,d-1])))),K(W,c?"":b)}),0))}function cn(n){if(k(Z))for(var t;t=m(U);)wn(t.title);a.tags=[],i.value="",n=n?n.split(o.join):[];for(var e,r=0,u=o.max;r<u&&n[r];++r)if(""!==(e=nn(n[r]))){if(bn(e))continue;xn(e),yn(e),j("change",[e,r]),j("set.tag",[e,r])}}function an(n){if(!f()){var t=o.min;return tn(),t>0&&_(a.tags)<t?(hn("",1),j("min.tags",[t]),void N(n)):1}}function fn(){$((function(){f()||s()||cn(h(V)),hn("")}),0)}function sn(n){n&&Z===n.target&&(V.focus(),rn())}function ln(){V.focus()}function gn(){var n=this.title,t=a.tags;E(Z,["focus","focus.tag"]),j("blur.tag",[n,q(n,t)])}function vn(){var n=this.title,t=a.tags;j("click.tag",[n,q(n,t)])}function dn(){var t=this.title,e=a.tags;!function(t,e){if(n(e))return e.forEach((function(n){return t.classList.add(n)})),t;if(r(e))for(var i in e)e[i]?t.classList.add(i):t.classList.remove(i);t.className=e}(Z,["focus","focus.tag"]),j("focus.tag",[t,q(t,e)])}function pn(n){if(!f()&&!s()){var t=p(this).title,e=q(t,a.tags);wn(t),kn(t),hn("",1),j("change",[t,e]),j("click.tag",[t,e]),j("let.tag",[t,e])}N(n)}function mn(n){var t=n.key,e=n.keyCode,r=n.ctrlKey,i=n.shiftKey,u=this,o=d(u),c=m(u);if(!r&&!i)if(s()||"ArrowLeft"!==t&&37!==e)if(s()||"ArrowRight"!==t&&39!==e){if("Backspace"===t||8===e||"Delete"===t||46===e){if(!s()){var f=u.title,l=q(f,a.tags);w(Z,"focus.tag"),wn(f),kn(f),"Backspace"===t||8===e?c?c.focus():hn("",1):o&&o!==U?o.focus():hn("",1),j("change",[f,l]),j("let.tag",[f,l])}N(n)}}else o&&o!==U?o.focus():hn("",1),N(n);else c&&(c.focus(),N(n))}function hn(n,t){K(V,n),K(W,n?"":b),t&&V.focus()}function bn(n,t){var r=q(n,a.tags);return t&&j("get.tag",[n,r]),e(r)?n:null}function kn(n){var t=a.tags,r=q(n,t);return!!(e(r)&&r>=0)&&(i.value=t.join(o.join),a.tags.splice(r,1),!0)}function yn(n,t){e(t)?(t=t<0?0:t,a.tags.splice(t,0,n)):a.tags.push(n),i.value=a.tags.join(o.join)}function xn(n,t){var r=C("span",{class:"tag",tabindex:!f()&&"0",title:n});if(o.x){var i=C("a",{href:"",tabindex:"-1",target:"_top"});D("click",i,pn),A(r,i)}D("blur",r,gn),D("click",r,vn),D("focus",r,dn),D("keydown",r,mn),k(Y)&&(e(t)&&a.tags[t]?P(g(Y,t),r):P(U,r))}function wn(n){var t,r=q(n,a.tags);if(e(r)&&r>=0&&(t=g(Y,r))){if(R("blur",t,gn),R("click",t,vn),R("focus",t,dn),R("keydown",t,mn),o.x){var i=t.firstElementChild||null;i&&(R("click",i,pn),L(i))}L(t)}}function jn(){an()&&X&&X.submit()}}return G.instances={},G.state={class:"tag-picker",escape:[",",188],join:", ",max:9999,min:0,x:!1},G.version="3.1.2",G}));