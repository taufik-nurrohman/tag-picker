/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2021 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).TP=n()}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},n=function(t,n){return t&&u(n)&&t instanceof n},e=function(t){return"number"==typeof t},r=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||n(t,Object))},u=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},i=function(t){return"string"==typeof t},c=function n(e){if(t(e))return e.map((function(t){return n(e)}));if(r(e)){for(var u in e)e[u]=n(e[u]);return e}return!1===e?"false":null===e?"null":!0===e?"true":""+e},o=function(t,n){var e=n.indexOf(t);return-1!==e?e:null},f=function(t){return t.toLowerCase()},a=function(t){return t.length},s=function(t){return Object.keys(t)},l=function n(e){if(t(e))return e.map((function(t){return n(t)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(e))return function(t,n){return void 0===n&&(n=10),n?parseInt(t,n):parseFloat(t)}(e);if(r(e)){for(var u in e)e[u]=n(e[u]);return e}return"false"!==e&&("null"===e?null:"true"===e||e)},g=document,p=window,d=function(t,n,e){if(void 0===e&&(e=!0),!x(t,n))return null;var r=t.getAttribute(n);return e?l(r):r},v=function(t,n){var r=t.children;return e(n)?r[n]||null:r||[]},m=function(t){return f(t&&t.nodeName||"")||null},h=function(t){return t.nextElementSibling||null},b=function(t){return t.parentNode||null},k=function(t){return t.previousElementSibling||null},y=function(t,n){void 0===n&&(n=!0);var e="textContent";if(!w(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},x=function(t,n){return t.hasAttribute(n)},E=function(t){return null!==b(t)},w=function(t,n){return n in t},L=function(t,n){return t.removeAttribute(n),t},A=function(t,n){return t.classList.remove(n),t},T=function(n,e){if(t(e))return e.forEach((function(t){return n.classList.remove(t)})),n;if(r(e)){for(var u in e)e[u]&&n.classList.remove(u);return n}return n.className="",n},O=function(t){var n=b(t);return t.remove(),n},B=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,c(e)),t},C=function(t,n){return t.append(n),n},P=function(t,n){return t.classList.add(n),t},K=function(t,n,e){return t=i(t)?g.createElement(t):t,r(n)&&(e=n,n=!1),i(n)&&N(t,n),r(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?B(t,r,e):L(t,r)}(t,e),t},N=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="innerHTML";return w(t,r)&&(t[r]=e?n.trim():n),t},R=function(t,n){return b(t).insertBefore(n,t),n},D=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="textContent";return w(t,r)&&(t[r]=e?n.trim():n),t},S=function(t,n,e){n.removeEventListener(t,e)},z=function(t){return t&&t.preventDefault()},F=function(t,n,e,r){void 0===r&&(r=!1),n.addEventListener(t,e,r)},H=function(t,n){return-1!==n.indexOf(t)};var I=function(t,e){return function(t){return n(t,RegExp)}(t)?t:(t=t.replace(/\//g,"\\/"),RegExp(t,u(e)?e:"g"))};let M=p.setTimeout;function $(c,l={}){if(!c)return;const g=this;if(c.TP)return;if(!n(g,$))return new $(c,l);let p=()=>c.disabled,x=()=>c.readOnly,L=d(c,"placeholder"),B=d(c,"tabindex"),{fire:N}=function(t){var n={};return t.hooks=n,t.fire=function(e,r){return u(n[e])?(n[e].forEach((function(n){return n.apply(t,r)})),t):t},t.off=function(e,r){if(!u(e))return n={},t;if(u(n[e]))if(u(r)){for(var i=0,c=n[e].length;i<c;++i)if(r===n[e][i]){n[e].splice(i,1);break}0===j&&delete n[e]}else delete n[e];return t},t.on=function(e,r){return u(n[e])||(n[e]=[]),u(r)&&n[e].push(r),t},t}(g);var _;g.state=l=function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];return Object.assign.apply(Object,[{}].concat(n))}($.state,i(l)?{join:l}:l||{}),g.source=c,$.instances[c.id||c.name||(_=$.instances,a(s(_)))]=g,c.TP=1;let q=K("span",{class:"editor tag"}),G=K("span",{contenteditable:!p()&&"true",spellcheck:"false",style:"white-space:pre;"}),J=K("span"),Q=function(t){var n="form";if(w(t,n)&&n===m(t.form))return t.form;for(var e=b(t);e&&n!==m(e);)e=b(e);return e||null}(c),U=K("span",{class:l.class}),V=K("span",{class:"tags"});function W(t){return g.f(t).replace(I("("+l.escape.join("|").replace(/\\/g,"\\\\")+")+"),"").trim()}function X(){if(p()||x())return gt("");let t,n=W(y(G));n&&(pt(n)?N("has.tag",[n,o(n,g.tags)]):(mt(n),vt(n),t=a(g.tags),N("change",[n,t]),N("set.tag",[n,t])),gt(""))}function Y(){X(),T(U,["focus","focus.input"]),N("blur",[g.tags,a(g.tags)])}function Z(){N("click",[g.tags])}function tt(){P(U,"focus"),P(U,"focus.input"),N("focus",[g.tags])}function nt(t){let n,e=l.escape,r=t.key,u=t.keyCode,i=t.ctrlKey,c="Enter"===r||13===u,o=t.shiftKey,f="Tab"===r||9===u,s=k(q),d=a(g.tags),v=l.max,m=W(y(G));c?r="\n":f&&(r="\t"),f||(p()||x()?(c&&x()&&bt(),z(t)):H(r,e)||H(u,e)?(d<v?X():(gt(""),N("max.tags",[v])),z(t)):c?(bt(),z(t)):M((()=>{let c=y(G)||"",f=W(c);H(c.slice(-1),e)?(d<v?X():(gt(""),N("max.tags",[v])),z(t)):""!==f||i||o||(""!==m||"Backspace"!==r&&"Backspace"!==u?"ArrowLeft"!==r&&37!==u||s&&s.focus():(A(U,"focus.tag"),n=g.tags[d-1],ht(n),dt(n),s&&(N("change",[n,d-1]),N("let.tag",[n,d-1])))),D(J,f?"":L)}),0))}function et(t){if(E(U)){let t;for(;t=k(q);)ht(t.title)}g.tags=[],c.value="",t=t?t.split(l.join):[];for(let n,e=0,r=l.max;e<r&&t[e];++e)if(""!==(n=W(t[e]))){if(pt(n))continue;mt(n),vt(n),N("change",[n,e]),N("set.tag",[n,e])}}function rt(t){if(p())return;let n=l.min;return X(),n>0&&a(g.tags)<n?(gt("",1),N("min.tags",[n]),void z(t)):1}function ut(){M((()=>{p()||x()||et(y(G)),gt("")}),0)}function it(t){t&&U===t.target&&(G.focus(),Z())}function ct(){G.focus()}function ot(){let t=this.title;T(U,["focus","focus.tag"]),N("blur.tag",[t,o(t,g.tags)])}function ft(){let t=this.title;N("click.tag",[t,o(t,g.tags)])}function at(){let n=this.title;!function(n,e){if(t(e))return e.forEach((function(t){return n.classList.add(t)})),n;if(r(e))for(var u in e)e[u]?n.classList.add(u):n.classList.remove(u);n.className=e}(U,["focus","focus.tag"]),N("focus.tag",[n,o(n,g.tags)])}function st(t){if(!p()&&!x()){let t=b(this).title,n=o(t,g.tags);ht(t),dt(t),gt("",1),N("change",[t,n]),N("click.tag",[t,n]),N("let.tag",[t,n])}z(t)}function lt(t){let n=t.key,e=t.keyCode,r=t.ctrlKey,u=t.shiftKey,i=this,c=h(i),f=k(i);if(!r&&!u)if(x()||"ArrowLeft"!==n&&37!==e)if(x()||"ArrowRight"!==n&&39!==e){if("Backspace"===n||8===e||"Delete"===n||46===e){if(!x()){let t=i.title,r=o(t,g.tags);A(U,"focus.tag"),ht(t),dt(t),"Backspace"===n||8===e?f?f.focus():gt("",1):c&&c!==q?c.focus():gt("",1),N("change",[t,r]),N("let.tag",[t,r])}z(t)}}else c&&c!==q?c.focus():gt("",1),z(t);else f&&(f.focus(),z(t))}function gt(t,n){D(G,t),D(J,t?"":L),n&&G.focus()}function pt(t,n){let r=o(t,g.tags);return n&&N("get.tag",[t,r]),e(r)?t:null}function dt(t){let n=o(t,g.tags);return!!(e(n)&&n>=0)&&(g.tags.splice(n,1),c.value=g.tags.join(l.join),!0)}function vt(t,n){e(n)?(n=n<0?0:n,g.tags.splice(n,0,t)):g.tags.push(t),c.value=g.tags.join(l.join)}function mt(t,n){let r=K("span",{class:"tag",tabindex:!p()&&"0",title:t});if(l.x){let t=K("a",{href:"",tabindex:"-1",target:"_top"});F("click",t,st),C(r,t)}F("blur",r,ot),F("click",r,ft),F("focus",r,at),F("keydown",r,lt),E(V)&&(e(n)&&g.tags[n]?R(v(V,n),r):R(q,r))}function ht(t){let n,r=o(t,g.tags);if(e(r)&&r>=0&&(n=v(V,r))){if(S("blur",n,ot),S("click",n,ft),S("focus",n,at),S("keydown",n,lt),l.x){let t=n.firstElementChild||null;t&&(S("click",t,st),O(t))}O(n)}}function bt(){rt()&&Q&&Q.dispatchEvent(new Event("submit",{cancelable:!0}))}var kt,yt;return gt(""),C(U,V),C(V,q),C(q,G),C(q,J),P(c,l.class+"-source"),yt=U,b(kt=c).insertBefore(yt,h(kt)),K(c,{tabindex:"-1"}),F("blur",G,Y),F("click",G,Z),F("click",U,it),F("focus",G,tt),F("focus",c,ct),F("keydown",G,nt),F("paste",G,ut),Q&&F("submit",Q,rt),g.blur=()=>(!p()&&(G.blur(),Y()),g),g.click=()=>(U.click(),it(),g),g.f=t=>f(t||"").replace(/[^ a-z\d-]/g,""),g.focus=()=>(p()||(G.focus(),tt()),g),g.get=t=>p()?null:pt(t,1),g.input=G,g.let=t=>{if(!p()&&!x()){let n=l.min;if(X(),n>0&&a(g.tags)<n)return N("min.tags",[n]),g;ht(t),dt(t)}return g},g.pop=()=>{if(!c.TP)return g;delete c.TP;let t=g.tags;return A(c,l.class+"-source"),S("blur",G,Y),S("click",G,Z),S("click",U,it),S("focus",G,tt),S("focus",c,ct),S("keydown",G,nt),S("paste",G,ut),Q&&S("submit",Q,rt),t.forEach(ht),K(c,{tabindex:B}),O(U),N("pop",[t])},g.self=U,g.set=(t,n)=>{if(!p()&&!x()){let e=g.tags,r=l.max;pt(t)?N("has.tag",[t,o(t,e)]):a(e)<r?(mt(t,n),vt(t,n)):N("max.tags",[r])}return g},g.source=g.output=c,g.state=l,g.tags=[],et(c.value),g.value=t=>(!p()&&!x()&&et(t),g),g}return $.instances={},$.state={class:"tag-picker",escape:[",",188],join:", ",max:9999,min:0,x:!1},$.version="3.1.18",$}));