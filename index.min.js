/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=e()}(this,(function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}var e=function(t,e){return-1!==e.indexOf(t)},n=function(t){return Array.isArray(t)},r=function(t){return void 0!==t},i=function(t){return"function"==typeof t},a=function(t,e){return t&&s(e)&&t instanceof e},u=function(t){return"number"==typeof t},o=function(e){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return"object"===t(e)&&(!n||a(e,Object))},s=function(t){return r(t)&&!function(t){return null===t}(t)},f=function(t){return"string"==typeof t},c=function(t){return t.length},l=function(t){return c(p(t))},p=function(t){return Object.keys(t)},v=function(t){return Object.values(t)},h=function(){for(var t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=r.shift(),u=0,f=c(r);u<f;++u)for(var l in r[u])if(s(a[l]))if(n(a[l])&&n(r[u][l])){a[l]=[].concat(a[l]);for(var p=0,v=c(r[u][l]);p<v;++p)e(r[u][l][p],a[l])||a[l].push(r[u][l][p])}else o(a[l])&&o(r[u][l])?a[l]=h({},a[l],r[u][l]):a[l]=r[u][l];else a[l]=r[u][l];return a},g=function(t){if(n(t))return t.map((function(e){return g(t)}));if(o(t)){for(var e in t)t[e]=g(t[e]);return t}return!1===t?"false":null===t?"null":!0===t?"true":""+t},_=document,d=window,m=function(t){return t.firstElementChild||null},b=function(t,e){var n=t.children;return u(e)?n[e]||null:n||[]},k=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},y=function(t,e){return e?t.closest(e)||null:t.parentNode||null},x=function(t){var e="form";return S(t,e)&&e===function(t){return(t&&t.nodeName||"").toLowerCase()||null}(t[e])?t[e]:y(t,e)},j=function(t,e){return t.previousElementSibling||null},w=function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n="textContent";if(!S(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},E=function(t,e){return t.classList.contains(e)},S=function(t,e){return e in t},D=function(t,e){return t.removeAttribute(e),t},A=function(t,e){return t.classList.remove(e),t},T=function(t){var e=y(t);return t.remove(),e},C=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,g(n)),t},R=function(t,e){return t.append(e),e},L=function(t,e){return t.classList.add(e),t},O=function(t,e,n){return t=f(t)?_.createElement(t):t,o(e)&&(n=e,e=!1),f(e)&&q(t,e),o(n)&&function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?C(t,r,n):D(t,r)}(t,n),t},q=function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null===e)return t;var r="innerHTML";return S(t,r)&&(t[r]=n?e.trim():e),t},N=function(t,e){return y(t).insertBefore(e,t),e},K=function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null===e)return t;var r="textContent";return S(t,r)&&(t[r]=n?e.trim():e),t},P=function(t,e,n){return t.classList.toggle(e,n),t},B=function(t,e){return function(){var n=arguments,r=this;setTimeout((function(){return t.apply(r,n)}),e)}};var H=function(t,e,n){e.removeEventListener(t,n)},I=function(t){return t&&t.preventDefault()},M=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.addEventListener(t,n,r)},W=function(t,e){return function(t){return a(t,RegExp)}(t)?t:RegExp(t,s(e)?e:"g")},z="ArrowLeft",F="ArrowRight",G="Home",J="Backspace",Q="End",U="Enter",V=new WeakMap;function X(t,e,n){Object.defineProperty(t,e,n)}function Y(t){t.focus()}function Z(t){var e,n=d.getSelection();if(n.rangeCount)return(e=n.getRangeAt(0).cloneRange()).collapse(!0),e.setStart(t,0),(e+"").slice(-1)}function $(t){return V.get(t)}function tt(t){return(t.value||"").replace(/\r/g,"")}function et(t){return t.disabled}function nt(t){var e=_.getSelection();e.rangeCount&&e.removeRange(e.getRangeAt(0))}function rt(t,e){var n=_.getSelection();nt();var r=_.createRange();r.selectNodeContents(t),n.addRange(r),1===e?n.collapseToEnd():-1===e&&n.collapseToStart()}function it(t,e){return V.set(t,e)}function at(t,e){var n=this;if(!t)return n;if(!a(n,at))return new at(t,e);it(t,function(t,e){return(e=e||t).fire=function(t,e,n){var r=this,i=r.hooks;return s(i[t])?(i[t].forEach((function(t){return t.apply(n||r,e)})),r):r},e.off=function(t,e){var n=this,r=n.hooks;if(!s(t))return r={},n;if(s(r[t]))if(s(e)){var i=r[t].length;if(0===i)delete r[t];else for(var a=0;a<i;++a)if(e===r[t][a]){r[t].splice(a,1);break}}else delete r[t];return n},e.on=function(t,e){var n=this.hooks;return s(n[t])||(n[t]=[]),s(e)&&n[t].push(e),this},t.hooks={},t}(n,at.prototype));var r=h({},at.state,f(e)?{join:e}:e||{});return o(e)&&e.escape&&(r.escape=e.escape),n.attach(t,r)}at.from=function(t,e){return new at(t,e)},at.of=$,at.state={escape:[","],join:", ",max:1/0,min:0,n:"tag-picker",pattern:null,with:[]},at.version="4.1.0",X(at,"name",{value:"TagPicker"});var ut=at.prototype;X(ut,"text",{get:function(){return w(this._mask.input)},set:function(t){var e=this._mask,n=this.self,r=e.hint,i=e.input;K(r,""===(t+="")?n.placeholder:""),K(i,t),rt(i)}}),X(ut,"value",{get:function(){var t=tt(this.self);return""===t?null:t},set:function(t){var e=this;e._tags;var n=e.state;e.value&&e.value.split(n.join).forEach((function(t){return e.let(t,1)})),t.split(n.join).forEach((function(t){return e.set(t,-1,1)})),e.fire("change")}}),ut._filter=function(t){var e=this.state;return(t||"").replace(/[^ -~]/g," ").split(e.join).join("").replace(/\s+/g," ").trim()};var ot=!1,st=!1;function ft(){nt();var t=$(this);t._mask;var e=t._tags,n=t.mask,r=t.state.n;if(!ot&&!st)for(var i in e)A(e[i],r+"__tag--selected");A(n,r+="--focus"),A(n,r+="-tag")}function ct(t){nt();var e=$(this),n=e._mask,r=e.mask,i=e.state,a=n.text,u=i.n;A(a,u+"__text--focus"),A(r,u+="--focus"),A(r,u+="-text"),e.fire("blur",[t])}function lt(t){var e=$(this),n=t.target,r=e.state.n+"__tag";E(n,r)||y(n,"."+r)||e.focus()}function pt(t){var e=this,n=$(e);n._tags;var r=n.state.n+"__tag--selected";L(e,r),Y(e),rt(m(e))}function vt(t){var e=$(this),n=e._tags,r=e.state,i=r.n+"__tag--selected",a=[];for(var u in n)E(n[u],i)&&a.push(u);t.clipboardData.setData("text/plain",a.join(r.join)),e.fire("copy",[t,a]).focus(),I(t)}function ht(t){var e=$(this),n=e._mask,r=e._tags,i=e.state;n.input;var a=i.n+"__tag--selected",u=[];for(var o in r)E(r[o],a)&&(u.push(o),e.let(o,1));t.clipboardData.setData("text/plain",u.join(i.join)),e.fire("cut",[t,u]).fire("change",[this.title]).focus(),I(t)}function gt(t){var e=$(this),n=e._mask,r=e._tags,i=e.mask,a=e.self,u=e.state,o=n.hint,s=n.input,f=n.text,c=u.n;for(var l in r)A(r[l],c+"__tag--selected");L(f,c+"__text--focus"),L(i,c+="--focus"),L(i,c+="-text"),B((function(){return K(o,w(s,!1)?"":a.placeholder)}),1)(),e.focus().fire("focus",[t])}function _t(){$(this).focus()}function dt(t){$(this).fire("min.tags").focus(),I(t)}function mt(t){var e=$(this);e._mask;var n=e.mask,r=e.state.n;L(n,r+="--focus"),L(n,r+="-tag"),e.fire("focus.tag",[t])}function bt(t){var e,n=this,r=t.key,i=ot=t.ctrlKey,a=st=t.shiftKey,u=$(n),o=u._mask,s=u._tags;u.mask;var f,l,p,h=u.state,g=o.text,_=j(n),d=k(n),b=h.n+"__tag--selected";if(a)L(n,b),rt(m(n)),z===r?(_&&(E(_,b)?A(n,b):L(_,b),Y(_),rt(m(_))),e=!0):F===r&&(d&&g!==d&&(E(d,b)?A(n,b):L(d,b),Y(d),rt(m(d))),e=!0);else if(i)if("a"===r){for(var y in s)Y(s[y]),rt(m(s[y])),L(s[y],b);e=!0}else z===r?(_&&Y(_),e=!0):F===r?(d&&g!==d?Y(d):u.focus(),e=!0):U!==r&&" "!==r||(P(n,b),E(n,b)?(Y(n),rt(m(n))):rt(m(v(s).pop())),e=!0);else{var x=[];for(var w in s)E(s[w],b)&&x.push(w),n!==s[w]&&A(s[w],b);if(G===r)(f=v(s).shift())&&Y(f),e=!0;else if(Q===r)(l=v(s).pop())&&Y(l),e=!0;else if(U===r||" "===r)P(n,b),E(n,b)?(Y(n),rt(m(n))):rt(m(v(s).pop())),e=!0;else if(z===r)_&&Y(_),e=!0;else if(F===r)d&&g!==d?Y(d):u.focus(),e=!0;else if(J===r){if(u.let(p=n.title,1),c(x)>1)for(var S;S=x.pop();)_=s[S]&&j(s[S]),u.let(S,1);u.fire("change",[p]),_?(Y(_),rt(m(_))):u.focus(),e=!0}else if("Delete"===r){if(u.let(p=n.title,1),c(x)>1)for(var D;D=x.shift();)d=s[D]&&k(s[D]),u.let(D,1);u.fire("change",[p]),d&&g!==d?(Y(d),rt(m(d))):u.focus(),e=!0}else"Escape"!==r&&"Tab"!==r||(u.focus(),e=!0)}e&&I(t)}function kt(t){var e=t.key,n=$(this),r=n._tags,i=n.state.n+"__tag--selected";if(st)if(z===e||F===e);else{var a=0;for(var u in r)E(r[u],i)&&++a;a<2&&A(this,i)}ot=st=!1}function yt(t){var n=this,r=Z(n),i=$(n),a=i.state.escape;if("\n"===r&&(e("\n",a)||e(13,a))||"\t"===r&&(e("\t",a)||e(9,a))||e(r,a))return i.set(w(n).slice(0,-1)).focus().text="",I(t)}function xt(t){var n,r=this,a=t.key,u=t.keyCode,o=ot=t.ctrlKey,s=st=t.shiftKey,f=$(r),c=f._active,l=f._mask,p=f._tags;f.mask;var h,g,d=f.self,b=f.state,k=l.hint,y=b.n+"__tag--selected";if(escape=b.escape,!c)return I(t);if(U===a&&(e("\n",escape)||e(13,escape))||"Tab"===a&&(e("\t",escape)||e(9,escape))||e(a,escape)||e(u,escape))return f.set(w(r)).focus().text="",I(t);B((function(){return K(k,w(r,!1)?"":d.placeholder)}),1)();var j,E=""===Z(r),S=null===w(r,!1);if(s)(S||E)&&z===a&&(g=v(p).pop())&&(g&&(Y(g),rt(m(g))),L(g,y),n=!0);else if(o)if("a"===a&&null===w(r,!1)&&null!==f.value){for(var D in p)Y(p[D]),rt(m(p[D])),L(p[D],y);n=!0}else G===a?((h=v(p).shift())&&Y(h),n=!0):Q===a||z===a?((g=v(p).pop())&&Y(g),n=!0):J===a&&((g=v(p).pop())&&f.let(g.title),f.focus(),n=!0);else if(U===a){var A=x(d);if(A&&i(A.requestSubmit)){var T=(j="button:not([type]),button[type=submit],input[type=image],input[type=submit]",(A||_).querySelector(j));T?A.requestSubmit(T):A.requestSubmit()}n=!0}else S?G===a?((h=v(p).shift())&&Y(h),n=!0):Q===a||z===a?((g=v(p).pop())&&Y(g),n=!0):J===a&&((g=v(p).pop())&&f.let(g.title),f.focus(),n=!0):E&&z===a&&((g=v(p).pop())&&Y(g),n=!0);n&&I(t)}function jt(){ot=st=!1}function wt(t){var e=$(this),n=e._tags,r=e.state,i=r.n+"__tag--selected",a=!0,u=(t.clipboardData||d.clipboardData).getData("text")+"";for(var o in n)if(!E(n[o],i)){a=!1;break}a&&e.value&&e.value.split(r.join).forEach((function(t){return e.let(t,1)}));var s=u.split(r.join);s.forEach((function(t){return e.set(t,-1,1)})),e.fire("paste",[t,s]).focus().fire("change"),I(t)}function Et(t){var e=this,n=$(e),r=n._mask,i=n.self,a=n.state,u=r.hint,o=(t.clipboardData||d.clipboardData).getData("text")+"";(function(t,e){var n,r=d.getSelection();r.rangeCount&&((n=r.getRangeAt(0)).deleteContents(),n.insertNode(_.createTextNode(e)))})(0,o),K(u,w(e)?"":i.placeholder),B((function(){if(o=w(e),n.text="",o){var r=o.split(a.join);r.forEach((function(t){return n.set(t,-1,1)})),n.fire("paste",[t,r]).fire("change")}}),1)(),I(t)}function St(t){var e=this,n=$(e),r=n._active,i=n._mask,a=n._tags,u=n.state,o=i.text,s=u.n+"__tag--selected";if(r){if(Y(e),P(e,s),ot);else if(st){nt();var f,l=y(e),p=(j="."+s,(l||_).querySelectorAll(j)),h=p[0],g=p[c(p)-1];if(h!==g)for(;(f=k(h))&&o!==f&&h!==g;)L(h=f,s)}else{nt();var d=2===t.button,b=0;for(var x in a)E(a[x],s)&&++b,e===a[x]||d||A(a[x],s);b>0&&L(e,s)}var j;E(e,s)?(Y(e),rt(m(e))):rt(v(a).pop()),n.fire("touch.tag",[t]),I(t),function(t){t&&t.stopPropagation()}(t)}}function Dt(t){var e=y(this),n=$(e);n._mask.input,H("click",this,Dt),n.let(e.title).focus(),I(t)}function At(t){$(this).let().fire("reset",[t])}function Tt(t){var e=$(this),n=e._tags,r=e.state;return l(n)<r.min?(e.fire("min.tags").focus(),I(t)):e.fire("submit",[t])}return ut.attach=function(t,e){var r=this;if(t=t||r.self,e&&f(e)&&(e={join:e}),e=h({},r.state,e||{}),E(t,e.n+"__self"))return r;(function(t){return t.required})(t)&&!e.min&&(e.min=1),r._active=!et(t)&&!function(t){return t.readOnly}(t),r._tags={},r._value=tt(t)||null,r.self=t,r.state=e;var a=e.n,u=x(t),l=O("div",{class:a,tabindex:!et(t)&&-1});r.mask=l;var p,v,g=O("span",{class:a+"__tags"}),_=O("span",{class:a+"__text"}),d=O("span",{contenteditable:!et(t)&&"",spellcheck:"false"}),m=O("span",t.placeholder+"");R(l,g),R(g,_),R(_,d),R(_,m),L(t,a+"__self"),v=l,y(p=t).insertBefore(v,k(p,!0)),u&&(it(u,r),M("reset",u,At),M("submit",u,Tt)),M("blur",d,ct),M("click",l,lt),M("focus",t,_t),M("focus",d,gt),M("input",d,yt),M("invalid",t,dt),M("keydown",d,xt),M("keyup",d,jt),M("paste",d,Et),t.tabIndex=-1,it(l,r),it(d,r);var b={};if(b.hint=m,b.input=d,b.of=t,b.self=l,b.tags=g,b.text=_,r._mask=b,r._value&&r._value.split(e.join).forEach((function(t){return r.set(t,-1,1,1)})),s(e)&&n(e.with))for(var j=0,w=c(e.with);j<w;++j){var S=e.with[j];f(S)&&(S=at[S]),i(S)?S.call(r,t,e):o(S)&&i(S.attach)&&S.attach.call(r,t,e)}return r},ut.blur=function(){nt();var t=this._mask,e=this._tags,n=t.input;for(var r in e)e[r].blur();return n.blur()},ut.detach=function(){var t=this,e=t._mask,r=t.mask,a=t.self,u=t.state,s=e.input;if(!E(a,u.n+"__self"))return t;var l=x(a);if(t._active=!1,t._value=tt(a)||null,l&&(H("reset",l,At),H("submit",l,Tt)),H("blur",s,ct),H("click",r,lt),H("focus",s,gt),H("focus",a,_t),H("input",s,yt),H("invalid",a,dt),H("keydown",s,xt),H("keyup",s,jt),H("paste",s,Et),n(u.with))for(var p=0,v=c(u.with);p<v;++p){var h=u.with[p];f(h)&&(h=at[h]),o(h)&&i(h.detach)&&h.detach.call(t,a,u)}return a.tabIndex=null,A(a,u.n+"__self"),T(r),t._mask={of:a},t.mask=null,t},ut.focus=function(t){var e=this._mask.input;return e&&(Y(e),rt(e,t)),this},ut.get=function(t){var e=this,n=e._active,r=e._tags;return!!n&&(e.fire("get.tag",[t]),r[t]?p(r).indexOf(t):null)},ut.let=function(t,e){var n=this,i=n._active,a=n._tags,u=n._value,o=n.self,s=n.state;if(!i)return n;if(!r(t))return n.value&&n.value.split(s.join).forEach((function(t){return n.let(t,1)})),u.split(s.join).forEach((function(t){return n.set(t,-1,1)})),n.fire("change");if(l(a)<s.min)return n.fire("min.tags",[t]);if(!a[t])return n;var f=a[t];b(f,0);var c=b(f,1);return H("blur",f,ft),H("contextmenu",f,pt),H("copy",f,vt),H("cut",f,ht),H("focus",f,mt),H("keydown",f,bt),H("keyup",f,kt),H("mousedown",f,St),H("mousedown",c,Dt),H("paste",f,wt),H("touchstart",f,St),H("touchstart",c,Dt),T(f),delete n._tags[t],o.value=p(n._tags).join(s.join),n.fire("let.tag",[t]),e||n.fire("change",[t]),n},ut.set=function(t,e,n,r){var a=this,o=a._active,s=a._filter,c=a._mask,v=a._tags,h=a.self,g=a.state,_=c.text,d=g.pattern,m=g.n;if(!o&&!r)return a;if(l(v)>=g.max)return a.fire("max.tags",[t]);if(i(s)&&(t=s.call(a,t)),a.fire("set.tag",[t]),""===t||f(d)&&!W(d).test(t))return a.fire("not.tag",[t]);if(v[t])return a.fire("has.tag",[t]);a.fire("is.tag",[t]);var b=O("span",{class:m+"__tag",tabindex:!!o&&-1,title:t}),k=O("span",t.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")),y=O("span",{class:m+"__x",tabindex:-1});if(o&&(M("blur",b,ft),M("contextmenu",b,pt),M("copy",b,vt),M("cut",b,ht),M("focus",b,mt),M("keydown",b,bt),M("keyup",b,kt),M("mousedown",b,St),M("mousedown",y,Dt),M("paste",b,wt),M("touchstart",b,St),M("touchstart",y,Dt),it(b,a)),R(b,k),R(b,y),function(t){return u(t)&&0==t%1}(e)&&e>=0){var x=p(v);x.splice(e,0,t),a._tags={},v[t]=b,x.forEach((function(t){a._tags[t]=v[t],N(_,v[t])}))}else N(_,b),a._tags[t]=b;return h.value=p(a._tags).join(g.join),a.fire("set.tag",[t]),n||a.fire("change",[t]),a},at}));