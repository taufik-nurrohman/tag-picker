/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2020 Taufik Nurrohman
 *
 * <https://github.com/taufik-nurrohman/tag-picker>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(n="undefined"!=typeof globalThis?globalThis:n||self).TP=t()}(this,(function(){"use strict";var n=function(n){return Array.isArray(n)},t=function(n,t){return n&&u(t)&&n instanceof t},e=function(n){return"number"==typeof n},r=function(n,e){return void 0===e&&(e=!0),"object"==typeof n&&(!e||t(n,Object))},u=function(n){return function(n){return void 0!==n}(n)&&!function(n){return null===n}(n)},i=function(n){return"string"==typeof n},c=function t(e){if(n(e))return e.map((function(n){return t(e)}));if(r(e)){for(var u in e)e[u]=t(e[u]);return e}return!1===e?"false":null===e?"null":!0===e?"true":""+e},o=function t(e){if(n(e))return e.map((function(n){return t(n)}));if(function(n){return/^-?(?:\d*.)?\d+$/.test(n+"")}(e))return function(n,t){return void 0===t&&(t=10),parseInt(n,t)}(e);if(r(e)){for(var u in e)e[u]=t(e[u]);return e}return{false:!1,null:null,true:!0}[e]||e},a=document,f=window,s=function(n,t,e){if(void 0===e&&(e=!0),!h(n,t))return null;var r=n.getAttribute(t);return e?o(r):r},l=function(n,t){var r=n.children;return e(t)?r[t]||null:r||[]},g=function(n){return(n&&n.nodeName||"").toLowerCase()||null},v=function(n){return n.nextElementSibling||null},d=function(n){return n.parentNode||null},p=function(n){return n.previousElementSibling||null},m=function(n,t){void 0===t&&(t=!0);var e="textContent";if(!k(n,e))return!1;var r=n[e];return""!==(r=t?r.trim():r)?r:null},h=function(n,t){return n.hasAttribute(t)},b=function(n){return null!==d(n)},k=function(n,t){return t in n},y=function(n,t){return n.removeAttribute(t),n},x=function(n,t){return n.classList.remove(t),n},L=function(t,e){if(n(e))return e.forEach((function(n){return t.classList.remove(n)})),t;if(r(e)){for(var u in e)e[u]&&t.classList.remove(u);return t}return t.className="",t},w=function(n){var t=d(n);return n.remove(),t},E=function(n,t,e){return!0===e&&(e=t),n.setAttribute(t,c(e)),n},A=function(n,t){return n.append(t),t},T=function(n,t){return n.classList.add(t),n},C=function(n,t,e){return n=i(n)?a.createElement(n):n,r(t)&&(e=t,t=!1),i(t)&&O(n,t),r(e)&&function(n,t){var e;for(var r in t)(e=t[r])||""===e||0===e?E(n,r,e):y(n,r)}(n,e),n},O=function(n,t,e){if(void 0===e&&(e=!0),null===t)return n;var r="innerHTML";return k(n,r)&&(n[r]=e?t.trim():t),n},B=function(n,t){return d(n).insertBefore(t,n),t},P=function(n,t,e){if(void 0===e&&(e=!0),null===t)return n;var r="textContent";return k(n,r)&&(n[r]=e?t.trim():t),n},K=function(n){return n&&n.preventDefault()},N=function(n,t,e){t.removeEventListener(n,e)},R=function(n,t,e,r){void 0===r&&(r=!1),t.addEventListener(n,e,r)},D=function(n,t){return-1!==t.indexOf(n)};function S(n,t){var e=this;return u(z[n])?(z[n].forEach((function(n){return n.apply(e,t)})),e):e}var z={};function H(n,t){if(!u(n))return z={},this;if(u(z[n]))if(u(t)){for(var e=0,r=z[n].length;e<r;++e)if(t===z[n][e]){z[n].splice(e,1);break}0===j&&delete z[n]}else delete z[n];return this}function I(n,t){return u(z[n])||(z[n]=[]),u(t)&&z[n].push(t),this}var M=function(n,e){return function(n){return t(n,RegExp)}(n)?n:(n=n.replace(/\//g,"\\/"),RegExp(n,u(e)?e:"g"))},$=function(n,t){var e=t.indexOf(n);return-1!==e?e:null},_=function(n){return n.length},q=function(n){return Object.keys(n)},F=f.setTimeout;function G(u,c){if(void 0===c&&(c={}),u){var o=this;if(u.TP)return o;if(!t(o,G))return new G(u,c);var a=function(){return u.disabled},f=function(){return u.readOnly},h=s(u,"placeholder"),y=s(u,"tabindex");o.state=c=function(){for(var n=arguments.length,t=Array(n),e=0;e<n;e++)t[e]=arguments[e];return Object.assign.apply(Object,[{}].concat(t))}(G.state,i(c)?{join:c}:c||{}),o.source=u;var j,E=S.bind(o),O=H.bind(o),J=I.bind(o);G.instances[u.id||u.name||(j=G.instances,_(q(j)))]=o,u.TP=1;var Q,U,V=C("span",{class:"editor tag"}),W=C("span",{contenteditable:!a()&&"true",spellcheck:"false",style:"white-space:pre;"}),X=C("span"),Y=function(n){var t="form";if(k(n,t)&&t===g(n.form))return n.form;for(var e=d(n);e&&t!==g(e);)e=d(e);return e||null}(u),Z=C("span",{class:c.class}),nn=C("span",{class:"tags"});return bn(""),A(Z,nn),A(nn,V),A(V,W),A(V,X),T(u,c.class+"-source"),U=Z,d(Q=u).insertBefore(U,v(Q)),C(u,{tabindex:"-1"}),R("blur",W,rn),R("click",W,un),R("click",Z,ln),R("focus",W,cn),R("focus",u,gn),R("keydown",W,on),R("paste",W,sn),Y&&R("submit",Y,fn),o.blur=function(){return!a()&&(W.blur(),rn())},o.click=function(){return Z.click()},ln(),o.f=function(n){return function(n){return n.toLowerCase()}(n||"").replace(/[^ a-z\d-]/g,"")},o.fire=E,o.focus=function(){return a()||(W.focus(),cn()),o},o.get=function(n){return a()?null:kn(n,1)},o.hooks=z,o.input=W,o.let=function(n){if(!a()&&!f()){var t=c.min;if(en(),t>0&&_(o.tags)<t)return E("min.tags",[t]),o;Ln(n),yn(n)}return o},o.off=O,o.on=J,o.pop=function(){if(!u.TP)return o;delete u.TP;var n=o.tags;return x(u,c.class+"-source"),N("blur",W,rn),N("click",W,un),N("click",Z,ln),N("focus",W,cn),N("focus",u,gn),N("keydown",W,on),N("paste",W,sn),Y&&N("submit",Y,fn),n.forEach(Ln),C(u,{tabindex:y}),w(Z),E("pop",[n])},o.self=Z,o.set=function(n,t){if(!a()&&!f()){var e=o.tags,r=c.max;kn(n)?E("has.tag",[n,$(n,e)]):_(e)<r?(jn(n,t),xn(n,t)):E("max.tags",[r])}return o},o.source=o.output=u,o.state=c,o.tags=[],an(u.value),o.value=function(n){return!a()&&!f()&&an(n)},o}function tn(n){return o.f(n).replace(M("("+c.escape.join("|").replace(/\\/g,"\\\\")+")+"),"").trim()}function en(){if(a()||f())return bn("");var n,t=tn(m(W)),e=o.tags;t&&(kn(t)?E("has.tag",[t,$(t,e)]):(jn(t),xn(t),n=_(e),E("change",[t,n]),E("set.tag",[t,n])),bn(""))}function rn(){en(),L(Z,["focus","focus.input"]),E("blur",[o.tags,_(o.tags)])}function un(){E("click",[o.tags])}function cn(){T(Z,"focus"),T(Z,"focus.input"),E("focus",[o.tags])}function on(n){var t,e=c.escape,r=n.key,u=n.keyCode,i=n.ctrlKey,s="Enter"===r||13===u,l=n.shiftKey,g="Tab"===r||9===u,v=p(V),d=_(o.tags),b=c.max,k=tn(m(W));s?r="\n":g&&(r="\t"),g||(a()||f()?(s&&f()&&wn(),K(n)):D(r,e)||D(u,e)?(d<b?en():(bn(""),E("max.tags",[b])),K(n)):s?(wn(),K(n)):F((function(){var c=m(W)||"",a=tn(c);D(c.slice(-1),e)?(d<b?en():(bn(""),E("max.tags",[b])),K(n)):""!==a||i||l||(""!==k||"Backspace"!==r&&"Backspace"!==u?"ArrowLeft"!==r&&37!==u||v&&v.focus():(x(Z,"focus.tag"),Ln(t=o.tags[d-1]),yn(t),v&&(E("change",[t,d-1]),E("let.tag",[t,d-1])))),P(X,a?"":h)}),0))}function an(n){if(b(Z))for(var t;t=p(V);)Ln(t.title);o.tags=[],u.value="",n=n?n.split(c.join):[];for(var e,r=0,i=c.max;r<i&&n[r];++r)if(""!==(e=tn(n[r]))){if(kn(e))continue;jn(e),xn(e),E("change",[e,r]),E("set.tag",[e,r])}}function fn(n){if(!a()){var t=c.min;return en(),t>0&&_(o.tags)<t?(bn("",1),E("min.tags",[t]),void K(n)):1}}function sn(){F((function(){a()||f()||an(m(W)),bn("")}),0)}function ln(n){n&&Z===n.target&&(W.focus(),un())}function gn(){W.focus()}function vn(){var n=this.title,t=o.tags;L(Z,["focus","focus.tag"]),E("blur.tag",[n,$(n,t)])}function dn(){var n=this.title,t=o.tags;E("click.tag",[n,$(n,t)])}function pn(){var t=this.title,e=o.tags;!function(t,e){if(n(e))return e.forEach((function(n){return t.classList.add(n)})),t;if(r(e))for(var u in e)e[u]?t.classList.add(u):t.classList.remove(u);t.className=e}(Z,["focus","focus.tag"]),E("focus.tag",[t,$(t,e)])}function mn(n){if(!a()&&!f()){var t=d(this).title,e=o.tags,r=$(t,e);Ln(t),yn(t),bn("",1),E("change",[t,r]),E("click.tag",[t,r]),E("let.tag",[t,r])}K(n)}function hn(n){var t=n.key,e=n.keyCode,r=n.ctrlKey,u=n.shiftKey,i=this,c=v(i),a=p(i);if(!r&&!u)if(f()||"ArrowLeft"!==t&&37!==e)if(f()||"ArrowRight"!==t&&39!==e){if("Backspace"===t||8===e||"Delete"===t||46===e){if(!f()){var s=i.title,l=o.tags,g=$(s,l);x(Z,"focus.tag"),Ln(s),yn(s),"Backspace"===t||8===e?a?a.focus():bn("",1):c&&c!==V?c.focus():bn("",1),E("change",[s,g]),E("let.tag",[s,g])}K(n)}}else c&&c!==V?c.focus():bn("",1),K(n);else a&&(a.focus(),K(n))}function bn(n,t){P(W,n),P(X,n?"":h),t&&W.focus()}function kn(n,t){var r=o.tags,u=$(n,r);return t&&E("get.tag",[n,u]),e(u)?n:null}function yn(n){var t=o.tags,r=$(n,t);return!!(e(r)&&r>=0)&&(u.value=t.join(c.join),o.tags.splice(r,1),!0)}function xn(n,t){e(t)?(t=t<0?0:t,o.tags.splice(t,0,n)):o.tags.push(n),u.value=o.tags.join(c.join)}function jn(n,t){var r=C("span",{class:"tag",tabindex:!a()&&"0",title:n});if(c.x){var u=C("a",{href:"",tabindex:"-1",target:"_top"});R("click",u,mn),A(r,u)}R("blur",r,vn),R("click",r,dn),R("focus",r,pn),R("keydown",r,hn),b(nn)&&(e(t)&&o.tags[t]?B(l(nn,t),r):B(V,r))}function Ln(n){var t,r=$(n,o.tags);if(e(r)&&r>=0&&(t=l(nn,r))){if(N("blur",t,vn),N("click",t,dn),N("focus",t,pn),N("keydown",t,hn),c.x){var u=t.firstElementChild||null;u&&(N("click",u,mn),w(u))}w(t)}}function wn(){fn()&&Y&&Y.submit()}}return G.instances={},G.state={class:"tag-picker",escape:[",",188],join:", ",max:9999,min:0,x:!1},G.version="3.1.7",G}));