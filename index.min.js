/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=e()}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},e=function(t){return"function"==typeof t},n=function(t,e){return t&&s(e)&&t instanceof e},r=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||n(t,Object))},s=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},i=function(t){return"string"==typeof t},a=function(t){return t.toLowerCase()},o=function(t){return t.length},u=function(t){return Object.values(t)},c=function e(){for(var n=arguments.length,i=Array(n),a=0;a<n;a++)i[a]=arguments[a];for(var u,c=i.shift(),f=0,l=o(i);f<l;++f)for(var h in i[f])if(s(c[h]))if(t(c[h])&&t(i[f][h])){c[h]=[].concat(c[h]);for(var v=0,d=o(i[f][h]);v<d;++v)u=i[f][h][v],-1===c[h].indexOf(u)&&c[h].push(i[f][h][v])}else r(c[h])&&r(i[f][h])?c[h]=e({},c[h],i[f][h]):c[h]=i[f][h];else c[h]=i[f][h];return c},f=function e(n){if(t(n))return n.map((function(t){return e(n)}));if(r(n)){for(var s in n)n[s]=e(n[s]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},l=document,h=window,v=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},d=function(t,e){return e?t.closest(e)||null:t.parentNode||null},p=function(t){var e="form";return g(t,e)&&e===function(t){return a(t&&t.nodeName||"")||null}(t[e])?t[e]:d(t,e)},_=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!g(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},g=function(t,e){return e in t},m=function(t,e){return t.removeAttribute(e),t},w=function(t,e){return t.classList.remove(e),t},y=function(t){var e=d(t);return t.remove(),e},b=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,f(n)),t},k=function(t,e){return t.append(e),e},x=function(t,e){return t.classList.add(e),t},j=function(t,e,n){return t=i(t)?l.createElement(t):t,r(e)&&(n=e,e=!1),i(e)&&A(t,e),r(n)&&function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?b(t,r,n):m(t,r)}(t,n),t},A=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="innerHTML";return g(t,r)&&(t[r]=n?e.trim():e),t};var E=function(t,e,n){e.removeEventListener(t,n)},L=function(t){return t&&t.preventDefault()},O=function(t,e,n,r){void 0===r&&(r=!1),e.addEventListener(t,n,r)},C="ArrowLeft",P="Backspace";function T(t){return t.disabled}function K(t,e){var r=this;return t?n(r,K)?(t["_"+K.name]=function(t,e){return(e=e||t).fire=function(t,e){var n=this,r=n.hooks;return s(r[t])?(r[t].forEach((function(t){return t.apply(n,e)})),n):n},e.off=function(t,e){var n=this,r=n.hooks;if(!s(t))return r={},n;if(s(r[t]))if(s(e)){var i=r[t].length;if(0===i)delete r[t];else for(var a=0;a<i;++a)if(e===r[t][a]){r[t].splice(a,1);break}}else delete r[t];return n},e.on=function(t,e){var n=this.hooks;return s(n[t])||(n[t]=[]),s(e)&&n[t].push(e),this},t.hooks={},t}(r,K.prototype),r.attach(t,c({},K.state,i(e)?{join:e}:e||{}))):new K(t,e):r}K.state={class:"tag-picker",escape:[","],join:", ",max:9999,min:0,pattern:null,with:[]},K.version="4.0.0",Object.defineProperty(K,"name",{value:"TagPicker"});var S=K.prototype;function B(){var t=this["_"+K.name].state;w(this,t.class+"--focus")}function R(){var t=this["_"+K.name],e=t._shadow,n=t.state;w(e.self,n.class+"--focus"),w(e.self,n.class+"--focus-tag")}function D(){var t=this["_"+K.name],e=t._shadow,n=t.state;w(e.self,n.class+"--focus"),w(e.self,n.class+"--focus-text")}function N(){this["_"+K.name]}function H(t){var e=d(this),n=e["_"+K.name];E("click",this,H),n.let(e.title),L(t)}function M(){var t=this["_"+K.name],e=t._shadow,n=t.state;x(e.self,n.class+"--focus"),x(e.self,n.class+"--focus-text")}function W(){this["_"+K.name].focus()}function Z(){var t=this["_"+K.name].state;x(this,t.class+"--focus")}function $(){var t=this["_"+K.name],e=t._shadow,n=t.state;x(e.self,n.class+"--focus"),x(e.self,n.class+"--focus-tag")}function q(t){var e,n=this,r=t.key,s=t.ctrlKey,i=t.shiftKey,a=n["_"+K.name],o=n.previousElementSibling||null,u=v(n),c=a._shadow.text;C===r?(o&&o.focus(),e=!0):"ArrowRight"===r?(u&&c!==u?u.focus():a.focus(),e=!0):P===r?(a.let(n.title),o?o.focus():a.focus(),e=!0):"Delete"===r?(a.let(n.title),u&&c!==u?u.focus():a.focus(),e=!0):s&&!i&&"a"===r&&(console.log("select all tags"),e=!0),e&&L(t)}function z(t){var e,n=this,r=t.key,s=t.keyCode,i=t.ctrlKey,a=t.shiftKey,o=n["_"+K.name],c=o._tags,f=o.state;if((escape=f.escape).includes(r)||escape.includes(s))return o.set(function(t){return _(t)}(n)),o.focus(),L(t);C===r&&""===function(t){var e,n=h.getSelection();if(n.rangeCount>0)return(e=n.getRangeAt(0).cloneRange()).collapse(!0),e.setStart(t,0),(e+"").slice(-1)}(n)?((e=u(c).pop())&&e.focus(),L(t)):P===r&&null===_(n)?((e=u(c).pop())&&o.let(e.title),o.focus(),L(t)):i&&!a&&"a"===r&&console.log("select all tags")}return S._filter=function(t){var e,n,r=this.state;return t=(t||"").split(r.join).join("").trim(),(e=t,void 0===n&&(n="-"),e.replace(/[A-Z]/g,(function(t){return n+a(t)})).replace(/\W+/g,n)).replace(/^-+|-+$/g,"")},S.attach=function(n,a){var u=this;n=n||u.self,a=a||u.state,u._active=!0,u._shadow={},u._tags={},u._value=function(t){return t.value.replace(/\r/g,"")}(n),u.self=u._shadow.of=n,u.state=a;var c=a.class,f=c+"__";p(n);var l=j("div",{class:c,tabindex:!T(n)&&-1}),h=j("span",{class:f+"tags"}),_=j("span",{class:f+"tag "+f+"text"});j("input",{class:f+"copy",tabindex:-1,type:"text"});var g,m,w=j("span",{contenteditable:!T(n)&&"true",spellcheck:"false",style:"white-space:pre;"}),y=j("span");if(k(l,h),k(h,_),k(_,w),k(_,y),x(n,f+"self"),m=l,d(g=n).insertBefore(m,v(g,!0)),O("blur",l,B),O("blur",w,D),O("click",l,N),O("focus",n,W),O("focus",l,Z),O("focus",w,M),O("keydown",w,z),l["_"+K.name]=u,w["_"+K.name]=u,u._shadow.input=w,u._shadow.self=l,u._shadow.tags=h,u._shadow.text=_,s(a)&&t(a.with))for(var b=0,A=o(a.with);b<A;++b){var E=a.with[b];i(E)&&(E=K[E]),e(E)?E.call(u,n,a):r(E)&&e(E.attach)&&E.attach.call(u,n,a)}return u},S.blur=function(){},S.click=function(){},S.detach=function(){var n=this,s=n._shadow,a=n.self,u=n.state,c=s.input,f=s.self;if(n._active=!1,E("blur",c,D),E("blur",f,B),E("click",f,N),E("focus",c,M),E("focus",a,W),E("focus",f,Z),E("keydown",c,z),t(u.with))for(var l=0,h=o(u.with);l<h;++l){var v=u.with[l];i(v)&&(v=K[v]),r(v)&&e(v.detach)&&v.detach.call(n,a,u)}return n._shadow={of:a},w(a,u.class+"__self"),y(f),n},S.focus=function(){var t=this._shadow;return t.input&&t.input.focus(),this},S.get=function(t){var e=this,n=e._active;e._shadow;var r=e._tags;return!!n&&(r[t]?t:null)},S.let=function(t){var e=this,n=e._active;e._shadow;var r=e._tags;if(!n)return e;if(!r[t])return!1;var s=r[t],i=s.firstElementChild||null;return E("blur",s,R),E("click",i,H),E("focus",s,$),E("keydown",s,q),y(s),delete r[t],e},S.set=function(t){var n=this,r=n._active,s=n._filter,i=n._shadow,a=n._tags;if(!r)return n;if(e(s)&&(t=s.call(n,t)),""===t||a[t])return!1;var o,u,c=j("span",{class:n.state.class+"__tag",tabindex:-1,title:t}),f=j("a",{class:n.state.class+"__tag-x",href:"",tabindex:-1,target:"_top"});return O("blur",c,R),O("click",f,H),O("focus",c,$),O("keydown",c,q),c["_"+K.name]=n,k(c,f),o=i.text,u=c,d(o).insertBefore(u,o),function(t,e,n){void 0===n&&(n=!0);var r="textContent";g(t,r)&&(t[r]=n?e.trim():e)}(i.input,""),n._tags[t]=c,n},Object.defineProperty(S,"tags",{get:function(){return t=this._tags,Object.keys(t);var t},set:function(t){var e=this;t.forEach((function(t){e.set(t)}))}}),Object.defineProperty(S,"value",{get:function(){return this.self.value},set:function(t){this.self.value=t}}),K}));