/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2022 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).TP=n()}(this,(function(){"use strict";var t=function(t,n){return-1!==n.indexOf(t)},n=function(t){return Array.isArray(t)},e=function(t,n){return t&&i(n)&&t instanceof n},r=function(t){return"number"==typeof t},u=function(t,n){return void 0===n&&(n=!0),"object"==typeof t&&(!n||e(t,Object))},i=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},o=function(t){return"string"==typeof t},f=function(t,n){var e=n.indexOf(t);return-1!==e?e:null},c=function(t){return t.toLowerCase()},a=function(t){return t.length},s=function(t){return Object.keys(t)},l=function t(e){if(n(e))return e.map((function(n){return t(n)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(e))return function(t,n){return void 0===n&&(n=10),n?parseInt(t,n):parseFloat(t)}(e);if(u(e)){for(var r in e)e[r]=t(e[r]);return e}return"false"!==e&&("null"===e?null:"true"===e||e)},v=function e(){for(var r=arguments.length,o=Array(r),f=0;f<r;f++)o[f]=arguments[f];for(var c=o.shift(),s=0,l=a(o);s<l;++s)for(var v in o[s])if(i(c[v]))if(n(c[v])&&n(o[s][v])){c[v]=[].concat(c[v]);for(var g=0,d=a(o[s][v]);g<d;++g)t(o[s][v][g],c[v])||c[v].push(o[s][v][g])}else u(c[v])&&u(o[s][v])?c[v]=e({},c[v],o[s][v]):c[v]=o[s][v];else c[v]=o[s][v];return c},g=function t(e){if(n(e))return e.map((function(n){return t(e)}));if(u(e)){for(var r in e)e[r]=t(e[r]);return e}return!1===e?"false":null===e?"null":!0===e?"true":""+e},d=document,p=window,m=function(t,n,e){if(void 0===e&&(e=!0),!L(t,n))return null;var r=t.getAttribute(n);return e?l(r):r},h=function(t,n){var e=t.children;return r(n)?e[n]||null:e||[]},b=function(t,n){return t["next"+(n?"":"Element")+"Sibling"]||null},y=function(t,n){return n?t.closest(n)||null:t.parentNode||null},k=function(t){var n="form";return T(t,n)&&n===function(t){return c(t&&t.nodeName||"")||null}(t.form)?t.form:y(t,n)},x=function(t,n){return t["previous"+(n?"":"Element")+"Sibling"]||null},E=function(t,n){void 0===n&&(n=!0);var e="textContent";if(!T(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},L=function(t,n){return t.hasAttribute(n)},w=function(t,n){return t.classList.contains(n)},A=function(t,n){return null!==y(t,n)},T=function(t,n){return n in t},R=function(t,n){return t.removeAttribute(n),t},P=function(t,n){return t.classList.remove(n),t},C=function(t,e){if(n(e))return e.forEach((function(n){return t.classList.remove(n)})),t;if(u(e)){for(var r in e)e[r]&&t.classList.remove(r);return t}return t.className="",t},N=function(t){var n=y(t);return t.remove(),n},O=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,g(e)),t},S=function(t,n){return t.append(n),n},K=function(t,n){return t.classList.add(n),t},B=function(t,e){if(n(e))return e.forEach((function(n){return t.classList.add(n)})),t;if(u(e))for(var r in e)e[r]?t.classList.add(r):t.classList.remove(r);return t.className=e,t},_=function(t,n,e){return t=o(t)?d.createElement(t):t,u(n)&&(e=n,n=!1),o(n)&&D(t,n),u(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?O(t,r,e):R(t,r)}(t,e),t},D=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="innerHTML";return T(t,r)&&(t[r]=e?n.trim():n),t},H=function(t,n){return y(t).insertBefore(n,t),n},z=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="textContent";return T(t,r)&&(t[r]=e?n.trim():n),t},F=function(t,n){return function(){var e=arguments,r=this;setTimeout((function(){return t.apply(r,e)}),n)}},I=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)};var M=function(t,n,e){n.removeEventListener(t,e)},$=function(t){return t&&t.preventDefault()},q=function(t,n,e){t.forEach((function(t){return M(t,n,e)}))},G=function(t,n,e,r){void 0===r&&(r=!1),n.addEventListener(t,e,r)},J=function(t,n,e,r){void 0===r&&(r=!1),t.forEach((function(t){return G(t,n,e,r)}))},Q=function(t,n){return function(t){return e(t,RegExp)}(t)?t:(t=t.replace(/\//g,"\\/"),RegExp(t,i(n)?n:"g"))},U="ArrowLeft",V="Home",W="Backspace",X="Tab";function Y(u,i){void 0===i&&(i={});var l=this;if(!u)return l;if(u.TP)return u.TP;if(!e(l,Y))return new Y(u,i);var g=function(){return u.disabled},L=function(){return u.readOnly},T=m(u,"placeholder"),R=m(u,"tabindex"),O=function(t){var n={};return t.hooks=n,t.fire=function(e,r){return I(n[e])?(n[e].forEach((function(n){return n.apply(t,r)})),t):t},t.off=function(e,r){if(!I(e))return n={},t;if(I(n[e]))if(I(r)){for(var u=0,i=n[e].length;u<i;++u)if(r===n[e][u]){n[e].splice(u,1);break}0===j&&delete n[e]}else delete n[e];return t},t.on=function(e,r){return I(n[e])||(n[e]=[]),I(r)&&n[e].push(r),t},t}(l);O.hooks;var D,Z=O.fire;l.state=i=v({},Y.state,o(i)?{join:i}:i||{}),l.source=u,Y.instances[u.id||u.name||(D=Y.instances,a(s(D)))]=l,u.TP=l;var tt,nt,et,rt,ut,it=i.class,ot=it+"__",ft=it+"--",ct=k(u),at=_("div",{class:it,tabindex:!g()&&-1}),st=_("span",{class:ot+"tag "+ot+"input"}),lt=_("input",{class:ot+"copy",tabindex:-1,type:"text"}),vt=_("span",{contenteditable:!g()&&"true",spellcheck:"false",style:"white-space:pre;"}),gt=_("span"),dt=_("span",{class:ot+"tags"}),pt=0,mt={};function ht(t,n){var e=f(t,l.tags);return n&&Z("get.tag",[t,e]),r(e)?t:null}function bt(){mt={};var t,n=h(dt),e=a(n)-1;for(t=0;t<e;++t)w(n[t],ot+"tag--selected")&&(mt[t]=n[t])}function yt(t,n){r(n)?(n=n<0?0:n,l.tags.splice(n,0,t)):l.tags.push(t),u.value=l.tags.join(i.join)}function kt(t,n){var e=_("span",{class:ot+"tag",tabindex:!g()&&!L()&&0,title:t}),u=_("a",{class:ot+"tag-x",href:"",tabindex:-1,target:"_top"});G("click",u,zt),S(e,u),G("click",e,Ht),J(["blur","focus"],e,Kt),A(dt)&&(r(n)&&l.tags[n]?H(h(dt,n),e):H(st,e))}function xt(n){if(n=n?n.split(i.join):[],A(at))for(var e,r,o;e=x(st);)jt(o=e.title),t(o,n)||(r=f(o,l.tags),Z("change",[o,r]),Z("let.tag",[o,r]));l.tags=[],u.value="";for(var c,a=0,s=i.max;a<s&&n[a];++a)""!==(c=Nt(n[a]))&&(kt(c),yt(c),Z("change",[c,a]),Z("set.tag",[c,a]))}function Et(t){var n=f(t,l.tags);r(n)&&n>=0&&(l.tags.splice(n,1),u.value=l.tags.join(i.join))}function jt(t){var n,e=f(t,l.tags);if(r(e)&&e>=0&&(n=h(dt,e))){M("click",n,Ht),q(["blur","focus"],n,Kt);var u=n.firstElementChild||null;u&&(M("click",u,zt),N(u)),N(n)}}function Lt(t){N(lt),t&&At("",1)}function wt(t){S(at,lt),lt.value=l.tags.join(i.join),t&&(lt.focus(),lt.select())}function At(t,n){if(z(vt,t),z(gt,t?"":T),n){vt.focus();var e=d.createRange(),r=p.getSelection();e.selectNodeContents(vt),e.collapse(!1),r.removeAllRanges(),r.addRange(e)}}function Tt(t){Ct(t,(function(){P(this,ot+"tag--selected")}))}function Rt(t){Ct(t,(function(){K(this,ot+"tag--selected")}))}function Pt(){if(!g()&&!L()){var t=Ot(E(vt)).trim(),n=i.pattern;if(n&&t&&!Q(n,"").test(t))return Z("not.tag",[t,-1]),void At(t,1);if(At(""),t=Nt(t))if(ht(t))Z("has.tag",[t,f(t,l.tags)]);else{kt(t),yt(t);var e=a(l.tags);Z("change",[t,e]),Z("set.tag",[t,e])}}}function Ct(t,n){var e,r=h(dt),u=a(r)-1;for(e=0;e<u;++e)t!==r[e]&&n.call(r[e],e)}function Nt(t){return Ot(l.f(t)).trim()}function Ot(t){return t=t||"",i.escape.forEach((function(n){t=t.split(n).join("")})),t}function St(t){"blur"===t.type?(Tt(),C(at,[ft+"focus",ft+"focus-self"])):B(at,[ft+"focus",ft+"focus-self"])}function Kt(t){if(!L()){mt={};var n=this,e=t.type,r=n.title,u=l.tags,i=f(r,u),o=ot+"tag--";"blur"===e?(!tt&&!nt||nt&&et)&&(Tt(n),P(n,o+"selected"),C(at,[ft+"focus",ft+"focus-tag"])):(K(n,o+"selected"),B(at,[ft+"focus",ft+"focus-tag"]),pt=i,mt[i]=n),Z(e+".tag",[r,i])}}function Bt(t){var n=l.tags,e=t.type,r=ot+"text--";P(at,ft+"focus-tag"),"blur"===e?(P(st,r+"focus"),C(at,[ft+"focus",ft+"focus-input"]),Pt()):(K(st,r+"focus"),B(at,[ft+"focus",ft+"focus-input"]),Tt(st)),Z(e,[n,a(n)])}function _t(t){"blur"===t.type?P(at,ft+"focus"):K(at,ft+"focus")}function Dt(t){t&&at===t.target&&vt.focus();var n=l.tags;Z("click",[n,a(n)])}function Ht(){var t=this.title,n=l.tags;Z("click.tag",[t,f(t,n)])}function zt(t){if(!g()&&!L()){var n=y(this).title,e=f(n,l.tags);jt(n),Et(n),At("",1),Z("change",[n,e]),Z("click.tag",[n,e]),Z("let.tag",[n,e])}$(t)}function Ft(t){var n=t.type;"copy"===n?F((function(){return Lt(1)}))():"cut"===n?(!L()&&xt(""),F((function(){return Lt(1)}))()):"paste"===n&&F((function(){!L()&&xt(lt.value),Lt(1)}))(),F((function(){var t=l.tags;Z(n,[t,a(t)])}),1)()}function It(){Tt(),P(at,ft+"focus-self")}function Mt(){vt.focus()}function $t(t){if(!g()&&!L()){l.tags;var n,e,r,u,i,o,f=t.key,c=tt=t.ctrlKey,v=nt=t.shiftKey,d=ot+"tag--";if(et=X===f,!c){if(!v&&(W===f||"Delete"===f)){bt(),o=mt;var p=W===f;for(e in o)jt(i=(n=o[e]).title),Et(i);return pt=+(s(o)[0]||0),(n=h(dt,p?pt-1:pt))?st===n?At("",1):n.focus():At("",1),void $(t)}if(V===f)return void((n=h(dt,0))&&(n.focus(),$(t)));if("End"===f&&(n=h(dt,a(l.tags)-1)))return n.focus(),void $(t);if(U===f){if(n=h(dt,pt-1)){var m=w(n,d+"selected");return n.focus(),$(t),v?(r=b(n),void(m&&P(r,d+"selected"))):void Tt(n)}if(!v)return void Tt(h(dt,0))}if("ArrowRight"===f&&(n=h(dt,pt+1))){var y=w(n,d+"selected");return st!==n||v?n.focus():At("",1),$(t),v?(u=x(n),void(y&&P(u,d+"selected"))):void Tt(n)}}"a"===f&&(wt(1),Rt(),bt(),$(t))}}function qt(n){!function(t){t&&t.stopPropagation()}(n),L()&&X!==n.key&&$(n);var e,r=i.escape,u=x(st),o=a(l.tags),f=i.max,c=E(vt)||"",s=n.key,v=tt=n.ctrlKey,g="Enter"===s;nt=n.shiftKey;var d=et=X===s;if(g&&(s="\n"),d&&(s="\t"),F((function(){c=E(vt)||"",z(gt,c?"":T),t(function(t){var n,e=p.getSelection();if(e.rangeCount>0)return(n=e.getRangeAt(0).cloneRange()).collapse(!0),n.setStart(t,0),(n+"").slice(-1)}(vt),r)&&(o<f?Pt():(At(""),Z("max.tags",[f])),$(n))}))(),""===c&&V===s&&(e=h(dt,0)))return e.focus(),void $(n);if(""===c&&"End"===s&&(e=h(dt,a(l.tags)-1)))return e.focus(),void $(n);if(v&&""===c&&"a"===s)return wt(1),Rt(),bt(),void $(n);if(t(s,r))return o<f?Pt():(At(""),Z("max.tags",[f])),void $(n);if(!d){if(!v&&g)return Qt()&&ct&&ct.dispatchEvent(new Event("submit",{cancelable:!0})),void $(n);if(u&&""===c&&!L()){if(W===s)return jt(e=l.tags[o-1]),Et(e),Z("change",[e,o-1]),Z("let.tag",[e,o-1]),void $(n);if(U===s)return void u.focus()}}}function Gt(){tt=nt=!1}function Jt(){F((function(){g()||L()||E(vt).split(i.join).forEach((function(n){t(n,l.tags)||(kt(n),yt(n))})),At("")}))()}function Qt(t){if(!g()){var n=i.min;return Pt(),n>0&&a(l.tags)<n?(At("",1),Z("min.tags",[n]),void $(t)):1}}return At(""),S(at,dt),S(st,vt),S(st,gt),S(dt,st),K(u,ot+"source"),ut=at,y(rt=u).insertBefore(ut,b(rt,!0)),_(u,{tabindex:-1}),G("blur",at,It),G("click",at,Dt),G("focus",u,Mt),G("keydown",at,$t),G("keydown",vt,qt),G("keyup",at,Gt),G("paste",vt,Jt),J(["blur","focus"],at,_t),J(["blur","focus"],lt,St),J(["blur","focus"],vt,Bt),J(["copy","cut","paste"],lt,Ft),ct&&G("submit",ct,Qt),l.blur=function(){return!g()&&vt.blur(),l},l.click=function(){return at.click(),Dt(),l},l.f=function(t){return c(t||"").replace(/[^ a-z\d-]/g,"").trim()},l.focus=function(){return g()||At(E(vt),1),l},l.get=function(t){return g()?null:ht(t,1)},l.input=vt,l.let=function(t){if(!g()&&!L()){var e=i.min;if(t)if(n(t))t.forEach((function(t){if(e>0&&a(l.tags)<e)return Z("min.tags",[e]),l;jt(t),Et(t)}));else{if(e>0&&a(l.tags)<e)return Z("min.tags",[e]),l;jt(t),Et(t)}else xt("")}return l},l.pop=function(){if(!u.TP)return l;delete u.TP;var t=l.tags;return P(u,ot+"source"),M("blur",at,It),M("click",at,Dt),M("focus",u,Mt),M("keydown",at,$t),M("keydown",vt,qt),M("keyup",at,Gt),M("paste",vt,Jt),q(["blur","focus"],at,_t),q(["blur","focus"],lt,St),q(["blur","focus"],vt,Bt),q(["copy","cut","paste"],lt,Ft),ct&&M("submit",ct,Qt),t.forEach(jt),_(u,{tabindex:R}),N(at),Z("pop",[t])},l.self=at,l.set=function(t,e){if(!t)return l;if(!g()&&!L())if(n(t))xt(t.join(i.join));else{var r=l.tags,u=i.max;ht(t)?Z("has.tag",[t,f(t,r)]):a(r)<u?(kt(t,e),yt(t,e)):Z("max.tags",[u])}return l},l.source=l.output=u,l.state=i,l.tags=[],xt(u.value),l}return Y.instances={},Y.state={class:"tag-picker",escape:[","],join:", ",max:9999,min:0,pattern:null},Y.version="3.4.17",Y}));