/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2024 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).TagPicker=e()}(this,(function(){"use strict";var t=function(t){return Array.isArray(t)},e=function(t){return"function"==typeof t},n=function(t,e){return t&&s(e)&&t instanceof e},r=function(t,e){return void 0===e&&(e=!0),"object"==typeof t&&(!e||n(t,Object))},s=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},a=function(t){return"string"==typeof t},i=function(t){return t.toLowerCase()},o=function(t){return t.length},u=function(t){return Object.keys(t)},c=function(t){return Object.values(t)},f=function e(){for(var n=arguments.length,a=Array(n),i=0;i<n;i++)a[i]=arguments[i];for(var u,c=a.shift(),f=0,l=o(a);f<l;++f)for(var h in a[f])if(s(c[h]))if(t(c[h])&&t(a[f][h])){c[h]=[].concat(c[h]);for(var v=0,d=o(a[f][h]);v<d;++v)u=a[f][h][v],-1===c[h].indexOf(u)&&c[h].push(a[f][h][v])}else r(c[h])&&r(a[f][h])?c[h]=e({},c[h],a[f][h]):c[h]=a[f][h];else c[h]=a[f][h];return c},l=function e(n){if(t(n))return n.map((function(t){return e(n)}));if(r(n)){for(var s in n)n[s]=e(n[s]);return n}return!1===n?"false":null===n?"null":!0===n?"true":""+n},h=document,v=window,d=function(t,e){return t["next"+(e?"":"Element")+"Sibling"]||null},_=function(t,e){return e?t.closest(e)||null:t.parentNode||null},p=function(t){var e="form";return m(t,e)&&e===function(t){return i(t&&t.nodeName||"")||null}(t[e])?t[e]:_(t,e)},g=function(t,e){void 0===e&&(e=!0);var n="textContent";if(!m(t,n))return!1;var r=t[n];return""!==(r=e?r.trim():r)?r:null},m=function(t,e){return e in t},w=function(t,e){return t.removeAttribute(e),t},y=function(t,e){return t.classList.remove(e),t},b=function(t){var e=_(t);return t.remove(),e},x=function(t,e,n){return!0===n&&(n=e),t.setAttribute(e,l(n)),t},k=function(t,e){return t.append(e),e},j=function(t,e){return t.classList.add(e),t},E=function(t,e,n){return t=a(t)?h.createElement(t):t,r(e)&&(n=e,e=!1),a(e)&&A(t,e),r(n)&&function(t,e){var n;for(var r in e)(n=e[r])||""===n||0===n?x(t,r,n):w(t,r)}(t,n),t},A=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="innerHTML";return m(t,r)&&(t[r]=n?e.trim():e),t},T=function(t,e,n){if(void 0===n&&(n=!0),null===e)return t;var r="textContent";return m(t,r)&&(t[r]=n?e.trim():e),t};var L=function(t,e,n){e.removeEventListener(t,n)},O=function(t){return t&&t.preventDefault()},C=function(t,e,n,r){void 0===r&&(r=!1),e.addEventListener(t,n,r)},K=function(t,e){return function(t){return n(t,RegExp)}(t)?t:RegExp(t,s(e)?e:"g")},P="ArrowLeft",R="Backspace",S="Delete";function B(t){return t.disabled}function D(t,e){var r=this;return t?n(r,D)?(t["_"+D.name]=function(t,e){return(e=e||t).fire=function(t,e){var n=this,r=n.hooks;return s(r[t])?(r[t].forEach((function(t){return t.apply(n,e)})),n):n},e.off=function(t,e){var n=this,r=n.hooks;if(!s(t))return r={},n;if(s(r[t]))if(s(e)){var a=r[t].length;if(0===a)delete r[t];else for(var i=0;i<a;++i)if(e===r[t][i]){r[t].splice(i,1);break}}else delete r[t];return n},e.on=function(t,e){var n=this.hooks;return s(n[t])||(n[t]=[]),s(e)&&n[t].push(e),this},t.hooks={},t}(r,D.prototype),r.attach(t,f({},D.state,a(e)?{join:e}:e||{}))):new D(t,e):r}D.state={class:"tag-picker",escape:[","],join:", ",max:9999,min:0,pattern:null,with:[]},D.version="4.0.0",Object.defineProperty(D,"name",{value:"TagPicker"});var I=D.prototype;function N(){var t=this["_"+D.name].state;y(this,t.class+"--focus")}function H(){var t=this["_"+D.name],e=t._shadow,n=t.state.class,r=e.self;y(r,n+="--focus"),y(r,n+="-tag")}function M(){var t=this["_"+D.name],e=t._shadow,n=t.state,r=e.text,s=n.class,a=e.self;y(r,s+"__text--focus"),y(a,s+="--focus"),y(a,s+="-text")}function W(t){this["_"+D.name]._shadow.input.focus(),O(t)}function Z(t){var e,n,r=this,s=r["_"+D.name],a=s._tags,i=s.state.class+"__tag--selected";for(var o in a)r!==a[o]&&y(a[o],i);e=i,r.classList.toggle(e,n),function(t){t&&t.stopPropagation()}(t)}function $(t){var e=_(this),n=e["_"+D.name],r=n._shadow.input;L("click",this,$),n.let(e.title),r.focus(),O(t)}function q(){var t=this,e=t["_"+D.name]._shadow.input;v.setTimeout((function(){return b(t),e.focus()}),1)}function z(){var t=this,e=t["_"+D.name],n=e._shadow,r=e.state,s=n.input;t.value.split(r.join).forEach((function(t){return e.let(t)})),v.setTimeout((function(){return b(t),s.focus()}),1)}function F(){var t=this["_"+D.name],e=t._shadow,n=t._tags,r=t.state,s=e.copy,a=e.text,i=r.class,o=e.self;for(var u in n)y(n[u],i+"__tag--selected");y(o,i+"--focus-tags"),b(s),j(a,i+"__text--focus"),j(o,i+="--focus"),j(o,i+="-text")}function G(){this["_"+D.name].focus()}function J(){var t=this["_"+D.name].state;j(this,t.class+"--focus")}function Q(){var t=this["_"+D.name],e=t._shadow,n=t.state.class,r=e.self;j(r,n+="--focus"),j(r,n+="-tag")}function U(t){var e,n=this,r=t.key,s=t.ctrlKey,a=t.shiftKey,i=n["_"+D.name],o=i._shadow,u=i._tags,c=i.state,f=o.copy,l=o.self,h=o.text,v=n.previousElementSibling||null,_=d(n),p=c.class;if(P===r)v&&v.focus(),e=!0;else if("ArrowRight"===r)_&&h!==_?_.focus():i.focus(),e=!0;else if(R===r)i.let(n.title),v?v.focus():i.focus(),e=!0;else if(S===r)i.let(n.title),_&&h!==_?_.focus():i.focus(),e=!0;else if(s&&!a&&"a"===r){for(var g in u)j(u[g],p+"__tag--selected");f.value=i.value,k(l,f),f.focus(),f.select(),j(l,p+="--focus"),y(l,p+"-tag"),j(l,p+="-tags"),e=!0}e&&O(t)}function V(t){var e=t.key,n=t.ctrlKey,r=t.shiftKey,s=this["_"+D.name],a=s._shadow,i=s.state,o=a.input;R===e||S===e?(this.value.split(i.join).forEach((function(t){return s.let(t)})),o.focus()):n||r||o.focus()}function X(t){var e,n,r,s=this,a=t.key,i=t.keyCode,o=t.ctrlKey,u=t.shiftKey,f=s["_"+D.name],l=f._shadow,h=f._tags,d=f.state,_=l.copy,p=l.hint,m=l.self,w=d.class;if((escape=d.escape).includes(a)||escape.includes(i))return f.set(function(t){return g(t)}(s)),T(s,""),T(p,f.self.placeholder),f.focus(),O(t);if(v.setTimeout((function(){T(p,g(s)?"":f.self.placeholder)}),1),P===a&&""===function(t){var e,n=v.getSelection();if(n.rangeCount>0)return(e=n.getRangeAt(0).cloneRange()).collapse(!0),e.setStart(t,0),(e+"").slice(-1)}(s))(r=c(h).pop())&&r.focus(),e=!0;else if(R===a&&null===g(s))(r=c(h).pop())&&f.let(r.title),f.focus(),e=!0;else if(o&&!u&&"a"===a&&null===g(s)&&null!==(n=f.value)){for(var b in h)j(h[b],w+"__tag--selected");_.value=n,k(m,_),_.focus(),_.select(),j(m,w+="--focus"),y(m,w+"-tag"),j(m,w+="-tags"),e=!0}e&&O(t)}function Y(){var t=this,e=t["_"+D.name],n=e._shadow,r=e.state,s=n.hint;v.setTimeout((function(){var n=g(t);null!==n&&n.split(r.join).forEach((function(t){return e.set(t)})),T(t,""),T(s,e.self.placeholder)}),1)}return I._filter=function(t){var e,n,r=this.state;return t=(t||"").split(r.join).join("").trim(),(e=t,void 0===n&&(n="-"),e.replace(/[A-Z]/g,(function(t){return n+i(t)})).replace(/\W+/g,n)).replace(/^-+|-+$/g,"")},I.attach=function(n,i){var u=this;n=n||u.self,i=i||u.state,u._active=!0,u._tags={},u._value=function(t){return t.value.replace(/\r/g,"")}(n),u.self=n,u.state=i;var c=i.class,f="_"+D.name;p(n);var l,h,v=E("div",{class:c,tabindex:!B(n)&&-1}),g=E("span",{class:c+"__tags"}),m=E("span",{class:c+"__text"}),w=E("input",{class:c+"__copy",tabindex:-1,type:"text"}),y=E("span",{contenteditable:!B(n)&&"true",spellcheck:"false",style:"white-space:pre;"}),b=E("span",n.placeholder+"");k(v,g),k(g,m),k(m,y),k(m,b),j(n,c+"__self"),h=v,_(l=n).insertBefore(h,d(l,!0)),C("blur",v,N),C("blur",y,M),C("copy",w,q),C("cut",w,z),C("focus",n,G),C("focus",v,J),C("focus",y,F),C("keydown",w,V),C("keydown",y,X),C("mousedown",v,W),C("paste",y,Y),C("touchstart",v,W),n.tabIndex=-1,v[f]=u,w[f]=u,y[f]=u;var x={};if(x.copy=w,x.hint=b,x.input=y,x.of=n,x.self=v,x.tags=g,x.text=m,u._shadow=x,s(i)&&t(i.with))for(var A=0,T=o(i.with);A<T;++A){var L=i.with[A];a(L)&&(L=D[L]),e(L)?L.call(u,n,i):r(L)&&e(L.attach)&&L.attach.call(u,n,i)}return u},I.blur=function(){},I.click=function(){},I.detach=function(){var n=this,s=n._shadow,i=n.self,u=n.state,c=s.copy,f=s.input,l=s.self;if(n._active=!1,L("blur",f,M),L("blur",l,N),L("copy",c,q),L("cut",c,z),L("focus",f,F),L("focus",i,G),L("focus",l,J),L("keydown",c,V),L("keydown",f,X),L("mousedown",l,W),L("paste",f,Y),L("touchstart",l,W),t(u.with))for(var h=0,v=o(u.with);h<v;++h){var d=u.with[h];a(d)&&(d=D[d]),r(d)&&e(d.detach)&&d.detach.call(n,i,u)}return i.tabIndex=null,y(i,u.class+"__self"),b(l),n._shadow={of:i},n},I.focus=function(){var t=this._shadow;return t.input&&t.input.focus(),this},I.get=function(t){var e=this,n=e._active;e._shadow;var r=e._tags;return!!n&&(r[t]?t:null)},I.let=function(t){var e=this,n=e._active;e._shadow;var r=e._tags,s=e.state;if(!n)return e;if(!r[t])return!1;var a=r[t],i=a.firstElementChild||null;return L("blur",a,H),L("click",i,$),L("focus",a,Q),L("keydown",a,U),L("mousedown",a,Z),L("touchstart",a,Z),b(a),delete e._tags[t],e.self.value=u(e._tags).join(s.join),e},I.set=function(t){var n=this,r=n._active,s=n._filter,i=n._shadow,o=n._tags,c=n.state,f=c.pattern;if(!r)return n;if(e(s)&&(t=s.call(n,t)),a(f)&&K(f)&&!K(f).test(t))return!1;if(""===t||o[t])return!1;var l,h,v=E("span",{class:n.state.class+"__tag",tabindex:-1,title:t}),d=E("a",{class:n.state.class+"__tag-x",href:"",tabindex:-1,target:"_top"});return C("blur",v,H),C("click",d,$),C("focus",v,Q),C("keydown",v,U),C("mousedown",v,Z),C("touchstart",v,Z),v["_"+D.name]=n,k(v,d),l=i.text,h=v,_(l).insertBefore(h,l),n._tags[t]=v,n.self.value=u(n._tags).join(c.join),n},Object.defineProperty(I,"tags",{get:function(){return u(this._tags)},set:function(t){var e=this;e._tags={},e.self.value="",t.forEach((function(t){return e.set(t)}))}}),Object.defineProperty(I,"value",{get:function(){var t=this.self.value;return""===t?null:t},set:function(t){this.self.value=t}}),D}));