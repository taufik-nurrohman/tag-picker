/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2020 Taufik Nurrohman
 *
 * <https://github.com/taufik-nurrohman/tag-picker>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(n="undefined"!=typeof globalThis?globalThis:n||self).TP=t()}(this,(function(){"use strict";var n=function(n){return Array.isArray(n)},t=function(n,t){return n&&u(t)&&n instanceof t},e=function(n){return"number"==typeof n},r=function(n,e){return void 0===e&&(e=!0),"object"==typeof n&&(!e||t(n,Object))},u=function(n){return function(n){return void 0!==n}(n)&&!function(n){return null===n}(n)},i=function(n){return"string"==typeof n},o=function t(e){if(n(e))return e.map((function(n){return t(e)}));if(r(e)){for(var u in e)e[u]=t(e[u]);return e}return!1===e?"false":null===e?"null":!0===e?"true":""+e},c=function(n,t){var e=t.indexOf(n);return-1!==e?e:null},a=function(n){return n.toLowerCase()},f=function(n){return n.length},s=function(n){return Object.keys(n)},l=function t(e){if(n(e))return e.map((function(n){return t(n)}));if(function(n){return/^-?(?:\d*.)?\d+$/.test(n+"")}(e))return function(n,t){return void 0===t&&(t=10),t?parseInt(n,t):parseFloat(n)}(e);if(r(e)){for(var u in e)e[u]=t(e[u]);return e}return"false"!==e&&("null"===e?null:"true"===e||e)},g=document,v=window,p=function(n,t,e){if(void 0===e&&(e=!0),!x(n,t))return null;var r=n.getAttribute(t);return e?l(r):r},d=function(n,t){var r=n.children;return e(t)?r[t]||null:r||[]},m=function(n){return a(n&&n.nodeName||"")||null},h=function(n){return n.nextElementSibling||null},b=function(n){return n.parentNode||null},k=function(n){return n.previousElementSibling||null},y=function(n,t){void 0===t&&(t=!0);var e="textContent";if(!L(n,e))return!1;var r=n[e];return""!==(r=t?r.trim():r)?r:null},x=function(n,t){return n.hasAttribute(t)},E=function(n){return null!==b(n)},L=function(n,t){return t in n},w=function(n,t){return n.removeAttribute(t),n},A=function(n,t){return n.classList.remove(t),n},T=function(t,e){if(n(e))return e.forEach((function(n){return t.classList.remove(n)})),t;if(r(e)){for(var u in e)e[u]&&t.classList.remove(u);return t}return t.className="",t},O=function(n){var t=b(n);return n.remove(),t},B=function(n,t,e){return!0===e&&(e=t),n.setAttribute(t,o(e)),n},C=function(n,t){return n.append(t),t},P=function(n,t){return n.classList.add(t),n},K=function(n,t,e){return n=i(n)?g.createElement(n):n,r(t)&&(e=t,t=!1),i(t)&&N(n,t),r(e)&&function(n,t){var e;for(var r in t)(e=t[r])||""===e||0===e?B(n,r,e):w(n,r)}(n,e),n},N=function(n,t,e){if(void 0===e&&(e=!0),null===t)return n;var r="innerHTML";return L(n,r)&&(n[r]=e?t.trim():t),n},R=function(n,t){return b(n).insertBefore(t,n),t},D=function(n,t,e){if(void 0===e&&(e=!0),null===t)return n;var r="textContent";return L(n,r)&&(n[r]=e?t.trim():t),n},S=function(n){return n&&n.preventDefault()},z=function(n,t,e){t.removeEventListener(n,e)},F=function(n,t,e,r){void 0===r&&(r=!1),t.addEventListener(n,e,r)},H=function(n,t){return-1!==t.indexOf(n)};function I(n){var t={};return n.hooks=t,n.fire=function(e,r){return u(t[e])?(t[e].forEach((function(t){return t.apply(n,r)})),n):n},n.off=function(e,r){if(!u(e))return t={},n;if(u(t[e]))if(u(r)){for(var i=0,o=t[e].length;i<o;++i)if(r===t[e][i]){t[e].splice(i,1);break}0===j&&delete t[e]}else delete t[e];return n},n.on=function(e,r){return u(t[e])||(t[e]=[]),u(r)&&t[e].push(r),n},n}var M=I({});M.fire,M.off,M.on,M.hooks;var $=function(n,e){return function(n){return t(n,RegExp)}(n)?n:(n=n.replace(/\//g,"\\/"),RegExp(n,u(e)?e:"g"))},_=v.setTimeout;function q(u,o){if(void 0===o&&(o={}),u){var l=this;if(!u.TP){if(!t(l,q))return new q(u,o);var g,v=function(){return u.disabled},x=function(){return u.readOnly},j=p(u,"placeholder"),w=p(u,"tabindex"),B=I(l).fire;l.state=o=function(){for(var n=arguments.length,t=Array(n),e=0;e<n;e++)t[e]=arguments[e];return Object.assign.apply(Object,[{}].concat(t))}(q.state,i(o)?{join:o}:o||{}),l.source=u,q.instances[u.id||u.name||(g=q.instances,f(s(g)))]=l,u.TP=1;var N,M,G=K("span",{class:"editor tag"}),J=K("span",{contenteditable:!v()&&"true",spellcheck:"false",style:"white-space:pre;"}),Q=K("span"),U=function(n){var t="form";if(L(n,t)&&t===m(n.form))return n.form;for(var e=b(n);e&&t!==m(e);)e=b(e);return e||null}(u),V=K("span",{class:o.class}),W=K("span",{class:"tags"});return pn(""),C(V,W),C(W,G),C(G,J),C(G,Q),P(u,o.class+"-source"),M=V,b(N=u).insertBefore(M,h(N)),K(u,{tabindex:"-1"}),F("blur",J,Z),F("click",J,nn),F("click",V,cn),F("focus",J,tn),F("focus",u,an),F("keydown",J,en),F("paste",J,on),U&&F("submit",U,un),l.blur=function(){return!v()&&(J.blur(),Z())},l.click=function(){return V.click()},cn(),l.f=function(n){return a(n||"").replace(/[^ a-z\d-]/g,"")},l.focus=function(){return v()||(J.focus(),tn()),l},l.get=function(n){return v()?null:dn(n,1)},l.input=J,l.let=function(n){if(!v()&&!x()){var t=o.min;if(Y(),t>0&&f(l.tags)<t)return B("min.tags",[t]),l;kn(n),mn(n)}return l},l.pop=function(){if(!u.TP)return l;delete u.TP;var n=l.tags;return A(u,o.class+"-source"),z("blur",J,Z),z("click",J,nn),z("click",V,cn),z("focus",J,tn),z("focus",u,an),z("keydown",J,en),z("paste",J,on),U&&z("submit",U,un),n.forEach(kn),K(u,{tabindex:w}),O(V),B("pop",[n])},l.self=V,l.set=function(n,t){if(!v()&&!x()){var e=l.tags,r=o.max;dn(n)?B("has.tag",[n,c(n,e)]):f(e)<r?(bn(n,t),hn(n,t)):B("max.tags",[r])}return l},l.source=l.output=u,l.state=o,l.tags=[],rn(u.value),l.value=function(n){return!v()&&!x()&&rn(n)},l}}function X(n){return l.f(n).replace($("("+o.escape.join("|").replace(/\\/g,"\\\\")+")+"),"").trim()}function Y(){if(v()||x())return pn("");var n,t=X(y(J));t&&(dn(t)?B("has.tag",[t,c(t,l.tags)]):(bn(t),hn(t),n=f(l.tags),B("change",[t,n]),B("set.tag",[t,n])),pn(""))}function Z(){Y(),T(V,["focus","focus.input"]),B("blur",[l.tags,f(l.tags)])}function nn(){B("click",[l.tags])}function tn(){P(V,"focus"),P(V,"focus.input"),B("focus",[l.tags])}function en(n){var t,e=o.escape,r=n.key,u=n.keyCode,i=n.ctrlKey,c="Enter"===r||13===u,a=n.shiftKey,s="Tab"===r||9===u,g=k(G),p=f(l.tags),d=o.max,m=X(y(J));c?r="\n":s&&(r="\t"),s||(v()||x()?(c&&x()&&yn(),S(n)):H(r,e)||H(u,e)?(p<d?Y():(pn(""),B("max.tags",[d])),S(n)):c?(yn(),S(n)):_((function(){var o=y(J)||"",c=X(o);H(o.slice(-1),e)?(p<d?Y():(pn(""),B("max.tags",[d])),S(n)):""!==c||i||a||(""!==m||"Backspace"!==r&&"Backspace"!==u?"ArrowLeft"!==r&&37!==u||g&&g.focus():(A(V,"focus.tag"),kn(t=l.tags[p-1]),mn(t),g&&(B("change",[t,p-1]),B("let.tag",[t,p-1])))),D(Q,c?"":j)}),0))}function rn(n){if(E(V))for(var t;t=k(G);)kn(t.title);l.tags=[],u.value="",n=n?n.split(o.join):[];for(var e,r=0,i=o.max;r<i&&n[r];++r)if(""!==(e=X(n[r]))){if(dn(e))continue;bn(e),hn(e),B("change",[e,r]),B("set.tag",[e,r])}}function un(n){if(!v()){var t=o.min;return Y(),t>0&&f(l.tags)<t?(pn("",1),B("min.tags",[t]),void S(n)):1}}function on(){_((function(){v()||x()||rn(y(J)),pn("")}),0)}function cn(n){n&&V===n.target&&(J.focus(),nn())}function an(){J.focus()}function fn(){var n=this.title;T(V,["focus","focus.tag"]),B("blur.tag",[n,c(n,l.tags)])}function sn(){var n=this.title;B("click.tag",[n,c(n,l.tags)])}function ln(){var t=this.title;!function(t,e){if(n(e))return e.forEach((function(n){return t.classList.add(n)})),t;if(r(e))for(var u in e)e[u]?t.classList.add(u):t.classList.remove(u);t.className=e}(V,["focus","focus.tag"]),B("focus.tag",[t,c(t,l.tags)])}function gn(n){if(!v()&&!x()){var t=b(this).title,e=c(t,l.tags);kn(t),mn(t),pn("",1),B("change",[t,e]),B("click.tag",[t,e]),B("let.tag",[t,e])}S(n)}function vn(n){var t=n.key,e=n.keyCode,r=n.ctrlKey,u=n.shiftKey,i=this,o=h(i),a=k(i);if(!r&&!u)if(x()||"ArrowLeft"!==t&&37!==e)if(x()||"ArrowRight"!==t&&39!==e){if("Backspace"===t||8===e||"Delete"===t||46===e){if(!x()){var f=i.title,s=c(f,l.tags);A(V,"focus.tag"),kn(f),mn(f),"Backspace"===t||8===e?a?a.focus():pn("",1):o&&o!==G?o.focus():pn("",1),B("change",[f,s]),B("let.tag",[f,s])}S(n)}}else o&&o!==G?o.focus():pn("",1),S(n);else a&&(a.focus(),S(n))}function pn(n,t){D(J,n),D(Q,n?"":j),t&&J.focus()}function dn(n,t){var r=c(n,l.tags);return t&&B("get.tag",[n,r]),e(r)?n:null}function mn(n){var t=c(n,l.tags);return!!(e(t)&&t>=0)&&(l.tags.splice(t,1),u.value=l.tags.join(o.join),!0)}function hn(n,t){e(t)?(t=t<0?0:t,l.tags.splice(t,0,n)):l.tags.push(n),u.value=l.tags.join(o.join)}function bn(n,t){var r=K("span",{class:"tag",tabindex:!v()&&"0",title:n});if(o.x){var u=K("a",{href:"",tabindex:"-1",target:"_top"});F("click",u,gn),C(r,u)}F("blur",r,fn),F("click",r,sn),F("focus",r,ln),F("keydown",r,vn),E(W)&&(e(t)&&l.tags[t]?R(d(W,t),r):R(G,r))}function kn(n){var t,r=c(n,l.tags);if(e(r)&&r>=0&&(t=d(W,r))){if(z("blur",t,fn),z("click",t,sn),z("focus",t,ln),z("keydown",t,vn),o.x){var u=t.firstElementChild||null;u&&(z("click",u,gn),O(u))}O(t)}}function yn(){un()&&U&&U.submit()}}return q.instances={},q.state={class:"tag-picker",escape:[",",188],join:", ",max:9999,min:0,x:!1},q.version="3.1.10",q}));