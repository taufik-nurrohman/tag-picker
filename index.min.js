/*!
 *
 * The MIT License (MIT)
 *
 * Copyright © 2023 Taufik Nurrohman <https://github.com/taufik-nurrohman>
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the “Software”), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t="undefined"!=typeof globalThis?globalThis:t||self).TP=n()}(this,(function(){"use strict";var t=function(t,n){return-1!==n.indexOf(t)},n=function(t){return Array.isArray(t)},e=function(t,n){return t&&i(n)&&t instanceof n},r=function(t){return"number"==typeof t},u=function(t,n){return void 0===n&&(n=!0),"object"==typeof t&&(!n||e(t,Object))},i=function(t){return function(t){return void 0!==t}(t)&&!function(t){return null===t}(t)},o=function(t){return"string"==typeof t},f=function(t,n){var e=n.indexOf(t);return-1!==e?e:null},c=function(t){return t.toLowerCase()},a=function(t){return t.length},s=function(t){return Object.keys(t)},l=function t(e){if(n(e))return e.map((function(n){return t(n)}));if(function(t){return/^-?(?:\d*.)?\d+$/.test(t+"")}(e))return function(t,n){return void 0===n&&(n=10),n?parseInt(t,n):parseFloat(t)}(e);if(u(e)){for(var r in e)e[r]=t(e[r]);return e}return"false"!==e&&("null"===e?null:"true"===e||e)},v=function e(){for(var r=arguments.length,o=Array(r),f=0;f<r;f++)o[f]=arguments[f];for(var c=o.shift(),s=0,l=a(o);s<l;++s)for(var v in o[s])if(i(c[v]))if(n(c[v])&&n(o[s][v])){c[v]=[].concat(c[v]);for(var g=0,d=a(o[s][v]);g<d;++g)t(o[s][v][g],c[v])||c[v].push(o[s][v][g])}else u(c[v])&&u(o[s][v])?c[v]=e({},c[v],o[s][v]):c[v]=o[s][v];else c[v]=o[s][v];return c},g=function t(e){if(n(e))return e.map((function(n){return t(e)}));if(u(e)){for(var r in e)e[r]=t(e[r]);return e}return!1===e?"false":null===e?"null":!0===e?"true":""+e},d=document,p=window,m=function(t,n,e){if(void 0===e&&(e=!0),!L(t,n))return null;var r=t.getAttribute(n);return e?l(r):r},h=function(t,n){var e=t.children;return r(n)?e[n]||null:e||[]},b=function(t,n){return t["next"+(n?"":"Element")+"Sibling"]||null},y=function(t,n){return n?t.closest(n)||null:t.parentNode||null},k=function(t){var n="form";return R(t,n)&&n===function(t){return c(t&&t.nodeName||"")||null}(t[n])?t[n]:y(t,n)},x=function(t,n){return t["previous"+(n?"":"Element")+"Sibling"]||null},E=function(t,n){void 0===n&&(n=!0);var e="textContent";if(!R(t,e))return!1;var r=t[e];return""!==(r=n?r.trim():r)?r:null},L=function(t,n){return t.hasAttribute(n)},w=function(t,n){return t.classList.contains(n)},A=function(t,n){return null!==y(t,n)},R=function(t,n){return n in t},T=function(t,n){return t.removeAttribute(n),t},C=function(t,n){return t.classList.remove(n),t},N=function(t,e){if(n(e))return e.forEach((function(n){return t.classList.remove(n)})),t;if(u(e)){for(var r in e)e[r]&&t.classList.remove(r);return t}return t.className="",t},O=function(t){var n=y(t);return t.remove(),n},S=function(t,n,e){return!0===e&&(e=n),t.setAttribute(n,g(e)),t},K=function(t,n){return t.append(n),n},B=function(t,n){return t.classList.add(n),t},P=function(t,e){if(n(e))return e.forEach((function(n){return t.classList.add(n)})),t;if(u(e))for(var r in e)e[r]?t.classList.add(r):t.classList.remove(r);return t.className=e,t},_=function(t,n,e){return t=o(t)?d.createElement(t):t,u(n)&&(e=n,n=!1),o(n)&&D(t,n),u(e)&&function(t,n){var e;for(var r in n)(e=n[r])||""===e||0===e?S(t,r,e):T(t,r)}(t,e),t},D=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="innerHTML";return R(t,r)&&(t[r]=e?n.trim():n),t},H=function(t,n){return y(t).insertBefore(n,t),n},z=function(t,n,e){if(void 0===e&&(e=!0),null===n)return t;var r="textContent";return R(t,r)&&(t[r]=e?n.trim():n),t},F=function(t,n){return function(){var e=arguments,r=this;setTimeout((function(){return t.apply(r,e)}),n)}};var I=function(t,n,e){n.removeEventListener(t,e)},M=function(t){return t&&t.preventDefault()},$=function(t,n,e){t.forEach((function(t){return I(t,n,e)}))},q=function(t,n,e,r){void 0===r&&(r=!1),n.addEventListener(t,e,r)},G=function(t,n,e,r){void 0===r&&(r=!1),t.forEach((function(t){return q(t,n,e,r)}))},J=function(t,n){return function(t){return e(t,RegExp)}(t)?t:(t=t.replace(/\//g,"\\/"),RegExp(t,i(n)?n:"g"))},Q="TP",U="ArrowLeft",V="Home",W="Backspace",X="Tab";function Y(u,l){void 0===l&&(l={});var g=this;if(!u)return g;if(u[Q])return u[Q];if(!e(g,Y))return new Y(u,l);var L=function(){return u.disabled},R=function(){return u.readOnly},T=m(u,"placeholder"),S=m(u,"tabindex"),D=function(t){var n={};return t.hooks=n,t.fire=function(e,r){return i(n[e])?(n[e].forEach((function(n){return n.apply(t,r)})),t):t},t.off=function(e,r){if(!i(e))return n={},t;if(i(n[e]))if(i(r)){for(var u=0,o=n[e].length;u<o;++u)if(r===n[e][u]){n[e].splice(u,1);break}0===j&&delete n[e]}else delete n[e];return t},t.on=function(e,r){return i(n[e])||(n[e]=[]),i(r)&&n[e].push(r),t},t}(g);D.hooks;var Z,tt=D.fire;g.state=l=v({},Y.state,o(l)?{join:l}:l||{}),g.source=u,Y.instances[u.id||u.name||(Z=Y.instances,a(s(Z)))]=g,u[Q]=g;var nt,et,rt,ut,it,ot=l.class,ft=ot+"__",ct=ot+"--",at=k(u),st=_("div",{class:ot,tabindex:!L()&&-1}),lt=_("span",{class:ft+"tag "+ft+"input"}),vt=_("input",{class:ft+"copy",tabindex:-1,type:"text"}),gt=_("span",{contenteditable:!L()&&"true",spellcheck:"false",style:"white-space:pre;"}),dt=_("span"),pt=_("span",{class:ft+"tags"}),mt=0,ht={};function bt(t,n){var e=f(t,g.tags);return n&&tt("get.tag",[t,e]),r(e)?t:null}function yt(){ht={};var t,n=h(pt),e=a(n)-1;for(t=0;t<e;++t)w(n[t],ft+"tag--selected")&&(ht[t]=n[t])}function kt(t,n){r(n)?(n=n<0?0:n,g.tags.splice(n,0,t)):g.tags.push(t),u.value=g.tags.join(l.join)}function xt(t,n){var e=_("span",{class:ft+"tag",tabindex:!L()&&!R()&&0,title:t}),u=_("a",{class:ft+"tag-x",href:"",tabindex:-1,target:"_top"});q("click",u,Ft),K(e,u),q("click",e,zt),G(["blur","focus"],e,Pt),A(pt)&&(r(n)&&g.tags[n]?H(h(pt,n),e):H(lt,e))}function Et(n){if(n=n?n.split(l.join):[],A(st))for(var e,r,i;e=x(lt);)Lt(i=e.title),t(i,n)||(r=f(i,g.tags),tt("change",[i,r]),tt("let.tag",[i,r]));g.tags=[],u.value="";for(var o,c=0,a=l.max;c<a&&n[c];++c)""!==(o=St(n[c]))&&(xt(o),kt(o),tt("change",[o,c]),tt("set.tag",[o,c]))}function jt(t){var n=f(t,g.tags);r(n)&&n>=0&&(g.tags.splice(n,1),u.value=g.tags.join(l.join))}function Lt(t){var n,e=f(t,g.tags);if(r(e)&&e>=0&&(n=h(pt,e))){I("click",n,zt),$(["blur","focus"],n,Pt);var u=n.firstElementChild||null;u&&(I("click",u,Ft),O(u)),O(n)}}function wt(t){O(vt),t&&Rt("",1)}function At(t){K(st,vt),vt.value=g.tags.join(l.join),t&&(vt.focus(),vt.select())}function Rt(t,n){if(z(gt,t),z(dt,t?"":T),n){gt.focus();var e=d.createRange(),r=p.getSelection();e.selectNodeContents(gt),e.collapse(!1),r.removeAllRanges(),r.addRange(e)}}function Tt(t){Ot(t,(function(){C(this,ft+"tag--selected")}))}function Ct(t){Ot(t,(function(){B(this,ft+"tag--selected")}))}function Nt(){if(!L()&&!R()){var t=Kt(E(gt)).trim(),n=l.pattern;if(n&&t&&!J(n,"").test(t))return tt("not.tag",[t,-1]),void Rt(t,1);if(Rt(""),t=St(t))if(bt(t))tt("has.tag",[t,f(t,g.tags)]);else{xt(t),kt(t);var e=a(g.tags);tt("change",[t,e]),tt("set.tag",[t,e])}}}function Ot(t,n){var e,r=h(pt),u=a(r)-1;for(e=0;e<u;++e)t!==r[e]&&n.call(r[e],e)}function St(t){return Kt(g.f(t)).trim()}function Kt(t){return t=t||"",l.escape.forEach((function(n){t=t.split(n).join("")})),t}function Bt(t){"blur"===t.type?(Tt(),N(st,[ct+"focus",ct+"focus-self"])):P(st,[ct+"focus",ct+"focus-self"])}function Pt(t){if(!R()){ht={};var n=this,e=t.type,r=n.title,u=g.tags,i=f(r,u),o=ft+"tag--";"blur"===e?(!nt&&!et||et&&rt)&&(Tt(n),C(n,o+"selected"),N(st,[ct+"focus",ct+"focus-tag"])):(B(n,o+"selected"),P(st,[ct+"focus",ct+"focus-tag"]),mt=i,ht[i]=n),tt(e+".tag",[r,i])}}function _t(t){var n=g.tags,e=t.type,r=ft+"text--";C(st,ct+"focus-tag"),"blur"===e?(C(lt,r+"focus"),N(st,[ct+"focus",ct+"focus-input"]),Nt()):(B(lt,r+"focus"),P(st,[ct+"focus",ct+"focus-input"]),Tt(lt)),tt(e,[n,a(n)])}function Dt(t){"blur"===t.type?C(st,ct+"focus"):B(st,ct+"focus")}function Ht(t){t&&st===t.target&&gt.focus();var n=g.tags;tt("click",[n,a(n)])}function zt(){var t=this.title,n=g.tags;tt("click.tag",[t,f(t,n)])}function Ft(t){if(!L()&&!R()){var n=y(this).title,e=f(n,g.tags);Lt(n),jt(n),Rt("",1),tt("change",[n,e]),tt("click.tag",[n,e]),tt("let.tag",[n,e])}M(t)}function It(t){var n=t.type;"copy"===n?F((function(){return wt(1)}),1)():"cut"===n?(!R()&&Et(""),F((function(){return wt(1)}),1)()):"paste"===n&&F((function(){!R()&&Et(vt.value),wt(1)}),1)(),F((function(){var t=g.tags;tt(n,[t,a(t)])}),1)()}function Mt(){Tt(),C(st,ct+"focus-self")}function $t(){gt.focus()}function qt(t){if(!L()&&!R()){g.tags;var n,e,r,u,i,o,f=t.key,c=nt=t.ctrlKey,l=et=t.shiftKey,v=ft+"tag--";if(rt=X===f,!c){if(!l&&(W===f||"Delete"===f)){yt(),o=ht;var d=W===f;for(e in o)Lt(i=(n=o[e]).title),jt(i);return mt=+(s(o)[0]||0),(n=h(pt,d?mt-1:mt))?lt===n?Rt("",1):n.focus():Rt("",1),void M(t)}if(V===f)return void((n=h(pt,0))&&(n.focus(),M(t)));if("End"===f&&(n=h(pt,a(g.tags)-1)))return n.focus(),void M(t);if(U===f){if(n=h(pt,mt-1)){var p=w(n,v+"selected");return n.focus(),M(t),l?(r=b(n),void(p&&C(r,v+"selected"))):void Tt(n)}if(!l)return void Tt(h(pt,0))}if("ArrowRight"===f&&(n=h(pt,mt+1))){var m=w(n,v+"selected");return lt!==n||l?n.focus():Rt("",1),M(t),l?(u=x(n),void(m&&C(u,v+"selected"))):void Tt(n)}}"a"===f&&(At(1),Ct(),yt(),M(t))}}function Gt(n){!function(t){t&&t.stopPropagation()}(n),R()&&X!==n.key&&M(n);var e,r=l.escape,u=x(lt),i=a(g.tags),o=l.max,f=E(gt)||"",c=n.key,s=nt=n.ctrlKey,v="Enter"===c;et=n.shiftKey;var d=rt=X===c;if(v&&(c="\n"),d&&(c="\t"),F((function(){f=E(gt)||"",z(dt,f?"":T),t(function(t){var n,e=p.getSelection();if(e.rangeCount>0)return(n=e.getRangeAt(0).cloneRange()).collapse(!0),n.setStart(t,0),(n+"").slice(-1)}(gt),r)&&(i<o?Nt():(Rt(""),tt("max.tags",[o])),M(n))}),1)(),""===f&&V===c&&(e=h(pt,0)))return e.focus(),void M(n);if(""===f&&"End"===c&&(e=h(pt,a(g.tags)-1)))return e.focus(),void M(n);if(s&&""===f&&"a"===c)return At(1),Ct(),yt(),void M(n);if(t(c,r))return i<o?Nt():(Rt(""),tt("max.tags",[o])),void M(n);if(!d){if(!s&&v)return Ut()&&at&&at.dispatchEvent(new Event("submit",{cancelable:!0})),void M(n);if(u&&""===f&&!R()){if(W===c)return Lt(e=g.tags[i-1]),jt(e),tt("change",[e,i-1]),tt("let.tag",[e,i-1]),void M(n);if(U===c)return void u.focus()}}}function Jt(){nt=et=!1}function Qt(){F((function(){L()||R()||E(gt).split(l.join).forEach((function(n){t(n,g.tags)||(xt(n),kt(n))})),Rt("")}),1)()}function Ut(t){if(!L()){var n=l.min;return Nt(),n>0&&a(g.tags)<n?(Rt("",1),tt("min.tags",[n]),void M(t)):1}}return Rt(""),K(st,pt),K(lt,gt),K(lt,dt),K(pt,lt),B(u,ft+"source"),it=st,y(ut=u).insertBefore(it,b(ut,!0)),_(u,{tabindex:-1}),q("blur",st,Mt),q("click",st,Ht),q("focus",u,$t),q("keydown",st,qt),q("keydown",gt,Gt),q("keyup",st,Jt),q("paste",gt,Qt),G(["blur","focus"],st,Dt),G(["blur","focus"],vt,Bt),G(["blur","focus"],gt,_t),G(["copy","cut","paste"],vt,It),at&&q("submit",at,Ut),g.blur=function(){return!L()&&gt.blur(),g},g.click=function(){return st.click(),Ht(),g},g.f=function(t){return c(t||"").replace(/[^ a-z\d-]/g,"").trim()},g.focus=function(){return L()||Rt(E(gt),1),g},g.get=function(t){return L()?null:bt(t,1)},g.input=gt,g.let=function(t){if(!L()&&!R()){var e=l.min;if(t)if(n(t))t.forEach((function(t){if(e>0&&a(g.tags)<e)return tt("min.tags",[e]),g;Lt(t),jt(t)}));else{if(e>0&&a(g.tags)<e)return tt("min.tags",[e]),g;Lt(t),jt(t)}else Et("")}return g},g.pop=function(){if(!u[Q])return g;delete u[Q];var t=g.tags;return C(u,ft+"source"),I("blur",st,Mt),I("click",st,Ht),I("focus",u,$t),I("keydown",st,qt),I("keydown",gt,Gt),I("keyup",st,Jt),I("paste",gt,Qt),$(["blur","focus"],st,Dt),$(["blur","focus"],vt,Bt),$(["blur","focus"],gt,_t),$(["copy","cut","paste"],vt,It),at&&I("submit",at,Ut),t.forEach(Lt),_(u,{tabindex:S}),O(st),tt("pop",[t])},g.self=st,g.set=function(t,e){if(!t)return g;if(!L()&&!R())if(n(t))Et(t.join(l.join));else{var r=g.tags,u=l.max;bt(t)?tt("has.tag",[t,f(t,r)]):a(r)<u?(xt(t,e),kt(t,e)):tt("max.tags",[u])}return g},g.source=g.output=u,g.state=l,g.tags=[],Et(u.value),g}return Y.instances={},Y.state={class:"tag-picker",escape:[","],join:", ",max:9999,min:0,pattern:null},Y.version="3.4.18",Y}));