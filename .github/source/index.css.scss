$name: 'tag-picker';

:root {
  --color-#{$name}: #000;
  --color-#{$name}__tag-x: #fff;
  --color-#{$name}__tag: #000;
  --fill-#{$name}--disabled: #eee;
  --fill-#{$name}--read-only: #eee;
  --fill-#{$name}: #fff;
  --fill-#{$name}__tag--disabled: #aaa;
  --fill-#{$name}__tag--focus: #c00;
  --fill-#{$name}__tag--read-only: #f00;
  --fill-#{$name}__tag--selected: #c00;
  --fill-#{$name}__tag: #f00;
  --font-face-#{$name}: inherit;
  --font-height-#{$name}: 1.5em;
  --font-height-#{$name}: 1.5em;
  --font-size-#{$name}: inherit;
  --radius-#{$name}: 0;
  --radius-#{$name}__tag: 0;
  --shadow-#{$name}: none;
  --shadow-#{$name}__tag: none;
  --stroke-#{$name}--disabled: #666;
  --stroke-#{$name}--focus: #00f;
  --stroke-#{$name}--read-only: #666;
  --stroke-#{$name}: #000;
  --stroke-#{$name}__tag: transparent;
  --width-#{$name}: 100%;
}

.#{$name},
.#{$name} * {
  box-sizing: border-box;
  color: inherit;
  font: inherit;
}

.#{$name} {
  background: var(--fill-#{$name});
  border: 1px solid;
  border-color: var(--stroke-#{$name});
  border-radius: var(--radius-#{$name});
  color: var(--color-#{$name});
  cursor: text;
  display: inline-flex;
  flex-wrap: wrap;
  flex: 1;
  font: inherit;
  font-family: var(--font-face-#{$name});
  font-size: var(--font-size-#{$name});
  height: var(--height-#{$name}, auto);
  line-height: var(--font-height-#{$name});
  max-height: var(--height-max-#{$name}, 100%);
  max-width: var(--width-max-#{$name}, 100%);
  min-height: var(--height-min-#{$name}, 0);
  min-width: var(--width-min-#{$name}, 0);
  outline: 0;
  padding: .125em;
  position: relative;
  width: var(--width-#{$name}, auto);
  $states: hover, focus, active;
  @each $state in $states {
    &:#{$state} {
      background: var(--fill-#{$name}--#{$state}, var(--fill-#{$name}));
      border-color: var(--stroke-#{$name}--#{$state}, var(--stroke-#{$name}));
      box-shadow: var(--shadow-#{$name}--#{$state}, var(--shadow-#{$name}));
      color: var(--color-#{$name}--#{$state}, var(--color-#{$name}));
    }
  }
  $states: focus, disabled;
  @each $state in $states {
    &--#{$state} {
      background: var(--fill-#{$name}--#{$state}, var(--fill-#{$name}));
      border-color: var(--stroke-#{$name}--#{$state}, var(--stroke-#{$name}));
      box-shadow: var(--shadow-#{$name}--#{$state}, var(--shadow-#{$name}));
      color: var(--color-#{$name}--#{$state}, var(--color-#{$name}));
    }
  }
}

.#{$name}__copy {
  height: 1px;
  left: 0;
  margin: 0;
  opacity: 0;
  padding: 0;
  position: absolute;
  top: 0;
  width: 1px;
}

.#{$name}__tag {
  height: var(--height-#{$name}); // Same with `min-height` of container
  margin: .125em;
  outline: 0;
  padding: 0 .5em;
  position: relative;
  text-decoration: none;
  &:not(.#{$name}__text) {
    background: var(--fill-#{$name}__tag);
    border: 0 solid;
    border-color: var(--stroke-#{$name}__tag);
    border-radius: var(--radius-#{$name}__tag);
    box-shadow: var(--shadow-#{$name}__tag);
    color: var(--color-#{$name}__tag);
    cursor: pointer;
  }
  $states: hover, focus, active;
  @each $state in $states {
    &:not(.#{$name}__text):#{$state} {
      background: var(--fill-#{$name}__tag--#{$state}, var(--fill-#{$name}__tag));
      border-color: var(--stroke-#{$name}__tag--#{$state}, var(--stroke-#{$name}__tag));
      box-shadow: var(--shadow-#{$name}__tag--#{$state}, var(--shadow-#{$name}__tag));
      color: var(--color-#{$name}__tag--#{$state}, var(--color-#{$name}__tag));
    }
  }
  $states: selected, disabled;
  @each $state in $states {
    &--#{$state}:not(.#{$name}__text) {
      background: var(--fill-#{$name}__tag--#{$state}, var(--fill-#{$name}__tag));
      border-color: var(--stroke-#{$name}__tag--#{$state}, var(--stroke-#{$name}__tag));
      box-shadow: var(--shadow-#{$name}__tag--#{$state}, var(--shadow-#{$name}__tag));
      color: var(--color-#{$name}__tag--#{$state}, var(--color-#{$name}__tag));
    }
  }
  &::before {
    content: attr(title);
  }
  + .#{$name}__text {
    span {
      + span {
        // Hide the placeholder if we have at least one tag
        display: none;
      }
    }
  }
  &-x {
    color: var(--color-#{$name}__tag-x);
    margin-left: .5em;
    outline: 0;
    text-decoration: none;
    $states: hover, focus, active;
    @each $state in $states {
      &:#{$state} {
        color: var(--color-#{$name}__tag-x--#{$state}, var(--color-#{$name}__tag-x));
      }
    }
    &::before {
      content: '\00d7'; // The “×” button
      font-family: sans-serif;
    }
  }
}

.#{$name}__text {
  flex: 1;
  span {
    display: block;
    height: 100%;
    outline: 0;
    position: relative;
    z-index: 1;
    * {
      display: inline; // Remove (hide) line-break in tag editor
    }
    + span {
      bottom: 0;
      left: 0;
      opacity: .5;
      padding: inherit;
      position: absolute;
      right: 0;
      top: 0;
      white-space: nowrap;
      z-index: 0;
    }
  }
}

.#{$name}__tags {
  display: flex;
  flex-wrap: wrap;
  flex: 1;
  line-height: var(--height-#{$name});
  min-height: var(--height-#{$name});
}

.#{$name}__source {
  left: -9999px;
  position: fixed;
  top: -9999px;
  &:read-only {
    + .#{$name} {
      .#{$name}__tag-x {
        cursor: not-allowed;
      }
      .#{$name}__tag:not(.#{$name}__text) {
        background: var(--fill-#{$name}__tag--read-only, var(--fill-#{$name}__tag));
        border-color: var(--stroke-#{$name}__tag--read-only, var(--stroke-#{$name}__tag));
        box-shadow: var(--shadow-#{$name}__tag--read-only, var(--shadow-#{$name}__tag));
        color: var(--color-#{$name}__tag--read-only, var(--color-#{$name}__tag));
      }
      background: var(--fill-#{$name}--read-only, var(--fill-#{$name}));
      border-color: var(--stroke-#{$name}--read-only, var(--stroke-#{$name}));
      box-shadow: var(--shadow-#{$name}--read-only, var(--shadow-#{$name}));
      color: var(--color-#{$name}--read-only, var(--color-#{$name}));
    }
  }
  &:disabled {
    + .#{$name} {
      &,
      & * {
        cursor: not-allowed;
      }
      .#{$name}__tag:not(.#{$name}__text) {
        background: var(--fill-#{$name}__tag--disabled, var(--fill-#{$name}__tag));
        border-color: var(--stroke-#{$name}__tag--disabled, var(--stroke-#{$name}__tag));
        box-shadow: var(--shadow-#{$name}__tag--disabled, var(--shadow-#{$name}__tag));
        color: var(--color-#{$name}__tag--disabled, var(--color-#{$name}__tag));
      }
      background: var(--fill-#{$name}--disabled, var(--fill-#{$name}));
      border-color: var(--stroke-#{$name}--disabled, var(--stroke-#{$name}));
      box-shadow: var(--shadow-#{$name}--disabled, var(--shadow-#{$name}));
      color: var(--color-#{$name}--disabled, var(--color-#{$name}));
    }
  }
}