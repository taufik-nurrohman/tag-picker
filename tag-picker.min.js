/*!
 * ==============================================================
 *  TAG PICKER 3.0.5
 * ==============================================================
 * Author: Taufik Nurrohman <https://github.com/taufik-nurrohman>
 * License: MIT
 * --------------------------------------------------------------
 */
!function(t,n,e){function r(t,n){var e=n[L](t);return 0>e?null:e}function u(t,n){return t[_].remove(n)}function i(t,n){return t[_].add(n)}function a(t){return Object.keys(t).length}function o(t,n){return Object.assign(t,n)}function f(t,n){return n[L](t)>=0}function c(t){return"function"==typeof t}function s(t){return"number"==typeof t}function l(t){return void 0!==t}function v(t){return"string"==typeof t}function g(t){p(t)&&t[K][z](t)}function p(t){return t&&t[K]}function d(t,e,r){var u,i,a=v(t)?n[E](t):t;if((e||""===e)&&(a[C]=e),r)for(u in r)i=r[u],null===i||!1===i?a[I](u):a[W](u,i);return a}var b="Arrow",$=b+"Left",m=b+"Right",h="Backspace",y="Delete",w="Enter",x="Tab",S="appendChild",k="children",_="classList",E="createElement",R="ctrlKey",O="firstChild",T="forEach",j="getAttribute",L="indexOf",C="innerHTML",M="insertBefore",A="__instance__",N="key",H=N+"Code",X="nextSibling",Y="nodeName",K="parentNode",D="previousSibling",I="removeAttribute",z="removeChild",B="replace",W="setAttribute",P="shiftKey",q="textContent",F="toLowerCase",G=setTimeout;!function(t){t.version="3.0.5",t[A]={},t.each=function(n,e){var r,u;return G(function(){u=t[A];for(r in u)n.call(u[r],r)},0===e?0:e||1),t},t.I={"Maximum tags allowed is %d":"Maximum tags allowed is %d.","Minimum tags allowed is %d":"Minimum tags allowed is %d.","Remove tag %s":"Remove tag “%s”","Tag %s already exists":"Tag “%s” already exists."},t.i=function(n,e){return n=t.I[n]||n,e&&e[T](function(t){n=n[B]("%"+(s(t)?"d":"s"),t)}),n},t._=t.prototype}(t[e]=function(n,p){function b(t,n,e){return l(Rn[t])||(Rn[t]={}),l(e)||(e=a(Rn[t])),Rn[t][e]=n,wn}function _(t,n){return l(t)?l(n)?(delete Rn[t][n],wn):(Rn[t]={},wn):(Rn={},wn)}function E(t,n,e){if(!l(Rn[t]))return wn;if(l(e))l(Rn[t][e])&&Rn[t][e].apply(wn,n);else for(var r in Rn[t])Rn[t][r].apply(wn,n);return wn}function L(t){return wn.f(t)[B](RegExp("("+On.escape.join("|")[B](/\\/g,"\\\\")+")+"),"").trim()}function I(t){var n,e=L(Cn[q]);e&&(gn(e)?t&&fn("Tag %s already exists",[e]):(bn(e),dn(e),n=wn.tags.length,E("change",[e,n]),E("set.tag",[e,n])),cn(""))}function z(){I(1),u(Tn,"focus"),u(Tn,"focus.input"),E("blur",[yn,wn.tags.length])}function W(){E("click",[wn.tags])}function J(){i(Tn,"focus"),i(Tn,"focus.input"),E("focus",[wn.tags])}function Q(t){var n,e=On.escape,r=t[H],i=t[N],a=t[R],o=w===i||13===r,c=t[P],s=x===i||9===r,l=Ln[D],v=wn.tags.length,g=On.max,p=L(Cn[q]);o?i="\n":s&&(i="	"),f(i,e)||f(r,e)?(g>v?I(1):(cn(""),fn("Maximum tags allowed is %d",[g])),vn(t)):o?(V()&&En&&En.submit(),vn(t)):!c&&s||G(function(){var o=Cn[q],s=L(o);f(o.slice(-1),e)?(g>v?I(1):(cn(""),fn("Maximum tags allowed is %d",[g])),vn(t)):""!==s||a||c||(""!==p||h!==i&&8!==r?($===i||37===r)&&l&&l.focus():(n=wn.tags[v-1],u(Tn,"focus.tag"),$n(n),pn(n),l&&(E("change",[n,v-1]),E("let.tag",[n,v-1])))),Mn[C]=s?"":Sn},0)}function U(t){if(Tn[K])for(var e;e=Ln[D];)$n(e.title);for(wn.tags=[],n.value="",t=t?t.split(On.join):[],hn=On.max,yn,mn=0;hn>mn&&t[mn];++mn)if(""!==(yn=L(t[mn]))){if(gn(yn))continue;bn(yn),dn(yn),E("change",[yn,mn]),E("set.tag",[yn,mn])}}function V(t){var n=On.min;return I(),n>0&&wn.tags.length<n?(cn("",1),fn("Minimum tags allowed is %d",[n]),vn(t),!1):!0}function Z(){G(function(){U(Cn[q]),cn("")},0)}function tn(t){t&&Tn===t.target&&(Cn.focus(),W())}function nn(){Cn.focus()}function en(){var t=this,n=t.title;u(Tn,"focus"),u(Tn,"focus.tag"),E("blur.tag",[n,r(n,wn.tags)])}function rn(){var t=this.title;E("click.tag",[t,r(t,wn.tags)])}function un(){var t=this,n=t.title;i(Tn,"focus"),i(Tn,"focus.tag"),E("focus.tag",[n,r(n,wn.tags)])}function an(t){var n=this[K].title;$n(n),pn(n),cn("",1),vn(t)}function on(t){var n=this,e=t[H],i=t[N],a=(t[R],t[P]),o=x===i||9===e,f=n[D],c=n[X];if(a&&o||$===i||37===e)f&&(f.focus(),vn(t));else if(o||m===i||39===e)c&&c!==Ln?c.focus():cn("",1),vn(t);else if(h===i||y===i||8===e||46===e){var s=n.title,l=r(s,wn.tags);u(Tn,"focus.tag"),$n(s),pn(s),h===i||8===e?f?f.focus():cn("",1):c&&c!==Ln?c.focus():cn("",1),E("change",[s,l]),E("let.tag",[s,l]),vn(t)}}function fn(t,n){var e,r=On.alert;!0===r&&(e=xn.i(t,n))?alert(e):c(r)?r.apply(wn,n):v(r)&&xn[r]&&xn[r].apply(wn,n)}function cn(t,n){Cn[q]=t,Mn[q]=t?"":Sn,n&&Cn.focus()}function sn(t,n,e){t.removeEventListener(n,e)}function ln(t,n,e){t.addEventListener(n,e,!1)}function vn(t){t&&t.preventDefault()}function gn(t,n){var e=r(t,wn.tags);return n&&E("get.tag",[t,e]),s(e)?t:null}function pn(t){var e=r(t,wn.tags);return s(e)&&e>=0?(wn.tags.splice(e,1),n.value=wn.tags.join(On.join),!0):!1}function dn(t,e){s(e)?(e=0>e?0:e,wn.tags.splice(e,0,t)):wn.tags.push(t),n.value=wn.tags.join(On.join)}function bn(t,n){var e=d("span",0,{"class":"tag",tabindex:"0",title:t});if(On.x){var r=d("a",0,{href:"",tabindex:"-1",title:xn.i("Remove tag %s",[t])});ln(r,"click",an),e[S](r)}ln(e,"blur",en),ln(e,"click",rn),ln(e,"focus",un),ln(e,"keydown",on),jn[K]&&(s(n)&&wn.tags[n]?jn[M](e,jn[k][n]):jn[M](e,Ln))}function $n(t){var n,e=r(t,wn.tags);if(s(e)&&e>=0&&(n=jn.children[e])){if(sn(n,"blur",en),sn(n,"click",rn),sn(n,"focus",un),sn(n,"keydown",on),On.x){var u=n[O];sn(u,"click",an),g(u)}return g(n),!0}return!1}if(n){var mn,hn,yn,wn=this,xn=t[e],Sn=n.placeholder||"",kn=n[j]("tabindex"),_n={alert:!0,"class":"tag-picker",escape:[",",188],join:", ",max:9999,min:0,x:!1};if(n[e])return wn;if(!(wn instanceof xn))return new xn(n,p);xn[A][n.id||n.name||a(xn[A])]=wn,n[e]=1,v(p)&&(p={join:p});var En,Rn={},On=o(_n,p),Tn=d("span",0,{"class":On["class"]}),jn=d("span",0,{"class":"tags"}),Ln=d("span",0,{"class":"editor tag"}),Cn=d("span",0,{contenteditable:"true",spellcheck:"false",style:"white-space:pre;"}),Mn=d("span");for(wn.f=function(t){return t[F]()[B](/[^ a-z0-9-]/g,"")},cn(""),i(n,On["class"]+"-source"),n[K][M](Tn,n),Tn[S](jn),jn[S](Ln),Ln[S](Cn),Ln[S](Mn),d(n,0,{tabindex:"-1"}),En=n[K];En&&En[Y]&&"form"!==En[Y][F]();)En=En[K];ln(Cn,"blur",z),ln(Cn,"click",W),ln(Cn,"focus",J),ln(Cn,"keydown",Q),ln(Cn,"paste",Z),ln(n,"focus",nn),ln(Tn,"click",tn),En&&ln(En,"submit",V),wn.tags=[],U(n.value),wn.input=Cn,wn.self=wn.view=Tn,wn.source=wn.output=n,wn.state=On,wn.blur=function(){return Cn.blur(),z(),wn},wn.click=function(){return Tn.click(),tn(),wn},wn.fire=function(t,n,e){return E(t,n,e)},wn.focus=function(){return Cn.focus(),J(),wn},wn.get=function(t){return gn(t,1)},wn.let=function(t,n){var e=On.min;return I(),n&&e>0&&wn.tags.length<e?(fn("Minimum tags allowed is %d",[e]),wn):($n(t),pn(t),wn)},wn.on=function(t,n,e){return b(t,n,e)},wn.off=function(t,n){return _(t,n)},wn.pop=function(){return n[e]?(delete n[e],sn(Cn,"blur",z),sn(Cn,"click",W),sn(Cn,"focus",J),sn(Cn,"keydown",Q),sn(Cn,"paste",Z),sn(n,"focus",nn),sn(Tn,"click",tn),En&&sn(En,"submit",V),wn.tags[T]($n),u(n,On["class"]+"-source"),d(n,0,{tabindex:kn}),g(Tn),E("pop")):wn},wn.set=function(t,n,e){if(gn(t))e&&fn("Tag %s already exists",[t]);else{var r=On.max;wn.tags.length<r?(bn(t,n),dn(t,n)):e&&fn("Maximum tags allowed is %d",[r])}return wn},wn.value=function(t){return U(t),wn}}})}(window,document,"TP");