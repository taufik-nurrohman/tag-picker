/*!
 * ==========================================================
 *  TAG PICKER PLUGIN 3.0.4
 * ==========================================================
 * Author: Taufik Nurrohman <https://github.com/tovic>
 * License: MIT
 * ----------------------------------------------------------
 */
!function(t,n,e){function r(t,n){var e=n[R](t);return 0>e?null:e}function i(t,n){return t[T].remove(n)}function u(t,n){return t[T].add(n)}function a(t){return Object.keys(t).length}function o(t,n){return Object.assign(t,n)}function c(t,n){return n[R](t)>=0}function f(t){return"function"==typeof t}function s(t){return"number"==typeof t}function l(t){return void 0!==t}function g(t){return"string"==typeof t}function v(t){d(t)&&t[I][Y](t)}function d(t){return t&&t[I]}function p(t,e,r){var i,u,a=g(t)?n[E](t):t;if((e||""===e)&&(a[L]=e),r)for(i in r)u=r[i],null===u||!1===u?a[X](i):a[P](i,u);return a}var m="Arrow",b=m+"Left",h=m+"Right",y="Backspace",x="Delete",w="Enter",$="Tab",k="appendChild",j="children",T="classList",E="createElement",M="ctrlKey",_="firstChild",S="forEach",O="getAttribute",R="indexOf",L="innerHTML",C="insertBefore",A="__instance__",H="key",N=H+"Code",B="nextSibling",D="nodeName",I="parentNode",K="previousSibling",X="removeAttribute",Y="removeChild",z="replace",P="setAttribute",q="shiftKey",F="textContent",G="toLowerCase",J=setTimeout;!function(t){t.version="3.0.4",t[A]={},t.each=function(n,e){var r,i;return J(function(){i=t[A];for(r in i)n.call(i[r],r)},0===e?0:e||1),t},t.I={"Maximum tags allowed is %d":"Maximum tags allowed is %d.","Minimum tags allowed is %d":"Minimum tags allowed is %d.","Remove tag %s":"Remove tag “%s”","Tag %s already exists":"Tag “%s” already exists."},t.i=function(n,e){return n=t.I[n]||n,e&&e[S](function(t){n=n[z]("%"+(s(t)?"d":"s"),t)}),n},t._=t.prototype}(t[e]=function(n,d){function m(t,n,e){return l(Mn[t])||(Mn[t]={}),l(e)||(e=a(Mn[t])),Mn[t][e]=n,wn}function T(t,n){return l(t)?l(n)?(delete Mn[t][n],wn):(Mn[t]={},wn):(Mn={},wn)}function E(t,n,e){if(!l(Mn[t]))return wn;if(l(e))l(Mn[t][e])&&Mn[t][e].apply(wn,n);else for(var r in Mn[t])Mn[t][r].apply(wn,n);return wn}function R(t){return wn.f(t)[z](RegExp("("+_n.escape.join("|")[z](/\\/g,"\\\\")+")+"),"").trim()}function X(t){var n,e=R(Ln[F]);e&&(vn(e)?t&&cn("Tag %s already exists",[e]):(mn(e),pn(e),n=wn.tags.length,E("change",[e,n]),E("set.tag",[e,n])),fn(""))}function Y(){X(1),i(Sn,"focus"),i(Sn,"focus.input"),E("blur",[xn,wn.tags.length])}function P(){E("click",[wn.tags])}function Q(){u(Sn,"focus"),u(Sn,"focus.input"),E("focus",[wn.tags])}function U(t){var n,e=_n.escape,r=t[N],u=t[H],a=t[M],o=w===u||13===r,f=t[q],s=$===u||9===r,l=Rn[K],g=wn.tags.length,v=_n.max,d=R(Ln[F]);o?u="\n":s&&(u="	"),c(u,e)||c(r,e)?(v>g?X(1):(fn(""),cn("Maximum tags allowed is %d",[v])),gn(t)):o?(W()&&En&&En.submit(),gn(t)):!f&&s||J(function(){var o=Ln[F],s=R(o);c(o.slice(-1),e)?(v>g?X(1):(fn(""),cn("Maximum tags allowed is %d",[v])),gn(t)):""!==s||a||f||(""!==d||y!==u&&8!==r?(b===u||37===r)&&l&&l.focus():(n=wn.tags[g-1],i(Sn,"focus.tag"),bn(n),dn(n),l&&(E("change",[n,g-1]),E("let.tag",[n,g-1])))),Cn[L]=s?"":kn},0)}function V(t){if(Sn[I])for(var e;e=Rn[K];)bn(e.title);for(wn.tags=[],n.value="",t=t?t.split(_n.join):[],yn=_n.max,xn,hn=0;yn>hn&&t[hn];++hn)if(""!==(xn=R(t[hn]))){if(vn(xn))continue;mn(xn),pn(xn),E("change",[xn,hn]),E("set.tag",[xn,hn])}}function W(t){var n=_n.min;return X(),n>0&&wn.tags.length<n?(fn("",1),cn("Minimum tags allowed is %d",[n]),gn(t),!1):!0}function Z(){J(function(){V(Ln[F]),fn("")},0)}function tn(t){t&&Sn===t.target&&(Ln.focus(),P())}function nn(){Ln.focus()}function en(){var t=this,n=t.title;i(Sn,"focus"),i(Sn,"focus.tag"),E("blur.tag",[n,r(n,wn.tags)])}function rn(){var t=this.title;E("click.tag",[t,r(t,wn.tags)])}function un(){var t=this,n=t.title;u(Sn,"focus"),u(Sn,"focus.tag"),E("focus.tag",[n,r(n,wn.tags)])}function an(t){var n=this[I].title;bn(n),dn(n),fn("",1),gn(t)}function on(t){var n=this,e=t[N],u=t[H],a=(t[M],t[q]),o=$===u||9===e,c=n[K],f=n[B];if(a&&o||b===u||37===e)c&&(c.focus(),gn(t));else if(o||h===u||39===e)f&&f!==Rn?f.focus():fn("",1),gn(t);else if(y===u||x===u||8===e||46===e){var s=n.title,l=r(s,wn.tags);i(Sn,"focus.tag"),bn(s),dn(s),y===u||8===e?c?c.focus():fn("",1):f&&f!==Rn?f.focus():fn("",1),E("change",[s,l]),E("let.tag",[s,l]),gn(t)}}function cn(t,n){var e,r=_n.alert;!0===r&&(e=$n.i(t,n))?alert(e):f(r)?r.apply(wn,n):g(r)&&$n[r]&&$n[r].apply(wn,n)}function fn(t,n){Ln[F]=t,Cn[F]=t?"":kn,n&&Ln.focus()}function sn(t,n,e){t.removeEventListener(n,e)}function ln(t,n,e){t.addEventListener(n,e,!1)}function gn(t){t&&t.preventDefault()}function vn(t,n){var e=r(t,wn.tags);return n&&E("get.tag",[t,e]),s(e)?t:null}function dn(t){var e=r(t,wn.tags);return s(e)&&e>=0?(wn.tags.splice(e,1),n.value=wn.tags.join(_n.join),!0):!1}function pn(t,e){s(e)?(e=0>e?0:e,wn.tags.splice(e,0,t)):wn.tags.push(t),n.value=wn.tags.join(_n.join)}function mn(t,n){var e=p("span",0,{"class":"tag",tabindex:"0",title:t});if(_n.x){var r=p("a",0,{href:"",tabindex:"-1",title:$n.i("Remove tag %s",[t])});ln(r,"click",an),e[k](r)}ln(e,"blur",en),ln(e,"click",rn),ln(e,"focus",un),ln(e,"keydown",on),On[I]&&(s(n)&&wn.tags[n]?On[C](e,On[j][n]):On[C](e,Rn))}function bn(t){var n,e=r(t,wn.tags);if(s(e)&&e>=0&&(n=On.children[e])){if(sn(n,"blur",en),sn(n,"click",rn),sn(n,"focus",un),sn(n,"keydown",on),_n.x){var i=n[_];sn(i,"click",an),v(i)}return v(n),!0}return!1}if(n){var hn,yn,xn,wn=this,$n=t[e],kn=n.placeholder||"",jn=n[O]("tabindex"),Tn={alert:!0,"class":"tag-picker",escape:[",",188],join:", ",max:9999,min:0,x:!1};if(n[e])return wn;if(!(wn instanceof $n))return new $n(n,d);$n[A][n.id||n.name||a($n[A])]=wn,n[e]=1,g(d)&&(d={join:d});var En,Mn={},_n=o(Tn,d),Sn=p("span",0,{"class":_n["class"]}),On=p("span",0,{"class":"tags"}),Rn=p("span",0,{"class":"editor tag"}),Ln=p("span",0,{contenteditable:"true",spellcheck:"false",style:"white-space:pre;"}),Cn=p("span");for(wn.f=function(t){return t[G]()[z](/[^ a-z0-9-]/g,"")},fn(""),u(n,_n["class"]+"-source"),n[I][C](Sn,n),Sn[k](On),On[k](Rn),Rn[k](Ln),Rn[k](Cn),p(n,0,{tabindex:"-1"}),En=n[I];En&&En[D]&&"form"!==En[D][G]();)En=En[I];ln(Ln,"blur",Y),ln(Ln,"click",P),ln(Ln,"focus",Q),ln(Ln,"keydown",U),ln(Ln,"paste",Z),ln(n,"focus",nn),ln(Sn,"click",tn),En&&ln(En,"submit",W),wn.tags=[],V(n.value),wn.input=Ln,wn.self=wn.view=Sn,wn.source=wn.output=n,wn.state=_n,wn.blur=function(){return Ln.blur(),Y(),wn},wn.click=function(){return Sn.click(),tn(),wn},wn.fire=function(t,n,e){return E(t,n,e)},wn.focus=function(){return Ln.focus(),Q(),wn},wn.get=function(t){return vn(t,1),wn},wn.let=function(t,n){var e=_n.min;return X(),n&&e>0&&wn.tags.length<e?(cn("Minimum tags allowed is %d",[e]),wn):(bn(t),dn(t),wn)},wn.on=function(t,n,e){return m(t,n,e)},wn.off=function(t,n){return T(t,n)},wn.pop=function(){return n[e]?(delete n[e],sn(Ln,"blur",Y),sn(Ln,"click",P),sn(Ln,"focus",Q),sn(Ln,"keydown",U),sn(Ln,"paste",Z),sn(n,"focus",nn),sn(Sn,"click",tn),En&&sn(En,"submit",W),wn.tags[S](bn),i(n,_n["class"]+"-source"),p(n,0,{tabindex:jn}),v(Sn),E("pop")):wn},wn.set=function(t,n,e){if(vn(t))e&&cn("Tag %s already exists",[t]);else{var r=_n.max;wn.tags.length<r?(mn(t,n),pn(t,n)):e&&cn("Maximum tags allowed is %d",[r])}return wn},wn.value=function(t){return V(t),wn}}})}(window,document,"TP");